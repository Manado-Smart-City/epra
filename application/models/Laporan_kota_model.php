<?php
/*
 * Generated by CRUDigniter v3.0 Beta
 * www.crudigniter.com
 */

class Laporan_kota_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();
    }

    function get_anggaran_total_kota($tahun_anggaran)
    {
      $sql = '
        SELECT 
        SUM(pagu_giat) AS anggaran_total_kota 
        FROM belanja
      ';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }

    function get_daftar_pd($tahun_anggaran)
    {
      $sql_str = '

            # TABEL PD --> anggaran dan realisasi

            # total anggaran
            DROP TEMPORARY TABLE IF EXISTS total_anggaran_pd;
            CREATE TEMPORARY TABLE total_anggaran_pd AS
            SELECT 
              d.kode_pd,
              d.nama_pd,
              d.nip_kepala,
              e.nama_p AS nama_kepala,
              e.jabat_p AS jabatan_kepala,
              e.foto_p AS foto_kepala,
              d.kode_prog_btl,
              d.kode_giat_btl,
              SUM(a.pagu_giat) AS anggaran_total
            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            LEFT JOIN pejabat AS e ON d.nip_kepala = e.nip_p
            GROUP BY c.kode_pd
            ORDER BY c.kode_pd ASC;

            # total anggaran BL

            DROP TEMPORARY TABLE IF EXISTS total_anggaran_pd_bl;
            CREATE TEMPORARY TABLE total_anggaran_pd_bl AS
            SELECT 
              e.*,
              SUM(IF(b.kode_giat <> e.kode_giat_btl,a.pagu_giat,0)) AS anggaran_total_bl,
              SUM(IF(b.kode_giat = e.kode_giat_btl,a.pagu_giat,0)) AS anggaran_total_btl
            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN total_anggaran_pd AS e ON c.kode_pd = e.kode_pd
            # WHERE b.kode_giat <> e.kode_giat_btl 
            GROUP BY c.kode_pd
            ORDER BY c.kode_pd ASC;

            # realisasi BL

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_bl;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_bl AS
            SELECT 
              e.*,

              # fisik
              d.tf_1  AS bl_target_fisik_1 ,
              d.tf_2  AS bl_target_fisik_2 ,
              d.tf_3  AS bl_target_fisik_3 ,
              d.tf_4  AS bl_target_fisik_4 ,
              d.tf_5  AS bl_target_fisik_5 ,
              d.tf_6  AS bl_target_fisik_6 ,
              d.tf_7  AS bl_target_fisik_7 ,
              d.tf_8  AS bl_target_fisik_8 ,
              d.tf_9  AS bl_target_fisik_9 ,
              d.tf_10 AS bl_target_fisik_10,
              d.tf_11 AS bl_target_fisik_11,
              d.tf_12 AS bl_target_fisik_12,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_1 ),0) AS bl_realisasi_fisik_1 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_2 ),0) AS bl_realisasi_fisik_2 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_3 ),0) AS bl_realisasi_fisik_3 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_4 ),0) AS bl_realisasi_fisik_4 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_5 ),0) AS bl_realisasi_fisik_5 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_6 ),0) AS bl_realisasi_fisik_6 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_7 ),0) AS bl_realisasi_fisik_7 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_8 ),0) AS bl_realisasi_fisik_8 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_9 ),0) AS bl_realisasi_fisik_9 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_10),0) AS bl_realisasi_fisik_10,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_11),0) AS bl_realisasi_fisik_11,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_12),0) AS bl_realisasi_fisik_12,

              # keuangan
              d.tk_1  AS bl_target_keuangan_1 ,
              d.tk_2  AS bl_target_keuangan_2 ,
              d.tk_3  AS bl_target_keuangan_3 ,
              d.tk_4  AS bl_target_keuangan_4 ,
              d.tk_5  AS bl_target_keuangan_5 ,
              d.tk_6  AS bl_target_keuangan_6 ,
              d.tk_7  AS bl_target_keuangan_7 ,
              d.tk_8  AS bl_target_keuangan_8 ,
              d.tk_9  AS bl_target_keuangan_9 ,
              d.tk_10 AS bl_target_keuangan_10,
              d.tk_11 AS bl_target_keuangan_11,
              d.tk_12 AS bl_target_keuangan_12,
              IFNULL((d.tk_1 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_1 ,
              IFNULL((d.tk_2 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_2 ,
              IFNULL((d.tk_3 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_3 ,
              IFNULL((d.tk_4 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_4 ,
              IFNULL((d.tk_5 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_5 ,
              IFNULL((d.tk_6 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_6 ,
              IFNULL((d.tk_7 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_7 ,
              IFNULL((d.tk_8 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_8 ,
              IFNULL((d.tk_9 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_9 ,
              IFNULL((d.tk_10/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_10,
              IFNULL((d.tk_11/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_11,
              IFNULL((d.tk_12/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_12,  
              SUM(a.kk_1 ) AS bl_realisasi_keuangan_1 ,
              SUM(a.kk_2 ) AS bl_realisasi_keuangan_2 ,
              SUM(a.kk_3 ) AS bl_realisasi_keuangan_3 ,
              SUM(a.kk_4 ) AS bl_realisasi_keuangan_4 ,
              SUM(a.kk_5 ) AS bl_realisasi_keuangan_5 ,
              SUM(a.kk_6 ) AS bl_realisasi_keuangan_6 ,
              SUM(a.kk_7 ) AS bl_realisasi_keuangan_7 ,
              SUM(a.kk_8 ) AS bl_realisasi_keuangan_8 ,
              SUM(a.kk_9 ) AS bl_realisasi_keuangan_9 ,
              SUM(a.kk_10) AS bl_realisasi_keuangan_10,
              SUM(a.kk_11) AS bl_realisasi_keuangan_11,
              SUM(a.kk_12) AS bl_realisasi_keuangan_12,
              IFNULL((SUM(a.kk_1 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_1 ,
              IFNULL((SUM(a.kk_2 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_2 ,
              IFNULL((SUM(a.kk_3 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_3 ,
              IFNULL((SUM(a.kk_4 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_4 ,
              IFNULL((SUM(a.kk_5 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_5 ,
              IFNULL((SUM(a.kk_6 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_6 ,
              IFNULL((SUM(a.kk_7 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_7 ,
              IFNULL((SUM(a.kk_8 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_8 ,
              IFNULL((SUM(a.kk_9 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_9 ,
              IFNULL((SUM(a.kk_10)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_10,
              IFNULL((SUM(a.kk_11)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_11,
              IFNULL((SUM(a.kk_12)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_12  

            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN total_anggaran_pd_bl AS e ON c.kode_pd = e.kode_pd 
            GROUP BY e.kode_pd
            ORDER BY e.kode_pd ASC;


            # tambahkan realisasi BTL

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_bl_btl;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_bl_btl AS
            SELECT 
              e.*,

              # fisik
              d.btl_tf_1  AS btl_target_fisik_1 ,
              d.btl_tf_2  AS btl_target_fisik_2 ,
              d.btl_tf_3  AS btl_target_fisik_3 ,
              d.btl_tf_4  AS btl_target_fisik_4 ,
              d.btl_tf_5  AS btl_target_fisik_5 ,
              d.btl_tf_6  AS btl_target_fisik_6 ,
              d.btl_tf_7  AS btl_target_fisik_7 ,
              d.btl_tf_8  AS btl_target_fisik_8 ,
              d.btl_tf_9  AS btl_target_fisik_9 ,
              d.btl_tf_10 AS btl_target_fisik_10,
              d.btl_tf_11 AS btl_target_fisik_11,
              d.btl_tf_12 AS btl_target_fisik_12,
              d.btl_rf_1  AS btl_realisasi_fisik_1 ,
              d.btl_rf_2  AS btl_realisasi_fisik_2 ,
              d.btl_rf_3  AS btl_realisasi_fisik_3 ,
              d.btl_rf_4  AS btl_realisasi_fisik_4 ,
              d.btl_rf_5  AS btl_realisasi_fisik_5 ,
              d.btl_rf_6  AS btl_realisasi_fisik_6 ,
              d.btl_rf_7  AS btl_realisasi_fisik_7 ,
              d.btl_rf_8  AS btl_realisasi_fisik_8 ,
              d.btl_rf_9  AS btl_realisasi_fisik_9 ,
              d.btl_rf_10 AS btl_realisasi_fisik_10,
              d.btl_rf_11 AS btl_realisasi_fisik_11,
              d.btl_rf_12 AS btl_realisasi_fisik_12,

              # keuangan
              d.btl_tk_1  AS btl_target_keuangan_1 ,
              d.btl_tk_2  AS btl_target_keuangan_2 ,
              d.btl_tk_3  AS btl_target_keuangan_3 ,
              d.btl_tk_4  AS btl_target_keuangan_4 ,
              d.btl_tk_5  AS btl_target_keuangan_5 ,
              d.btl_tk_6  AS btl_target_keuangan_6 ,
              d.btl_tk_7  AS btl_target_keuangan_7 ,
              d.btl_tk_8  AS btl_target_keuangan_8 ,
              d.btl_tk_9  AS btl_target_keuangan_9 ,
              d.btl_tk_10 AS btl_target_keuangan_10,
              d.btl_tk_11 AS btl_target_keuangan_11,
              d.btl_tk_12 AS btl_target_keuangan_12,
              IFNULL((d.btl_tk_1 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_1 ,
              IFNULL((d.btl_tk_2 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_2 ,
              IFNULL((d.btl_tk_3 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_3 ,
              IFNULL((d.btl_tk_4 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_4 ,
              IFNULL((d.btl_tk_5 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_5 ,
              IFNULL((d.btl_tk_6 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_6 ,
              IFNULL((d.btl_tk_7 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_7 ,
              IFNULL((d.btl_tk_8 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_8 ,
              IFNULL((d.btl_tk_9 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_9 ,
              IFNULL((d.btl_tk_10/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_10,
              IFNULL((d.btl_tk_11/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_11,
              IFNULL((d.btl_tk_12/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_12,  
              d.btl_rk_1  AS btl_realisasi_keuangan_1 ,
              d.btl_rk_2  AS btl_realisasi_keuangan_2 ,
              d.btl_rk_3  AS btl_realisasi_keuangan_3 ,
              d.btl_rk_4  AS btl_realisasi_keuangan_4 ,
              d.btl_rk_5  AS btl_realisasi_keuangan_5 ,
              d.btl_rk_6  AS btl_realisasi_keuangan_6 ,
              d.btl_rk_7  AS btl_realisasi_keuangan_7 ,
              d.btl_rk_8  AS btl_realisasi_keuangan_8 ,
              d.btl_rk_9  AS btl_realisasi_keuangan_9 ,
              d.btl_rk_10 AS btl_realisasi_keuangan_10,
              d.btl_rk_11 AS btl_realisasi_keuangan_11,
              d.btl_rk_12 AS btl_realisasi_keuangan_12,
              IFNULL((d.btl_rk_1 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_1 ,
              IFNULL((d.btl_rk_2 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_2 ,
              IFNULL((d.btl_rk_3 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_3 ,
              IFNULL((d.btl_rk_4 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_4 ,
              IFNULL((d.btl_rk_5 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_5 ,
              IFNULL((d.btl_rk_6 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_6 ,
              IFNULL((d.btl_rk_7 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_7 ,
              IFNULL((d.btl_rk_8 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_8 ,
              IFNULL((d.btl_rk_9 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_9 ,
              IFNULL((d.btl_rk_10/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_10,
              IFNULL((d.btl_rk_11/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_11,
              IFNULL((d.btl_rk_12/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_12  

            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN realisasi_anggaran_pd_bl AS e ON c.kode_pd = e.kode_pd 
            GROUP BY e.kode_pd
            ORDER BY e.kode_pd ASC;


            # realisasi total

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_total;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_total AS
            SELECT 
              a.*,
              # fisik
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_1 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_1 ), 0) AS total_target_fisik_1 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_2 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_2 ), 0) AS total_target_fisik_2 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_3 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_3 ), 0) AS total_target_fisik_3 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_4 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_4 ), 0) AS total_target_fisik_4 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_5 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_5 ), 0) AS total_target_fisik_5 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_6 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_6 ), 0) AS total_target_fisik_6 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_7 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_7 ), 0) AS total_target_fisik_7 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_8 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_8 ), 0) AS total_target_fisik_8 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_9 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_9 ), 0) AS total_target_fisik_9 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_10), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_10), 0) AS total_target_fisik_10,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_11), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_11), 0) AS total_target_fisik_11,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_12), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_12), 0) AS total_target_fisik_12,

              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_1 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_1 ), 0) AS total_realisasi_fisik_1 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_2 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_2 ), 0) AS total_realisasi_fisik_2 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_3 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_3 ), 0) AS total_realisasi_fisik_3 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_4 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_4 ), 0) AS total_realisasi_fisik_4 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_5 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_5 ), 0) AS total_realisasi_fisik_5 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_6 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_6 ), 0) AS total_realisasi_fisik_6 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_7 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_7 ), 0) AS total_realisasi_fisik_7 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_8 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_8 ), 0) AS total_realisasi_fisik_8 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_9 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_9 ), 0) AS total_realisasi_fisik_9 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_10), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_10), 0) AS total_realisasi_fisik_10,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_11), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_11), 0) AS total_realisasi_fisik_11,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_12), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_12), 0) AS total_realisasi_fisik_12,

              IFNULL(a.bl_target_keuangan_1 ,0) + IFNULL(a.btl_target_keuangan_1 ,0) AS total_target_keuangan_1 ,
              IFNULL(a.bl_target_keuangan_2 ,0) + IFNULL(a.btl_target_keuangan_2 ,0) AS total_target_keuangan_2 ,
              IFNULL(a.bl_target_keuangan_3 ,0) + IFNULL(a.btl_target_keuangan_3 ,0) AS total_target_keuangan_3 ,
              IFNULL(a.bl_target_keuangan_4 ,0) + IFNULL(a.btl_target_keuangan_4 ,0) AS total_target_keuangan_4 ,
              IFNULL(a.bl_target_keuangan_5 ,0) + IFNULL(a.btl_target_keuangan_5 ,0) AS total_target_keuangan_5 ,
              IFNULL(a.bl_target_keuangan_6 ,0) + IFNULL(a.btl_target_keuangan_6 ,0) AS total_target_keuangan_6 ,
              IFNULL(a.bl_target_keuangan_7 ,0) + IFNULL(a.btl_target_keuangan_7 ,0) AS total_target_keuangan_7 ,
              IFNULL(a.bl_target_keuangan_8 ,0) + IFNULL(a.btl_target_keuangan_8 ,0) AS total_target_keuangan_8 ,
              IFNULL(a.bl_target_keuangan_9 ,0) + IFNULL(a.btl_target_keuangan_9 ,0) AS total_target_keuangan_9 ,
              IFNULL(a.bl_target_keuangan_10,0) + IFNULL(a.btl_target_keuangan_10,0) AS total_target_keuangan_10,
              IFNULL(a.bl_target_keuangan_11,0) + IFNULL(a.btl_target_keuangan_11,0) AS total_target_keuangan_11,
              IFNULL(a.bl_target_keuangan_12,0) + IFNULL(a.btl_target_keuangan_12,0) AS total_target_keuangan_12,

              IFNULL(((a.bl_target_keuangan_1  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_1  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_1 ,
              IFNULL(((a.bl_target_keuangan_2  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_2  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_2 ,
              IFNULL(((a.bl_target_keuangan_3  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_3  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_3 ,
              IFNULL(((a.bl_target_keuangan_4  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_4  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_4 ,
              IFNULL(((a.bl_target_keuangan_5  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_5  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_5 ,
              IFNULL(((a.bl_target_keuangan_6  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_6  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_6 ,
              IFNULL(((a.bl_target_keuangan_7  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_7  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_7 ,
              IFNULL(((a.bl_target_keuangan_8  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_8  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_8 ,
              IFNULL(((a.bl_target_keuangan_9  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_9  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_9 ,
              IFNULL(((a.bl_target_keuangan_10 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_10 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_10,
              IFNULL(((a.bl_target_keuangan_11 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_11 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_11,
              IFNULL(((a.bl_target_keuangan_12 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_12 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_12,

              IFNULL(a.bl_realisasi_keuangan_1 ,0) + IFNULL(a.btl_realisasi_keuangan_1 ,0) AS total_realisasi_keuangan_1 ,
              IFNULL(a.bl_realisasi_keuangan_2 ,0) + IFNULL(a.btl_realisasi_keuangan_2 ,0) AS total_realisasi_keuangan_2 ,
              IFNULL(a.bl_realisasi_keuangan_3 ,0) + IFNULL(a.btl_realisasi_keuangan_3 ,0) AS total_realisasi_keuangan_3 ,
              IFNULL(a.bl_realisasi_keuangan_4 ,0) + IFNULL(a.btl_realisasi_keuangan_4 ,0) AS total_realisasi_keuangan_4 ,
              IFNULL(a.bl_realisasi_keuangan_5 ,0) + IFNULL(a.btl_realisasi_keuangan_5 ,0) AS total_realisasi_keuangan_5 ,
              IFNULL(a.bl_realisasi_keuangan_6 ,0) + IFNULL(a.btl_realisasi_keuangan_6 ,0) AS total_realisasi_keuangan_6 ,
              IFNULL(a.bl_realisasi_keuangan_7 ,0) + IFNULL(a.btl_realisasi_keuangan_7 ,0) AS total_realisasi_keuangan_7 ,
              IFNULL(a.bl_realisasi_keuangan_8 ,0) + IFNULL(a.btl_realisasi_keuangan_8 ,0) AS total_realisasi_keuangan_8 ,
              IFNULL(a.bl_realisasi_keuangan_9 ,0) + IFNULL(a.btl_realisasi_keuangan_9 ,0) AS total_realisasi_keuangan_9 ,
              IFNULL(a.bl_realisasi_keuangan_10,0) + IFNULL(a.btl_realisasi_keuangan_10,0) AS total_realisasi_keuangan_10,
              IFNULL(a.bl_realisasi_keuangan_11,0) + IFNULL(a.btl_realisasi_keuangan_11,0) AS total_realisasi_keuangan_11,
              IFNULL(a.bl_realisasi_keuangan_12,0) + IFNULL(a.btl_realisasi_keuangan_12,0) AS total_realisasi_keuangan_12,

              IFNULL(((a.bl_realisasi_keuangan_1  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_1  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_1 ,
              IFNULL(((a.bl_realisasi_keuangan_2  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_2  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_2 ,
              IFNULL(((a.bl_realisasi_keuangan_3  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_3  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_3 ,
              IFNULL(((a.bl_realisasi_keuangan_4  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_4  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_4 ,
              IFNULL(((a.bl_realisasi_keuangan_5  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_5  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_5 ,
              IFNULL(((a.bl_realisasi_keuangan_6  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_6  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_6 ,
              IFNULL(((a.bl_realisasi_keuangan_7  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_7  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_7 ,
              IFNULL(((a.bl_realisasi_keuangan_8  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_8  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_8 ,
              IFNULL(((a.bl_realisasi_keuangan_9  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_9  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_9 ,
              IFNULL(((a.bl_realisasi_keuangan_10 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_10 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_10,
              IFNULL(((a.bl_realisasi_keuangan_11 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_11 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_11,
              IFNULL(((a.bl_realisasi_keuangan_12 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_12 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_12

            FROM realisasi_anggaran_pd_bl_btl AS a;

            # hitung deviasi

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_total_deviasi;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_total_deviasi AS
            SELECT 
              a.*,

              # deviasi

              a.bl_realisasi_fisik_1  - a.bl_target_fisik_1  AS bl_deviasi_fisik_1 ,
              a.bl_realisasi_fisik_2  - a.bl_target_fisik_2  AS bl_deviasi_fisik_2 ,
              a.bl_realisasi_fisik_3  - a.bl_target_fisik_3  AS bl_deviasi_fisik_3 ,
              a.bl_realisasi_fisik_4  - a.bl_target_fisik_4  AS bl_deviasi_fisik_4 ,
              a.bl_realisasi_fisik_5  - a.bl_target_fisik_5  AS bl_deviasi_fisik_5 ,
              a.bl_realisasi_fisik_6  - a.bl_target_fisik_6  AS bl_deviasi_fisik_6 ,
              a.bl_realisasi_fisik_7  - a.bl_target_fisik_7  AS bl_deviasi_fisik_7 ,
              a.bl_realisasi_fisik_8  - a.bl_target_fisik_8  AS bl_deviasi_fisik_8 ,
              a.bl_realisasi_fisik_9  - a.bl_target_fisik_9  AS bl_deviasi_fisik_9 ,
              a.bl_realisasi_fisik_10 - a.bl_target_fisik_10 AS bl_deviasi_fisik_10,
              a.bl_realisasi_fisik_11 - a.bl_target_fisik_11 AS bl_deviasi_fisik_11,
              a.bl_realisasi_fisik_12 - a.bl_target_fisik_12 AS bl_deviasi_fisik_12,

              a.bl_realisasi_keuangan_persen_1  - a.bl_target_keuangan_persen_1  AS bl_deviasi_keuangan_persen_1 ,
              a.bl_realisasi_keuangan_persen_2  - a.bl_target_keuangan_persen_2  AS bl_deviasi_keuangan_persen_2 ,
              a.bl_realisasi_keuangan_persen_3  - a.bl_target_keuangan_persen_3  AS bl_deviasi_keuangan_persen_3 ,
              a.bl_realisasi_keuangan_persen_4  - a.bl_target_keuangan_persen_4  AS bl_deviasi_keuangan_persen_4 ,
              a.bl_realisasi_keuangan_persen_5  - a.bl_target_keuangan_persen_5  AS bl_deviasi_keuangan_persen_5 ,
              a.bl_realisasi_keuangan_persen_6  - a.bl_target_keuangan_persen_6  AS bl_deviasi_keuangan_persen_6 ,
              a.bl_realisasi_keuangan_persen_7  - a.bl_target_keuangan_persen_7  AS bl_deviasi_keuangan_persen_7 ,
              a.bl_realisasi_keuangan_persen_8  - a.bl_target_keuangan_persen_8  AS bl_deviasi_keuangan_persen_8 ,
              a.bl_realisasi_keuangan_persen_9  - a.bl_target_keuangan_persen_9  AS bl_deviasi_keuangan_persen_9 ,
              a.bl_realisasi_keuangan_persen_10 - a.bl_target_keuangan_persen_10 AS bl_deviasi_keuangan_persen_10,
              a.bl_realisasi_keuangan_persen_11 - a.bl_target_keuangan_persen_11 AS bl_deviasi_keuangan_persen_11,
              a.bl_realisasi_keuangan_persen_12 - a.bl_target_keuangan_persen_12 AS bl_deviasi_keuangan_persen_12,

              a.btl_realisasi_fisik_1  - a.btl_target_fisik_1  AS btl_deviasi_fisik_1 ,
              a.btl_realisasi_fisik_2  - a.btl_target_fisik_2  AS btl_deviasi_fisik_2 ,
              a.btl_realisasi_fisik_3  - a.btl_target_fisik_3  AS btl_deviasi_fisik_3 ,
              a.btl_realisasi_fisik_4  - a.btl_target_fisik_4  AS btl_deviasi_fisik_4 ,
              a.btl_realisasi_fisik_5  - a.btl_target_fisik_5  AS btl_deviasi_fisik_5 ,
              a.btl_realisasi_fisik_6  - a.btl_target_fisik_6  AS btl_deviasi_fisik_6 ,
              a.btl_realisasi_fisik_7  - a.btl_target_fisik_7  AS btl_deviasi_fisik_7 ,
              a.btl_realisasi_fisik_8  - a.btl_target_fisik_8  AS btl_deviasi_fisik_8 ,
              a.btl_realisasi_fisik_9  - a.btl_target_fisik_9  AS btl_deviasi_fisik_9 ,
              a.btl_realisasi_fisik_10 - a.btl_target_fisik_10 AS btl_deviasi_fisik_10,
              a.btl_realisasi_fisik_11 - a.btl_target_fisik_11 AS btl_deviasi_fisik_11,
              a.btl_realisasi_fisik_12 - a.btl_target_fisik_12 AS btl_deviasi_fisik_12,

              a.btl_realisasi_keuangan_persen_1  - a.btl_target_keuangan_persen_1  AS btl_deviasi_keuangan_persen_1 ,
              a.btl_realisasi_keuangan_persen_2  - a.btl_target_keuangan_persen_2  AS btl_deviasi_keuangan_persen_2 ,
              a.btl_realisasi_keuangan_persen_3  - a.btl_target_keuangan_persen_3  AS btl_deviasi_keuangan_persen_3 ,
              a.btl_realisasi_keuangan_persen_4  - a.btl_target_keuangan_persen_4  AS btl_deviasi_keuangan_persen_4 ,
              a.btl_realisasi_keuangan_persen_5  - a.btl_target_keuangan_persen_5  AS btl_deviasi_keuangan_persen_5 ,
              a.btl_realisasi_keuangan_persen_6  - a.btl_target_keuangan_persen_6  AS btl_deviasi_keuangan_persen_6 ,
              a.btl_realisasi_keuangan_persen_7  - a.btl_target_keuangan_persen_7  AS btl_deviasi_keuangan_persen_7 ,
              a.btl_realisasi_keuangan_persen_8  - a.btl_target_keuangan_persen_8  AS btl_deviasi_keuangan_persen_8 ,
              a.btl_realisasi_keuangan_persen_9  - a.btl_target_keuangan_persen_9  AS btl_deviasi_keuangan_persen_9 ,
              a.btl_realisasi_keuangan_persen_10 - a.btl_target_keuangan_persen_10 AS btl_deviasi_keuangan_persen_10,
              a.btl_realisasi_keuangan_persen_11 - a.btl_target_keuangan_persen_11 AS btl_deviasi_keuangan_persen_11,
              a.btl_realisasi_keuangan_persen_12 - a.btl_target_keuangan_persen_12 AS btl_deviasi_keuangan_persen_12,  

              a.total_realisasi_fisik_1  - a.total_target_fisik_1  AS total_deviasi_fisik_1 ,
              a.total_realisasi_fisik_2  - a.total_target_fisik_2  AS total_deviasi_fisik_2 ,
              a.total_realisasi_fisik_3  - a.total_target_fisik_3  AS total_deviasi_fisik_3 ,
              a.total_realisasi_fisik_4  - a.total_target_fisik_4  AS total_deviasi_fisik_4 ,
              a.total_realisasi_fisik_5  - a.total_target_fisik_5  AS total_deviasi_fisik_5 ,
              a.total_realisasi_fisik_6  - a.total_target_fisik_6  AS total_deviasi_fisik_6 ,
              a.total_realisasi_fisik_7  - a.total_target_fisik_7  AS total_deviasi_fisik_7 ,
              a.total_realisasi_fisik_8  - a.total_target_fisik_8  AS total_deviasi_fisik_8 ,
              a.total_realisasi_fisik_9  - a.total_target_fisik_9  AS total_deviasi_fisik_9 ,
              a.total_realisasi_fisik_10 - a.total_target_fisik_10 AS total_deviasi_fisik_10,
              a.total_realisasi_fisik_11 - a.total_target_fisik_11 AS total_deviasi_fisik_11,
              a.total_realisasi_fisik_12 - a.total_target_fisik_12 AS total_deviasi_fisik_12,

              a.total_realisasi_keuangan_persen_1  - a.total_target_keuangan_persen_1  AS total_deviasi_keuangan_persen_1 ,
              a.total_realisasi_keuangan_persen_2  - a.total_target_keuangan_persen_2  AS total_deviasi_keuangan_persen_2 ,
              a.total_realisasi_keuangan_persen_3  - a.total_target_keuangan_persen_3  AS total_deviasi_keuangan_persen_3 ,
              a.total_realisasi_keuangan_persen_4  - a.total_target_keuangan_persen_4  AS total_deviasi_keuangan_persen_4 ,
              a.total_realisasi_keuangan_persen_5  - a.total_target_keuangan_persen_5  AS total_deviasi_keuangan_persen_5 ,
              a.total_realisasi_keuangan_persen_6  - a.total_target_keuangan_persen_6  AS total_deviasi_keuangan_persen_6 ,
              a.total_realisasi_keuangan_persen_7  - a.total_target_keuangan_persen_7  AS total_deviasi_keuangan_persen_7 ,
              a.total_realisasi_keuangan_persen_8  - a.total_target_keuangan_persen_8  AS total_deviasi_keuangan_persen_8 ,
              a.total_realisasi_keuangan_persen_9  - a.total_target_keuangan_persen_9  AS total_deviasi_keuangan_persen_9 ,
              a.total_realisasi_keuangan_persen_10 - a.total_target_keuangan_persen_10 AS total_deviasi_keuangan_persen_10,
              a.total_realisasi_keuangan_persen_11 - a.total_target_keuangan_persen_11 AS total_deviasi_keuangan_persen_11,
              a.total_realisasi_keuangan_persen_12 - a.total_target_keuangan_persen_12 AS total_deviasi_keuangan_persen_12  

            FROM realisasi_anggaran_pd_total AS a;

            SELECT * FROM realisasi_anggaran_pd_total_deviasi
            WHERE 
            kode_pd <> "4.04.100" AND
            kode_pd <> "4.01.100" AND
            kode_pd <> "4.01.200" AND
            kode_pd <> "4.01.300"
      ';
      $sql_arr = explode(';', $sql_str);
      foreach ($sql_arr as $sql){
        $query = $this->db->query($sql);
      }
      $tabel_kota = $query->result_array();         
      return $tabel_kota;      
    }


function get_daftar_pd_dinas($tahun_anggaran)
    {
      $sql_str = '

            # TABEL PD --> anggaran dan realisasi

            # total anggaran
            DROP TEMPORARY TABLE IF EXISTS total_anggaran_pd;
            CREATE TEMPORARY TABLE total_anggaran_pd AS
            SELECT 
              d.kode_pd,
              d.nama_pd,
              d.nip_kepala,
              e.nama_p AS nama_kepala,
              e.jabat_p AS jabatan_kepala,
              e.foto_p AS foto_kepala,
              d.kode_prog_btl,
              d.kode_giat_btl,
              SUM(a.pagu_giat) AS anggaran_total
            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            LEFT JOIN pejabat AS e ON d.nip_kepala = e.nip_p
            WHERE d.jenis_pd = "Dinas" OR d.jenis_pd = "Badan" OR d.jenis_pd = "Lembaga Teknis"
            GROUP BY c.kode_pd
            ORDER BY c.kode_pd ASC;

            # total anggaran BL

            DROP TEMPORARY TABLE IF EXISTS total_anggaran_pd_bl;
            CREATE TEMPORARY TABLE total_anggaran_pd_bl AS
            SELECT 
              e.*,
              SUM(IF(b.kode_giat <> e.kode_giat_btl,a.pagu_giat,0)) AS anggaran_total_bl,
              SUM(IF(b.kode_giat = e.kode_giat_btl,a.pagu_giat,0)) AS anggaran_total_btl
            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN total_anggaran_pd AS e ON c.kode_pd = e.kode_pd
            # WHERE b.kode_giat <> e.kode_giat_btl 
            WHERE d.jenis_pd = "Dinas" OR d.jenis_pd = "Badan" OR d.jenis_pd = "Lembaga Teknis"
            GROUP BY c.kode_pd
            ORDER BY c.kode_pd ASC;

            # realisasi BL

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_bl;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_bl AS
            SELECT 
              e.*,

              # fisik
              d.tf_1  AS bl_target_fisik_1 ,
              d.tf_2  AS bl_target_fisik_2 ,
              d.tf_3  AS bl_target_fisik_3 ,
              d.tf_4  AS bl_target_fisik_4 ,
              d.tf_5  AS bl_target_fisik_5 ,
              d.tf_6  AS bl_target_fisik_6 ,
              d.tf_7  AS bl_target_fisik_7 ,
              d.tf_8  AS bl_target_fisik_8 ,
              d.tf_9  AS bl_target_fisik_9 ,
              d.tf_10 AS bl_target_fisik_10,
              d.tf_11 AS bl_target_fisik_11,
              d.tf_12 AS bl_target_fisik_12,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_1 ),0) AS bl_realisasi_fisik_1 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_2 ),0) AS bl_realisasi_fisik_2 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_3 ),0) AS bl_realisasi_fisik_3 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_4 ),0) AS bl_realisasi_fisik_4 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_5 ),0) AS bl_realisasi_fisik_5 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_6 ),0) AS bl_realisasi_fisik_6 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_7 ),0) AS bl_realisasi_fisik_7 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_8 ),0) AS bl_realisasi_fisik_8 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_9 ),0) AS bl_realisasi_fisik_9 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_10),0) AS bl_realisasi_fisik_10,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_11),0) AS bl_realisasi_fisik_11,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_12),0) AS bl_realisasi_fisik_12,

              # keuangan
              d.tk_1  AS bl_target_keuangan_1 ,
              d.tk_2  AS bl_target_keuangan_2 ,
              d.tk_3  AS bl_target_keuangan_3 ,
              d.tk_4  AS bl_target_keuangan_4 ,
              d.tk_5  AS bl_target_keuangan_5 ,
              d.tk_6  AS bl_target_keuangan_6 ,
              d.tk_7  AS bl_target_keuangan_7 ,
              d.tk_8  AS bl_target_keuangan_8 ,
              d.tk_9  AS bl_target_keuangan_9 ,
              d.tk_10 AS bl_target_keuangan_10,
              d.tk_11 AS bl_target_keuangan_11,
              d.tk_12 AS bl_target_keuangan_12,
              IFNULL((d.tk_1 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_1 ,
              IFNULL((d.tk_2 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_2 ,
              IFNULL((d.tk_3 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_3 ,
              IFNULL((d.tk_4 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_4 ,
              IFNULL((d.tk_5 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_5 ,
              IFNULL((d.tk_6 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_6 ,
              IFNULL((d.tk_7 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_7 ,
              IFNULL((d.tk_8 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_8 ,
              IFNULL((d.tk_9 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_9 ,
              IFNULL((d.tk_10/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_10,
              IFNULL((d.tk_11/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_11,
              IFNULL((d.tk_12/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_12,  
              SUM(a.kk_1 ) AS bl_realisasi_keuangan_1 ,
              SUM(a.kk_2 ) AS bl_realisasi_keuangan_2 ,
              SUM(a.kk_3 ) AS bl_realisasi_keuangan_3 ,
              SUM(a.kk_4 ) AS bl_realisasi_keuangan_4 ,
              SUM(a.kk_5 ) AS bl_realisasi_keuangan_5 ,
              SUM(a.kk_6 ) AS bl_realisasi_keuangan_6 ,
              SUM(a.kk_7 ) AS bl_realisasi_keuangan_7 ,
              SUM(a.kk_8 ) AS bl_realisasi_keuangan_8 ,
              SUM(a.kk_9 ) AS bl_realisasi_keuangan_9 ,
              SUM(a.kk_10) AS bl_realisasi_keuangan_10,
              SUM(a.kk_11) AS bl_realisasi_keuangan_11,
              SUM(a.kk_12) AS bl_realisasi_keuangan_12,
              IFNULL((SUM(a.kk_1 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_1 ,
              IFNULL((SUM(a.kk_2 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_2 ,
              IFNULL((SUM(a.kk_3 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_3 ,
              IFNULL((SUM(a.kk_4 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_4 ,
              IFNULL((SUM(a.kk_5 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_5 ,
              IFNULL((SUM(a.kk_6 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_6 ,
              IFNULL((SUM(a.kk_7 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_7 ,
              IFNULL((SUM(a.kk_8 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_8 ,
              IFNULL((SUM(a.kk_9 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_9 ,
              IFNULL((SUM(a.kk_10)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_10,
              IFNULL((SUM(a.kk_11)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_11,
              IFNULL((SUM(a.kk_12)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_12  

            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN total_anggaran_pd_bl AS e ON c.kode_pd = e.kode_pd 
            WHERE d.jenis_pd = "Dinas" OR d.jenis_pd = "Badan" OR d.jenis_pd = "Lembaga Teknis"
            GROUP BY e.kode_pd
            ORDER BY e.kode_pd ASC;


            # tambahkan realisasi BTL

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_bl_btl;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_bl_btl AS
            SELECT 
              e.*,

              # fisik
              d.btl_tf_1  AS btl_target_fisik_1 ,
              d.btl_tf_2  AS btl_target_fisik_2 ,
              d.btl_tf_3  AS btl_target_fisik_3 ,
              d.btl_tf_4  AS btl_target_fisik_4 ,
              d.btl_tf_5  AS btl_target_fisik_5 ,
              d.btl_tf_6  AS btl_target_fisik_6 ,
              d.btl_tf_7  AS btl_target_fisik_7 ,
              d.btl_tf_8  AS btl_target_fisik_8 ,
              d.btl_tf_9  AS btl_target_fisik_9 ,
              d.btl_tf_10 AS btl_target_fisik_10,
              d.btl_tf_11 AS btl_target_fisik_11,
              d.btl_tf_12 AS btl_target_fisik_12,
              d.btl_rf_1  AS btl_realisasi_fisik_1 ,
              d.btl_rf_2  AS btl_realisasi_fisik_2 ,
              d.btl_rf_3  AS btl_realisasi_fisik_3 ,
              d.btl_rf_4  AS btl_realisasi_fisik_4 ,
              d.btl_rf_5  AS btl_realisasi_fisik_5 ,
              d.btl_rf_6  AS btl_realisasi_fisik_6 ,
              d.btl_rf_7  AS btl_realisasi_fisik_7 ,
              d.btl_rf_8  AS btl_realisasi_fisik_8 ,
              d.btl_rf_9  AS btl_realisasi_fisik_9 ,
              d.btl_rf_10 AS btl_realisasi_fisik_10,
              d.btl_rf_11 AS btl_realisasi_fisik_11,
              d.btl_rf_12 AS btl_realisasi_fisik_12,

              # keuangan
              d.btl_tk_1  AS btl_target_keuangan_1 ,
              d.btl_tk_2  AS btl_target_keuangan_2 ,
              d.btl_tk_3  AS btl_target_keuangan_3 ,
              d.btl_tk_4  AS btl_target_keuangan_4 ,
              d.btl_tk_5  AS btl_target_keuangan_5 ,
              d.btl_tk_6  AS btl_target_keuangan_6 ,
              d.btl_tk_7  AS btl_target_keuangan_7 ,
              d.btl_tk_8  AS btl_target_keuangan_8 ,
              d.btl_tk_9  AS btl_target_keuangan_9 ,
              d.btl_tk_10 AS btl_target_keuangan_10,
              d.btl_tk_11 AS btl_target_keuangan_11,
              d.btl_tk_12 AS btl_target_keuangan_12,
              IFNULL((d.btl_tk_1 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_1 ,
              IFNULL((d.btl_tk_2 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_2 ,
              IFNULL((d.btl_tk_3 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_3 ,
              IFNULL((d.btl_tk_4 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_4 ,
              IFNULL((d.btl_tk_5 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_5 ,
              IFNULL((d.btl_tk_6 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_6 ,
              IFNULL((d.btl_tk_7 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_7 ,
              IFNULL((d.btl_tk_8 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_8 ,
              IFNULL((d.btl_tk_9 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_9 ,
              IFNULL((d.btl_tk_10/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_10,
              IFNULL((d.btl_tk_11/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_11,
              IFNULL((d.btl_tk_12/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_12,  
              d.btl_rk_1  AS btl_realisasi_keuangan_1 ,
              d.btl_rk_2  AS btl_realisasi_keuangan_2 ,
              d.btl_rk_3  AS btl_realisasi_keuangan_3 ,
              d.btl_rk_4  AS btl_realisasi_keuangan_4 ,
              d.btl_rk_5  AS btl_realisasi_keuangan_5 ,
              d.btl_rk_6  AS btl_realisasi_keuangan_6 ,
              d.btl_rk_7  AS btl_realisasi_keuangan_7 ,
              d.btl_rk_8  AS btl_realisasi_keuangan_8 ,
              d.btl_rk_9  AS btl_realisasi_keuangan_9 ,
              d.btl_rk_10 AS btl_realisasi_keuangan_10,
              d.btl_rk_11 AS btl_realisasi_keuangan_11,
              d.btl_rk_12 AS btl_realisasi_keuangan_12,
              IFNULL((d.btl_rk_1 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_1 ,
              IFNULL((d.btl_rk_2 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_2 ,
              IFNULL((d.btl_rk_3 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_3 ,
              IFNULL((d.btl_rk_4 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_4 ,
              IFNULL((d.btl_rk_5 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_5 ,
              IFNULL((d.btl_rk_6 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_6 ,
              IFNULL((d.btl_rk_7 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_7 ,
              IFNULL((d.btl_rk_8 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_8 ,
              IFNULL((d.btl_rk_9 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_9 ,
              IFNULL((d.btl_rk_10/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_10,
              IFNULL((d.btl_rk_11/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_11,
              IFNULL((d.btl_rk_12/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_12  

            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN realisasi_anggaran_pd_bl AS e ON c.kode_pd = e.kode_pd 
            WHERE d.jenis_pd = "Dinas" OR d.jenis_pd = "Badan" OR d.jenis_pd = "Lembaga Teknis"
            GROUP BY e.kode_pd
            ORDER BY e.kode_pd ASC;


            # realisasi total

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_total;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_total AS
            SELECT 
              a.*,
              # fisik
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_1 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_1 ), 0) AS total_target_fisik_1 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_2 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_2 ), 0) AS total_target_fisik_2 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_3 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_3 ), 0) AS total_target_fisik_3 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_4 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_4 ), 0) AS total_target_fisik_4 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_5 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_5 ), 0) AS total_target_fisik_5 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_6 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_6 ), 0) AS total_target_fisik_6 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_7 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_7 ), 0) AS total_target_fisik_7 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_8 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_8 ), 0) AS total_target_fisik_8 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_9 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_9 ), 0) AS total_target_fisik_9 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_10), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_10), 0) AS total_target_fisik_10,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_11), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_11), 0) AS total_target_fisik_11,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_12), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_12), 0) AS total_target_fisik_12,

              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_1 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_1 ), 0) AS total_realisasi_fisik_1 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_2 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_2 ), 0) AS total_realisasi_fisik_2 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_3 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_3 ), 0) AS total_realisasi_fisik_3 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_4 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_4 ), 0) AS total_realisasi_fisik_4 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_5 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_5 ), 0) AS total_realisasi_fisik_5 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_6 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_6 ), 0) AS total_realisasi_fisik_6 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_7 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_7 ), 0) AS total_realisasi_fisik_7 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_8 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_8 ), 0) AS total_realisasi_fisik_8 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_9 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_9 ), 0) AS total_realisasi_fisik_9 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_10), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_10), 0) AS total_realisasi_fisik_10,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_11), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_11), 0) AS total_realisasi_fisik_11,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_12), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_12), 0) AS total_realisasi_fisik_12,

              IFNULL(a.bl_target_keuangan_1 ,0) + IFNULL(a.btl_target_keuangan_1 ,0) AS total_target_keuangan_1 ,
              IFNULL(a.bl_target_keuangan_2 ,0) + IFNULL(a.btl_target_keuangan_2 ,0) AS total_target_keuangan_2 ,
              IFNULL(a.bl_target_keuangan_3 ,0) + IFNULL(a.btl_target_keuangan_3 ,0) AS total_target_keuangan_3 ,
              IFNULL(a.bl_target_keuangan_4 ,0) + IFNULL(a.btl_target_keuangan_4 ,0) AS total_target_keuangan_4 ,
              IFNULL(a.bl_target_keuangan_5 ,0) + IFNULL(a.btl_target_keuangan_5 ,0) AS total_target_keuangan_5 ,
              IFNULL(a.bl_target_keuangan_6 ,0) + IFNULL(a.btl_target_keuangan_6 ,0) AS total_target_keuangan_6 ,
              IFNULL(a.bl_target_keuangan_7 ,0) + IFNULL(a.btl_target_keuangan_7 ,0) AS total_target_keuangan_7 ,
              IFNULL(a.bl_target_keuangan_8 ,0) + IFNULL(a.btl_target_keuangan_8 ,0) AS total_target_keuangan_8 ,
              IFNULL(a.bl_target_keuangan_9 ,0) + IFNULL(a.btl_target_keuangan_9 ,0) AS total_target_keuangan_9 ,
              IFNULL(a.bl_target_keuangan_10,0) + IFNULL(a.btl_target_keuangan_10,0) AS total_target_keuangan_10,
              IFNULL(a.bl_target_keuangan_11,0) + IFNULL(a.btl_target_keuangan_11,0) AS total_target_keuangan_11,
              IFNULL(a.bl_target_keuangan_12,0) + IFNULL(a.btl_target_keuangan_12,0) AS total_target_keuangan_12,

              IFNULL(((a.bl_target_keuangan_1  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_1  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_1 ,
              IFNULL(((a.bl_target_keuangan_2  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_2  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_2 ,
              IFNULL(((a.bl_target_keuangan_3  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_3  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_3 ,
              IFNULL(((a.bl_target_keuangan_4  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_4  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_4 ,
              IFNULL(((a.bl_target_keuangan_5  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_5  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_5 ,
              IFNULL(((a.bl_target_keuangan_6  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_6  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_6 ,
              IFNULL(((a.bl_target_keuangan_7  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_7  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_7 ,
              IFNULL(((a.bl_target_keuangan_8  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_8  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_8 ,
              IFNULL(((a.bl_target_keuangan_9  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_9  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_9 ,
              IFNULL(((a.bl_target_keuangan_10 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_10 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_10,
              IFNULL(((a.bl_target_keuangan_11 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_11 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_11,
              IFNULL(((a.bl_target_keuangan_12 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_12 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_12,

              IFNULL(a.bl_realisasi_keuangan_1 ,0) + IFNULL(a.btl_realisasi_keuangan_1 ,0) AS total_realisasi_keuangan_1 ,
              IFNULL(a.bl_realisasi_keuangan_2 ,0) + IFNULL(a.btl_realisasi_keuangan_2 ,0) AS total_realisasi_keuangan_2 ,
              IFNULL(a.bl_realisasi_keuangan_3 ,0) + IFNULL(a.btl_realisasi_keuangan_3 ,0) AS total_realisasi_keuangan_3 ,
              IFNULL(a.bl_realisasi_keuangan_4 ,0) + IFNULL(a.btl_realisasi_keuangan_4 ,0) AS total_realisasi_keuangan_4 ,
              IFNULL(a.bl_realisasi_keuangan_5 ,0) + IFNULL(a.btl_realisasi_keuangan_5 ,0) AS total_realisasi_keuangan_5 ,
              IFNULL(a.bl_realisasi_keuangan_6 ,0) + IFNULL(a.btl_realisasi_keuangan_6 ,0) AS total_realisasi_keuangan_6 ,
              IFNULL(a.bl_realisasi_keuangan_7 ,0) + IFNULL(a.btl_realisasi_keuangan_7 ,0) AS total_realisasi_keuangan_7 ,
              IFNULL(a.bl_realisasi_keuangan_8 ,0) + IFNULL(a.btl_realisasi_keuangan_8 ,0) AS total_realisasi_keuangan_8 ,
              IFNULL(a.bl_realisasi_keuangan_9 ,0) + IFNULL(a.btl_realisasi_keuangan_9 ,0) AS total_realisasi_keuangan_9 ,
              IFNULL(a.bl_realisasi_keuangan_10,0) + IFNULL(a.btl_realisasi_keuangan_10,0) AS total_realisasi_keuangan_10,
              IFNULL(a.bl_realisasi_keuangan_11,0) + IFNULL(a.btl_realisasi_keuangan_11,0) AS total_realisasi_keuangan_11,
              IFNULL(a.bl_realisasi_keuangan_12,0) + IFNULL(a.btl_realisasi_keuangan_12,0) AS total_realisasi_keuangan_12,

              IFNULL(((a.bl_realisasi_keuangan_1  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_1  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_1 ,
              IFNULL(((a.bl_realisasi_keuangan_2  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_2  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_2 ,
              IFNULL(((a.bl_realisasi_keuangan_3  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_3  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_3 ,
              IFNULL(((a.bl_realisasi_keuangan_4  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_4  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_4 ,
              IFNULL(((a.bl_realisasi_keuangan_5  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_5  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_5 ,
              IFNULL(((a.bl_realisasi_keuangan_6  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_6  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_6 ,
              IFNULL(((a.bl_realisasi_keuangan_7  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_7  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_7 ,
              IFNULL(((a.bl_realisasi_keuangan_8  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_8  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_8 ,
              IFNULL(((a.bl_realisasi_keuangan_9  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_9  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_9 ,
              IFNULL(((a.bl_realisasi_keuangan_10 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_10 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_10,
              IFNULL(((a.bl_realisasi_keuangan_11 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_11 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_11,
              IFNULL(((a.bl_realisasi_keuangan_12 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_12 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_12

            FROM realisasi_anggaran_pd_bl_btl AS a;

            # hitung deviasi

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_total_deviasi;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_total_deviasi AS
            SELECT 
              a.*,

              # deviasi

              a.bl_realisasi_fisik_1  - a.bl_target_fisik_1  AS bl_deviasi_fisik_1 ,
              a.bl_realisasi_fisik_2  - a.bl_target_fisik_2  AS bl_deviasi_fisik_2 ,
              a.bl_realisasi_fisik_3  - a.bl_target_fisik_3  AS bl_deviasi_fisik_3 ,
              a.bl_realisasi_fisik_4  - a.bl_target_fisik_4  AS bl_deviasi_fisik_4 ,
              a.bl_realisasi_fisik_5  - a.bl_target_fisik_5  AS bl_deviasi_fisik_5 ,
              a.bl_realisasi_fisik_6  - a.bl_target_fisik_6  AS bl_deviasi_fisik_6 ,
              a.bl_realisasi_fisik_7  - a.bl_target_fisik_7  AS bl_deviasi_fisik_7 ,
              a.bl_realisasi_fisik_8  - a.bl_target_fisik_8  AS bl_deviasi_fisik_8 ,
              a.bl_realisasi_fisik_9  - a.bl_target_fisik_9  AS bl_deviasi_fisik_9 ,
              a.bl_realisasi_fisik_10 - a.bl_target_fisik_10 AS bl_deviasi_fisik_10,
              a.bl_realisasi_fisik_11 - a.bl_target_fisik_11 AS bl_deviasi_fisik_11,
              a.bl_realisasi_fisik_12 - a.bl_target_fisik_12 AS bl_deviasi_fisik_12,

              a.bl_realisasi_keuangan_persen_1  - a.bl_target_keuangan_persen_1  AS bl_deviasi_keuangan_persen_1 ,
              a.bl_realisasi_keuangan_persen_2  - a.bl_target_keuangan_persen_2  AS bl_deviasi_keuangan_persen_2 ,
              a.bl_realisasi_keuangan_persen_3  - a.bl_target_keuangan_persen_3  AS bl_deviasi_keuangan_persen_3 ,
              a.bl_realisasi_keuangan_persen_4  - a.bl_target_keuangan_persen_4  AS bl_deviasi_keuangan_persen_4 ,
              a.bl_realisasi_keuangan_persen_5  - a.bl_target_keuangan_persen_5  AS bl_deviasi_keuangan_persen_5 ,
              a.bl_realisasi_keuangan_persen_6  - a.bl_target_keuangan_persen_6  AS bl_deviasi_keuangan_persen_6 ,
              a.bl_realisasi_keuangan_persen_7  - a.bl_target_keuangan_persen_7  AS bl_deviasi_keuangan_persen_7 ,
              a.bl_realisasi_keuangan_persen_8  - a.bl_target_keuangan_persen_8  AS bl_deviasi_keuangan_persen_8 ,
              a.bl_realisasi_keuangan_persen_9  - a.bl_target_keuangan_persen_9  AS bl_deviasi_keuangan_persen_9 ,
              a.bl_realisasi_keuangan_persen_10 - a.bl_target_keuangan_persen_10 AS bl_deviasi_keuangan_persen_10,
              a.bl_realisasi_keuangan_persen_11 - a.bl_target_keuangan_persen_11 AS bl_deviasi_keuangan_persen_11,
              a.bl_realisasi_keuangan_persen_12 - a.bl_target_keuangan_persen_12 AS bl_deviasi_keuangan_persen_12,

              a.btl_realisasi_fisik_1  - a.btl_target_fisik_1  AS btl_deviasi_fisik_1 ,
              a.btl_realisasi_fisik_2  - a.btl_target_fisik_2  AS btl_deviasi_fisik_2 ,
              a.btl_realisasi_fisik_3  - a.btl_target_fisik_3  AS btl_deviasi_fisik_3 ,
              a.btl_realisasi_fisik_4  - a.btl_target_fisik_4  AS btl_deviasi_fisik_4 ,
              a.btl_realisasi_fisik_5  - a.btl_target_fisik_5  AS btl_deviasi_fisik_5 ,
              a.btl_realisasi_fisik_6  - a.btl_target_fisik_6  AS btl_deviasi_fisik_6 ,
              a.btl_realisasi_fisik_7  - a.btl_target_fisik_7  AS btl_deviasi_fisik_7 ,
              a.btl_realisasi_fisik_8  - a.btl_target_fisik_8  AS btl_deviasi_fisik_8 ,
              a.btl_realisasi_fisik_9  - a.btl_target_fisik_9  AS btl_deviasi_fisik_9 ,
              a.btl_realisasi_fisik_10 - a.btl_target_fisik_10 AS btl_deviasi_fisik_10,
              a.btl_realisasi_fisik_11 - a.btl_target_fisik_11 AS btl_deviasi_fisik_11,
              a.btl_realisasi_fisik_12 - a.btl_target_fisik_12 AS btl_deviasi_fisik_12,

              a.btl_realisasi_keuangan_persen_1  - a.btl_target_keuangan_persen_1  AS btl_deviasi_keuangan_persen_1 ,
              a.btl_realisasi_keuangan_persen_2  - a.btl_target_keuangan_persen_2  AS btl_deviasi_keuangan_persen_2 ,
              a.btl_realisasi_keuangan_persen_3  - a.btl_target_keuangan_persen_3  AS btl_deviasi_keuangan_persen_3 ,
              a.btl_realisasi_keuangan_persen_4  - a.btl_target_keuangan_persen_4  AS btl_deviasi_keuangan_persen_4 ,
              a.btl_realisasi_keuangan_persen_5  - a.btl_target_keuangan_persen_5  AS btl_deviasi_keuangan_persen_5 ,
              a.btl_realisasi_keuangan_persen_6  - a.btl_target_keuangan_persen_6  AS btl_deviasi_keuangan_persen_6 ,
              a.btl_realisasi_keuangan_persen_7  - a.btl_target_keuangan_persen_7  AS btl_deviasi_keuangan_persen_7 ,
              a.btl_realisasi_keuangan_persen_8  - a.btl_target_keuangan_persen_8  AS btl_deviasi_keuangan_persen_8 ,
              a.btl_realisasi_keuangan_persen_9  - a.btl_target_keuangan_persen_9  AS btl_deviasi_keuangan_persen_9 ,
              a.btl_realisasi_keuangan_persen_10 - a.btl_target_keuangan_persen_10 AS btl_deviasi_keuangan_persen_10,
              a.btl_realisasi_keuangan_persen_11 - a.btl_target_keuangan_persen_11 AS btl_deviasi_keuangan_persen_11,
              a.btl_realisasi_keuangan_persen_12 - a.btl_target_keuangan_persen_12 AS btl_deviasi_keuangan_persen_12,  

              a.total_realisasi_fisik_1  - a.total_target_fisik_1  AS total_deviasi_fisik_1 ,
              a.total_realisasi_fisik_2  - a.total_target_fisik_2  AS total_deviasi_fisik_2 ,
              a.total_realisasi_fisik_3  - a.total_target_fisik_3  AS total_deviasi_fisik_3 ,
              a.total_realisasi_fisik_4  - a.total_target_fisik_4  AS total_deviasi_fisik_4 ,
              a.total_realisasi_fisik_5  - a.total_target_fisik_5  AS total_deviasi_fisik_5 ,
              a.total_realisasi_fisik_6  - a.total_target_fisik_6  AS total_deviasi_fisik_6 ,
              a.total_realisasi_fisik_7  - a.total_target_fisik_7  AS total_deviasi_fisik_7 ,
              a.total_realisasi_fisik_8  - a.total_target_fisik_8  AS total_deviasi_fisik_8 ,
              a.total_realisasi_fisik_9  - a.total_target_fisik_9  AS total_deviasi_fisik_9 ,
              a.total_realisasi_fisik_10 - a.total_target_fisik_10 AS total_deviasi_fisik_10,
              a.total_realisasi_fisik_11 - a.total_target_fisik_11 AS total_deviasi_fisik_11,
              a.total_realisasi_fisik_12 - a.total_target_fisik_12 AS total_deviasi_fisik_12,

              a.total_realisasi_keuangan_persen_1  - a.total_target_keuangan_persen_1  AS total_deviasi_keuangan_persen_1 ,
              a.total_realisasi_keuangan_persen_2  - a.total_target_keuangan_persen_2  AS total_deviasi_keuangan_persen_2 ,
              a.total_realisasi_keuangan_persen_3  - a.total_target_keuangan_persen_3  AS total_deviasi_keuangan_persen_3 ,
              a.total_realisasi_keuangan_persen_4  - a.total_target_keuangan_persen_4  AS total_deviasi_keuangan_persen_4 ,
              a.total_realisasi_keuangan_persen_5  - a.total_target_keuangan_persen_5  AS total_deviasi_keuangan_persen_5 ,
              a.total_realisasi_keuangan_persen_6  - a.total_target_keuangan_persen_6  AS total_deviasi_keuangan_persen_6 ,
              a.total_realisasi_keuangan_persen_7  - a.total_target_keuangan_persen_7  AS total_deviasi_keuangan_persen_7 ,
              a.total_realisasi_keuangan_persen_8  - a.total_target_keuangan_persen_8  AS total_deviasi_keuangan_persen_8 ,
              a.total_realisasi_keuangan_persen_9  - a.total_target_keuangan_persen_9  AS total_deviasi_keuangan_persen_9 ,
              a.total_realisasi_keuangan_persen_10 - a.total_target_keuangan_persen_10 AS total_deviasi_keuangan_persen_10,
              a.total_realisasi_keuangan_persen_11 - a.total_target_keuangan_persen_11 AS total_deviasi_keuangan_persen_11,
              a.total_realisasi_keuangan_persen_12 - a.total_target_keuangan_persen_12 AS total_deviasi_keuangan_persen_12  

            FROM realisasi_anggaran_pd_total AS a;

            SELECT * FROM realisasi_anggaran_pd_total_deviasi
            WHERE 
            kode_pd <> "4.04.100" AND
            kode_pd <> "4.01.100" AND
            kode_pd <> "4.01.200" AND
            kode_pd <> "4.01.300"
      ';
      $sql_arr = explode(';', $sql_str);
      foreach ($sql_arr as $sql){
        $query = $this->db->query($sql);
      }
      $tabel_kota = $query->result_array();         
      return $tabel_kota;      
    }

function get_daftar_pd_setda($tahun_anggaran)
    {
      $sql_str = '

            # TABEL PD --> anggaran dan realisasi

            # total anggaran
            DROP TEMPORARY TABLE IF EXISTS total_anggaran_pd;
            CREATE TEMPORARY TABLE total_anggaran_pd AS
            SELECT 
              d.kode_pd,
              d.nama_pd,
              d.nip_kepala,
              e.nama_p AS nama_kepala,
              e.jabat_p AS jabatan_kepala,
              e.foto_p AS foto_kepala,
              d.kode_prog_btl,
              d.kode_giat_btl,
              SUM(a.pagu_giat) AS anggaran_total
            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            LEFT JOIN pejabat AS e ON d.nip_kepala = e.nip_p
            WHERE d.jenis_pd = "Setda" OR d.jenis_pd = "Bagian" 
            GROUP BY c.kode_pd
            ORDER BY c.kode_pd ASC;

            # total anggaran BL

            DROP TEMPORARY TABLE IF EXISTS total_anggaran_pd_bl;
            CREATE TEMPORARY TABLE total_anggaran_pd_bl AS
            SELECT 
              e.*,
              SUM(IF(b.kode_giat <> e.kode_giat_btl,a.pagu_giat,0)) AS anggaran_total_bl,
              SUM(IF(b.kode_giat = e.kode_giat_btl,a.pagu_giat,0)) AS anggaran_total_btl
            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN total_anggaran_pd AS e ON c.kode_pd = e.kode_pd
            # WHERE b.kode_giat <> e.kode_giat_btl 
            WHERE d.jenis_pd = "Setda" OR d.jenis_pd = "Bagian"
            GROUP BY c.kode_pd
            ORDER BY c.kode_pd ASC;

            # realisasi BL

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_bl;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_bl AS
            SELECT 
              e.*,

              # fisik
              d.tf_1  AS bl_target_fisik_1 ,
              d.tf_2  AS bl_target_fisik_2 ,
              d.tf_3  AS bl_target_fisik_3 ,
              d.tf_4  AS bl_target_fisik_4 ,
              d.tf_5  AS bl_target_fisik_5 ,
              d.tf_6  AS bl_target_fisik_6 ,
              d.tf_7  AS bl_target_fisik_7 ,
              d.tf_8  AS bl_target_fisik_8 ,
              d.tf_9  AS bl_target_fisik_9 ,
              d.tf_10 AS bl_target_fisik_10,
              d.tf_11 AS bl_target_fisik_11,
              d.tf_12 AS bl_target_fisik_12,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_1 ),0) AS bl_realisasi_fisik_1 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_2 ),0) AS bl_realisasi_fisik_2 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_3 ),0) AS bl_realisasi_fisik_3 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_4 ),0) AS bl_realisasi_fisik_4 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_5 ),0) AS bl_realisasi_fisik_5 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_6 ),0) AS bl_realisasi_fisik_6 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_7 ),0) AS bl_realisasi_fisik_7 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_8 ),0) AS bl_realisasi_fisik_8 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_9 ),0) AS bl_realisasi_fisik_9 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_10),0) AS bl_realisasi_fisik_10,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_11),0) AS bl_realisasi_fisik_11,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_12),0) AS bl_realisasi_fisik_12,

              # keuangan
              d.tk_1  AS bl_target_keuangan_1 ,
              d.tk_2  AS bl_target_keuangan_2 ,
              d.tk_3  AS bl_target_keuangan_3 ,
              d.tk_4  AS bl_target_keuangan_4 ,
              d.tk_5  AS bl_target_keuangan_5 ,
              d.tk_6  AS bl_target_keuangan_6 ,
              d.tk_7  AS bl_target_keuangan_7 ,
              d.tk_8  AS bl_target_keuangan_8 ,
              d.tk_9  AS bl_target_keuangan_9 ,
              d.tk_10 AS bl_target_keuangan_10,
              d.tk_11 AS bl_target_keuangan_11,
              d.tk_12 AS bl_target_keuangan_12,
              IFNULL((d.tk_1 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_1 ,
              IFNULL((d.tk_2 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_2 ,
              IFNULL((d.tk_3 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_3 ,
              IFNULL((d.tk_4 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_4 ,
              IFNULL((d.tk_5 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_5 ,
              IFNULL((d.tk_6 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_6 ,
              IFNULL((d.tk_7 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_7 ,
              IFNULL((d.tk_8 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_8 ,
              IFNULL((d.tk_9 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_9 ,
              IFNULL((d.tk_10/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_10,
              IFNULL((d.tk_11/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_11,
              IFNULL((d.tk_12/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_12,  
              SUM(a.kk_1 ) AS bl_realisasi_keuangan_1 ,
              SUM(a.kk_2 ) AS bl_realisasi_keuangan_2 ,
              SUM(a.kk_3 ) AS bl_realisasi_keuangan_3 ,
              SUM(a.kk_4 ) AS bl_realisasi_keuangan_4 ,
              SUM(a.kk_5 ) AS bl_realisasi_keuangan_5 ,
              SUM(a.kk_6 ) AS bl_realisasi_keuangan_6 ,
              SUM(a.kk_7 ) AS bl_realisasi_keuangan_7 ,
              SUM(a.kk_8 ) AS bl_realisasi_keuangan_8 ,
              SUM(a.kk_9 ) AS bl_realisasi_keuangan_9 ,
              SUM(a.kk_10) AS bl_realisasi_keuangan_10,
              SUM(a.kk_11) AS bl_realisasi_keuangan_11,
              SUM(a.kk_12) AS bl_realisasi_keuangan_12,
              IFNULL((SUM(a.kk_1 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_1 ,
              IFNULL((SUM(a.kk_2 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_2 ,
              IFNULL((SUM(a.kk_3 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_3 ,
              IFNULL((SUM(a.kk_4 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_4 ,
              IFNULL((SUM(a.kk_5 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_5 ,
              IFNULL((SUM(a.kk_6 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_6 ,
              IFNULL((SUM(a.kk_7 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_7 ,
              IFNULL((SUM(a.kk_8 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_8 ,
              IFNULL((SUM(a.kk_9 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_9 ,
              IFNULL((SUM(a.kk_10)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_10,
              IFNULL((SUM(a.kk_11)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_11,
              IFNULL((SUM(a.kk_12)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_12  

            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN total_anggaran_pd_bl AS e ON c.kode_pd = e.kode_pd 
            WHERE d.jenis_pd = "Setda" OR d.jenis_pd = "Bagian"
            GROUP BY e.kode_pd
            ORDER BY e.kode_pd ASC;


            # tambahkan realisasi BTL

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_bl_btl;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_bl_btl AS
            SELECT 
              e.*,

              # fisik
              d.btl_tf_1  AS btl_target_fisik_1 ,
              d.btl_tf_2  AS btl_target_fisik_2 ,
              d.btl_tf_3  AS btl_target_fisik_3 ,
              d.btl_tf_4  AS btl_target_fisik_4 ,
              d.btl_tf_5  AS btl_target_fisik_5 ,
              d.btl_tf_6  AS btl_target_fisik_6 ,
              d.btl_tf_7  AS btl_target_fisik_7 ,
              d.btl_tf_8  AS btl_target_fisik_8 ,
              d.btl_tf_9  AS btl_target_fisik_9 ,
              d.btl_tf_10 AS btl_target_fisik_10,
              d.btl_tf_11 AS btl_target_fisik_11,
              d.btl_tf_12 AS btl_target_fisik_12,
              d.btl_rf_1  AS btl_realisasi_fisik_1 ,
              d.btl_rf_2  AS btl_realisasi_fisik_2 ,
              d.btl_rf_3  AS btl_realisasi_fisik_3 ,
              d.btl_rf_4  AS btl_realisasi_fisik_4 ,
              d.btl_rf_5  AS btl_realisasi_fisik_5 ,
              d.btl_rf_6  AS btl_realisasi_fisik_6 ,
              d.btl_rf_7  AS btl_realisasi_fisik_7 ,
              d.btl_rf_8  AS btl_realisasi_fisik_8 ,
              d.btl_rf_9  AS btl_realisasi_fisik_9 ,
              d.btl_rf_10 AS btl_realisasi_fisik_10,
              d.btl_rf_11 AS btl_realisasi_fisik_11,
              d.btl_rf_12 AS btl_realisasi_fisik_12,

              # keuangan
              d.btl_tk_1  AS btl_target_keuangan_1 ,
              d.btl_tk_2  AS btl_target_keuangan_2 ,
              d.btl_tk_3  AS btl_target_keuangan_3 ,
              d.btl_tk_4  AS btl_target_keuangan_4 ,
              d.btl_tk_5  AS btl_target_keuangan_5 ,
              d.btl_tk_6  AS btl_target_keuangan_6 ,
              d.btl_tk_7  AS btl_target_keuangan_7 ,
              d.btl_tk_8  AS btl_target_keuangan_8 ,
              d.btl_tk_9  AS btl_target_keuangan_9 ,
              d.btl_tk_10 AS btl_target_keuangan_10,
              d.btl_tk_11 AS btl_target_keuangan_11,
              d.btl_tk_12 AS btl_target_keuangan_12,
              IFNULL((d.btl_tk_1 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_1 ,
              IFNULL((d.btl_tk_2 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_2 ,
              IFNULL((d.btl_tk_3 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_3 ,
              IFNULL((d.btl_tk_4 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_4 ,
              IFNULL((d.btl_tk_5 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_5 ,
              IFNULL((d.btl_tk_6 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_6 ,
              IFNULL((d.btl_tk_7 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_7 ,
              IFNULL((d.btl_tk_8 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_8 ,
              IFNULL((d.btl_tk_9 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_9 ,
              IFNULL((d.btl_tk_10/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_10,
              IFNULL((d.btl_tk_11/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_11,
              IFNULL((d.btl_tk_12/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_12,  
              d.btl_rk_1  AS btl_realisasi_keuangan_1 ,
              d.btl_rk_2  AS btl_realisasi_keuangan_2 ,
              d.btl_rk_3  AS btl_realisasi_keuangan_3 ,
              d.btl_rk_4  AS btl_realisasi_keuangan_4 ,
              d.btl_rk_5  AS btl_realisasi_keuangan_5 ,
              d.btl_rk_6  AS btl_realisasi_keuangan_6 ,
              d.btl_rk_7  AS btl_realisasi_keuangan_7 ,
              d.btl_rk_8  AS btl_realisasi_keuangan_8 ,
              d.btl_rk_9  AS btl_realisasi_keuangan_9 ,
              d.btl_rk_10 AS btl_realisasi_keuangan_10,
              d.btl_rk_11 AS btl_realisasi_keuangan_11,
              d.btl_rk_12 AS btl_realisasi_keuangan_12,
              IFNULL((d.btl_rk_1 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_1 ,
              IFNULL((d.btl_rk_2 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_2 ,
              IFNULL((d.btl_rk_3 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_3 ,
              IFNULL((d.btl_rk_4 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_4 ,
              IFNULL((d.btl_rk_5 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_5 ,
              IFNULL((d.btl_rk_6 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_6 ,
              IFNULL((d.btl_rk_7 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_7 ,
              IFNULL((d.btl_rk_8 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_8 ,
              IFNULL((d.btl_rk_9 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_9 ,
              IFNULL((d.btl_rk_10/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_10,
              IFNULL((d.btl_rk_11/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_11,
              IFNULL((d.btl_rk_12/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_12  

            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN realisasi_anggaran_pd_bl AS e ON c.kode_pd = e.kode_pd 
            WHERE d.jenis_pd = "Setda" OR d.jenis_pd = "Bagian"
            GROUP BY e.kode_pd
            ORDER BY e.kode_pd ASC;


            # realisasi total

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_total;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_total AS
            SELECT 
              a.*,
              # fisik
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_1 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_1 ), 0) AS total_target_fisik_1 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_2 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_2 ), 0) AS total_target_fisik_2 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_3 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_3 ), 0) AS total_target_fisik_3 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_4 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_4 ), 0) AS total_target_fisik_4 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_5 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_5 ), 0) AS total_target_fisik_5 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_6 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_6 ), 0) AS total_target_fisik_6 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_7 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_7 ), 0) AS total_target_fisik_7 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_8 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_8 ), 0) AS total_target_fisik_8 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_9 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_9 ), 0) AS total_target_fisik_9 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_10), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_10), 0) AS total_target_fisik_10,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_11), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_11), 0) AS total_target_fisik_11,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_12), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_12), 0) AS total_target_fisik_12,

              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_1 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_1 ), 0) AS total_realisasi_fisik_1 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_2 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_2 ), 0) AS total_realisasi_fisik_2 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_3 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_3 ), 0) AS total_realisasi_fisik_3 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_4 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_4 ), 0) AS total_realisasi_fisik_4 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_5 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_5 ), 0) AS total_realisasi_fisik_5 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_6 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_6 ), 0) AS total_realisasi_fisik_6 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_7 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_7 ), 0) AS total_realisasi_fisik_7 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_8 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_8 ), 0) AS total_realisasi_fisik_8 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_9 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_9 ), 0) AS total_realisasi_fisik_9 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_10), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_10), 0) AS total_realisasi_fisik_10,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_11), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_11), 0) AS total_realisasi_fisik_11,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_12), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_12), 0) AS total_realisasi_fisik_12,

              IFNULL(a.bl_target_keuangan_1 ,0) + IFNULL(a.btl_target_keuangan_1 ,0) AS total_target_keuangan_1 ,
              IFNULL(a.bl_target_keuangan_2 ,0) + IFNULL(a.btl_target_keuangan_2 ,0) AS total_target_keuangan_2 ,
              IFNULL(a.bl_target_keuangan_3 ,0) + IFNULL(a.btl_target_keuangan_3 ,0) AS total_target_keuangan_3 ,
              IFNULL(a.bl_target_keuangan_4 ,0) + IFNULL(a.btl_target_keuangan_4 ,0) AS total_target_keuangan_4 ,
              IFNULL(a.bl_target_keuangan_5 ,0) + IFNULL(a.btl_target_keuangan_5 ,0) AS total_target_keuangan_5 ,
              IFNULL(a.bl_target_keuangan_6 ,0) + IFNULL(a.btl_target_keuangan_6 ,0) AS total_target_keuangan_6 ,
              IFNULL(a.bl_target_keuangan_7 ,0) + IFNULL(a.btl_target_keuangan_7 ,0) AS total_target_keuangan_7 ,
              IFNULL(a.bl_target_keuangan_8 ,0) + IFNULL(a.btl_target_keuangan_8 ,0) AS total_target_keuangan_8 ,
              IFNULL(a.bl_target_keuangan_9 ,0) + IFNULL(a.btl_target_keuangan_9 ,0) AS total_target_keuangan_9 ,
              IFNULL(a.bl_target_keuangan_10,0) + IFNULL(a.btl_target_keuangan_10,0) AS total_target_keuangan_10,
              IFNULL(a.bl_target_keuangan_11,0) + IFNULL(a.btl_target_keuangan_11,0) AS total_target_keuangan_11,
              IFNULL(a.bl_target_keuangan_12,0) + IFNULL(a.btl_target_keuangan_12,0) AS total_target_keuangan_12,

              IFNULL(((a.bl_target_keuangan_1  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_1  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_1 ,
              IFNULL(((a.bl_target_keuangan_2  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_2  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_2 ,
              IFNULL(((a.bl_target_keuangan_3  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_3  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_3 ,
              IFNULL(((a.bl_target_keuangan_4  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_4  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_4 ,
              IFNULL(((a.bl_target_keuangan_5  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_5  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_5 ,
              IFNULL(((a.bl_target_keuangan_6  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_6  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_6 ,
              IFNULL(((a.bl_target_keuangan_7  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_7  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_7 ,
              IFNULL(((a.bl_target_keuangan_8  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_8  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_8 ,
              IFNULL(((a.bl_target_keuangan_9  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_9  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_9 ,
              IFNULL(((a.bl_target_keuangan_10 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_10 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_10,
              IFNULL(((a.bl_target_keuangan_11 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_11 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_11,
              IFNULL(((a.bl_target_keuangan_12 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_12 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_12,

              IFNULL(a.bl_realisasi_keuangan_1 ,0) + IFNULL(a.btl_realisasi_keuangan_1 ,0) AS total_realisasi_keuangan_1 ,
              IFNULL(a.bl_realisasi_keuangan_2 ,0) + IFNULL(a.btl_realisasi_keuangan_2 ,0) AS total_realisasi_keuangan_2 ,
              IFNULL(a.bl_realisasi_keuangan_3 ,0) + IFNULL(a.btl_realisasi_keuangan_3 ,0) AS total_realisasi_keuangan_3 ,
              IFNULL(a.bl_realisasi_keuangan_4 ,0) + IFNULL(a.btl_realisasi_keuangan_4 ,0) AS total_realisasi_keuangan_4 ,
              IFNULL(a.bl_realisasi_keuangan_5 ,0) + IFNULL(a.btl_realisasi_keuangan_5 ,0) AS total_realisasi_keuangan_5 ,
              IFNULL(a.bl_realisasi_keuangan_6 ,0) + IFNULL(a.btl_realisasi_keuangan_6 ,0) AS total_realisasi_keuangan_6 ,
              IFNULL(a.bl_realisasi_keuangan_7 ,0) + IFNULL(a.btl_realisasi_keuangan_7 ,0) AS total_realisasi_keuangan_7 ,
              IFNULL(a.bl_realisasi_keuangan_8 ,0) + IFNULL(a.btl_realisasi_keuangan_8 ,0) AS total_realisasi_keuangan_8 ,
              IFNULL(a.bl_realisasi_keuangan_9 ,0) + IFNULL(a.btl_realisasi_keuangan_9 ,0) AS total_realisasi_keuangan_9 ,
              IFNULL(a.bl_realisasi_keuangan_10,0) + IFNULL(a.btl_realisasi_keuangan_10,0) AS total_realisasi_keuangan_10,
              IFNULL(a.bl_realisasi_keuangan_11,0) + IFNULL(a.btl_realisasi_keuangan_11,0) AS total_realisasi_keuangan_11,
              IFNULL(a.bl_realisasi_keuangan_12,0) + IFNULL(a.btl_realisasi_keuangan_12,0) AS total_realisasi_keuangan_12,

              IFNULL(((a.bl_realisasi_keuangan_1  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_1  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_1 ,
              IFNULL(((a.bl_realisasi_keuangan_2  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_2  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_2 ,
              IFNULL(((a.bl_realisasi_keuangan_3  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_3  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_3 ,
              IFNULL(((a.bl_realisasi_keuangan_4  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_4  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_4 ,
              IFNULL(((a.bl_realisasi_keuangan_5  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_5  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_5 ,
              IFNULL(((a.bl_realisasi_keuangan_6  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_6  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_6 ,
              IFNULL(((a.bl_realisasi_keuangan_7  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_7  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_7 ,
              IFNULL(((a.bl_realisasi_keuangan_8  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_8  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_8 ,
              IFNULL(((a.bl_realisasi_keuangan_9  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_9  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_9 ,
              IFNULL(((a.bl_realisasi_keuangan_10 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_10 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_10,
              IFNULL(((a.bl_realisasi_keuangan_11 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_11 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_11,
              IFNULL(((a.bl_realisasi_keuangan_12 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_12 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_12

            FROM realisasi_anggaran_pd_bl_btl AS a;

            # hitung deviasi

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_total_deviasi;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_total_deviasi AS
            SELECT 
              a.*,

              # deviasi

              a.bl_realisasi_fisik_1  - a.bl_target_fisik_1  AS bl_deviasi_fisik_1 ,
              a.bl_realisasi_fisik_2  - a.bl_target_fisik_2  AS bl_deviasi_fisik_2 ,
              a.bl_realisasi_fisik_3  - a.bl_target_fisik_3  AS bl_deviasi_fisik_3 ,
              a.bl_realisasi_fisik_4  - a.bl_target_fisik_4  AS bl_deviasi_fisik_4 ,
              a.bl_realisasi_fisik_5  - a.bl_target_fisik_5  AS bl_deviasi_fisik_5 ,
              a.bl_realisasi_fisik_6  - a.bl_target_fisik_6  AS bl_deviasi_fisik_6 ,
              a.bl_realisasi_fisik_7  - a.bl_target_fisik_7  AS bl_deviasi_fisik_7 ,
              a.bl_realisasi_fisik_8  - a.bl_target_fisik_8  AS bl_deviasi_fisik_8 ,
              a.bl_realisasi_fisik_9  - a.bl_target_fisik_9  AS bl_deviasi_fisik_9 ,
              a.bl_realisasi_fisik_10 - a.bl_target_fisik_10 AS bl_deviasi_fisik_10,
              a.bl_realisasi_fisik_11 - a.bl_target_fisik_11 AS bl_deviasi_fisik_11,
              a.bl_realisasi_fisik_12 - a.bl_target_fisik_12 AS bl_deviasi_fisik_12,

              a.bl_realisasi_keuangan_persen_1  - a.bl_target_keuangan_persen_1  AS bl_deviasi_keuangan_persen_1 ,
              a.bl_realisasi_keuangan_persen_2  - a.bl_target_keuangan_persen_2  AS bl_deviasi_keuangan_persen_2 ,
              a.bl_realisasi_keuangan_persen_3  - a.bl_target_keuangan_persen_3  AS bl_deviasi_keuangan_persen_3 ,
              a.bl_realisasi_keuangan_persen_4  - a.bl_target_keuangan_persen_4  AS bl_deviasi_keuangan_persen_4 ,
              a.bl_realisasi_keuangan_persen_5  - a.bl_target_keuangan_persen_5  AS bl_deviasi_keuangan_persen_5 ,
              a.bl_realisasi_keuangan_persen_6  - a.bl_target_keuangan_persen_6  AS bl_deviasi_keuangan_persen_6 ,
              a.bl_realisasi_keuangan_persen_7  - a.bl_target_keuangan_persen_7  AS bl_deviasi_keuangan_persen_7 ,
              a.bl_realisasi_keuangan_persen_8  - a.bl_target_keuangan_persen_8  AS bl_deviasi_keuangan_persen_8 ,
              a.bl_realisasi_keuangan_persen_9  - a.bl_target_keuangan_persen_9  AS bl_deviasi_keuangan_persen_9 ,
              a.bl_realisasi_keuangan_persen_10 - a.bl_target_keuangan_persen_10 AS bl_deviasi_keuangan_persen_10,
              a.bl_realisasi_keuangan_persen_11 - a.bl_target_keuangan_persen_11 AS bl_deviasi_keuangan_persen_11,
              a.bl_realisasi_keuangan_persen_12 - a.bl_target_keuangan_persen_12 AS bl_deviasi_keuangan_persen_12,

              a.btl_realisasi_fisik_1  - a.btl_target_fisik_1  AS btl_deviasi_fisik_1 ,
              a.btl_realisasi_fisik_2  - a.btl_target_fisik_2  AS btl_deviasi_fisik_2 ,
              a.btl_realisasi_fisik_3  - a.btl_target_fisik_3  AS btl_deviasi_fisik_3 ,
              a.btl_realisasi_fisik_4  - a.btl_target_fisik_4  AS btl_deviasi_fisik_4 ,
              a.btl_realisasi_fisik_5  - a.btl_target_fisik_5  AS btl_deviasi_fisik_5 ,
              a.btl_realisasi_fisik_6  - a.btl_target_fisik_6  AS btl_deviasi_fisik_6 ,
              a.btl_realisasi_fisik_7  - a.btl_target_fisik_7  AS btl_deviasi_fisik_7 ,
              a.btl_realisasi_fisik_8  - a.btl_target_fisik_8  AS btl_deviasi_fisik_8 ,
              a.btl_realisasi_fisik_9  - a.btl_target_fisik_9  AS btl_deviasi_fisik_9 ,
              a.btl_realisasi_fisik_10 - a.btl_target_fisik_10 AS btl_deviasi_fisik_10,
              a.btl_realisasi_fisik_11 - a.btl_target_fisik_11 AS btl_deviasi_fisik_11,
              a.btl_realisasi_fisik_12 - a.btl_target_fisik_12 AS btl_deviasi_fisik_12,

              a.btl_realisasi_keuangan_persen_1  - a.btl_target_keuangan_persen_1  AS btl_deviasi_keuangan_persen_1 ,
              a.btl_realisasi_keuangan_persen_2  - a.btl_target_keuangan_persen_2  AS btl_deviasi_keuangan_persen_2 ,
              a.btl_realisasi_keuangan_persen_3  - a.btl_target_keuangan_persen_3  AS btl_deviasi_keuangan_persen_3 ,
              a.btl_realisasi_keuangan_persen_4  - a.btl_target_keuangan_persen_4  AS btl_deviasi_keuangan_persen_4 ,
              a.btl_realisasi_keuangan_persen_5  - a.btl_target_keuangan_persen_5  AS btl_deviasi_keuangan_persen_5 ,
              a.btl_realisasi_keuangan_persen_6  - a.btl_target_keuangan_persen_6  AS btl_deviasi_keuangan_persen_6 ,
              a.btl_realisasi_keuangan_persen_7  - a.btl_target_keuangan_persen_7  AS btl_deviasi_keuangan_persen_7 ,
              a.btl_realisasi_keuangan_persen_8  - a.btl_target_keuangan_persen_8  AS btl_deviasi_keuangan_persen_8 ,
              a.btl_realisasi_keuangan_persen_9  - a.btl_target_keuangan_persen_9  AS btl_deviasi_keuangan_persen_9 ,
              a.btl_realisasi_keuangan_persen_10 - a.btl_target_keuangan_persen_10 AS btl_deviasi_keuangan_persen_10,
              a.btl_realisasi_keuangan_persen_11 - a.btl_target_keuangan_persen_11 AS btl_deviasi_keuangan_persen_11,
              a.btl_realisasi_keuangan_persen_12 - a.btl_target_keuangan_persen_12 AS btl_deviasi_keuangan_persen_12,  

              a.total_realisasi_fisik_1  - a.total_target_fisik_1  AS total_deviasi_fisik_1 ,
              a.total_realisasi_fisik_2  - a.total_target_fisik_2  AS total_deviasi_fisik_2 ,
              a.total_realisasi_fisik_3  - a.total_target_fisik_3  AS total_deviasi_fisik_3 ,
              a.total_realisasi_fisik_4  - a.total_target_fisik_4  AS total_deviasi_fisik_4 ,
              a.total_realisasi_fisik_5  - a.total_target_fisik_5  AS total_deviasi_fisik_5 ,
              a.total_realisasi_fisik_6  - a.total_target_fisik_6  AS total_deviasi_fisik_6 ,
              a.total_realisasi_fisik_7  - a.total_target_fisik_7  AS total_deviasi_fisik_7 ,
              a.total_realisasi_fisik_8  - a.total_target_fisik_8  AS total_deviasi_fisik_8 ,
              a.total_realisasi_fisik_9  - a.total_target_fisik_9  AS total_deviasi_fisik_9 ,
              a.total_realisasi_fisik_10 - a.total_target_fisik_10 AS total_deviasi_fisik_10,
              a.total_realisasi_fisik_11 - a.total_target_fisik_11 AS total_deviasi_fisik_11,
              a.total_realisasi_fisik_12 - a.total_target_fisik_12 AS total_deviasi_fisik_12,

              a.total_realisasi_keuangan_persen_1  - a.total_target_keuangan_persen_1  AS total_deviasi_keuangan_persen_1 ,
              a.total_realisasi_keuangan_persen_2  - a.total_target_keuangan_persen_2  AS total_deviasi_keuangan_persen_2 ,
              a.total_realisasi_keuangan_persen_3  - a.total_target_keuangan_persen_3  AS total_deviasi_keuangan_persen_3 ,
              a.total_realisasi_keuangan_persen_4  - a.total_target_keuangan_persen_4  AS total_deviasi_keuangan_persen_4 ,
              a.total_realisasi_keuangan_persen_5  - a.total_target_keuangan_persen_5  AS total_deviasi_keuangan_persen_5 ,
              a.total_realisasi_keuangan_persen_6  - a.total_target_keuangan_persen_6  AS total_deviasi_keuangan_persen_6 ,
              a.total_realisasi_keuangan_persen_7  - a.total_target_keuangan_persen_7  AS total_deviasi_keuangan_persen_7 ,
              a.total_realisasi_keuangan_persen_8  - a.total_target_keuangan_persen_8  AS total_deviasi_keuangan_persen_8 ,
              a.total_realisasi_keuangan_persen_9  - a.total_target_keuangan_persen_9  AS total_deviasi_keuangan_persen_9 ,
              a.total_realisasi_keuangan_persen_10 - a.total_target_keuangan_persen_10 AS total_deviasi_keuangan_persen_10,
              a.total_realisasi_keuangan_persen_11 - a.total_target_keuangan_persen_11 AS total_deviasi_keuangan_persen_11,
              a.total_realisasi_keuangan_persen_12 - a.total_target_keuangan_persen_12 AS total_deviasi_keuangan_persen_12  

            FROM realisasi_anggaran_pd_total AS a;

            SELECT * FROM realisasi_anggaran_pd_total_deviasi
            WHERE 
            kode_pd <> "4.04.100" AND
            kode_pd <> "4.01.100" AND
            kode_pd <> "4.01.200" AND
            kode_pd <> "4.01.300"
      ';
      $sql_arr = explode(';', $sql_str);
      foreach ($sql_arr as $sql){
        $query = $this->db->query($sql);
      }
      $tabel_kota = $query->result_array();         
      return $tabel_kota;      
    }


function get_daftar_pd_kecamatan($tahun_anggaran)
    {
      $sql_str = '

            # TABEL PD --> anggaran dan realisasi

            # total anggaran
            DROP TEMPORARY TABLE IF EXISTS total_anggaran_pd;
            CREATE TEMPORARY TABLE total_anggaran_pd AS
            SELECT 
              d.kode_pd,
              d.nama_pd,
              d.nip_kepala,
              e.nama_p AS nama_kepala,
              e.jabat_p AS jabatan_kepala,
              e.foto_p AS foto_kepala,
              d.kode_prog_btl,
              d.kode_giat_btl,
              SUM(a.pagu_giat) AS anggaran_total
            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            LEFT JOIN pejabat AS e ON d.nip_kepala = e.nip_p
            WHERE d.jenis_pd = "Kecamatan" 
            GROUP BY c.kode_pd
            ORDER BY c.kode_pd ASC;

            # total anggaran BL

            DROP TEMPORARY TABLE IF EXISTS total_anggaran_pd_bl;
            CREATE TEMPORARY TABLE total_anggaran_pd_bl AS
            SELECT 
              e.*,
              SUM(IF(b.kode_giat <> e.kode_giat_btl,a.pagu_giat,0)) AS anggaran_total_bl,
              SUM(IF(b.kode_giat = e.kode_giat_btl,a.pagu_giat,0)) AS anggaran_total_btl
            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN total_anggaran_pd AS e ON c.kode_pd = e.kode_pd
            # WHERE b.kode_giat <> e.kode_giat_btl 
            WHERE d.jenis_pd = "Kecamatan" 
            GROUP BY c.kode_pd
            ORDER BY c.kode_pd ASC;

            # realisasi BL

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_bl;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_bl AS
            SELECT 
              e.*,

              # fisik
              d.tf_1  AS bl_target_fisik_1 ,
              d.tf_2  AS bl_target_fisik_2 ,
              d.tf_3  AS bl_target_fisik_3 ,
              d.tf_4  AS bl_target_fisik_4 ,
              d.tf_5  AS bl_target_fisik_5 ,
              d.tf_6  AS bl_target_fisik_6 ,
              d.tf_7  AS bl_target_fisik_7 ,
              d.tf_8  AS bl_target_fisik_8 ,
              d.tf_9  AS bl_target_fisik_9 ,
              d.tf_10 AS bl_target_fisik_10,
              d.tf_11 AS bl_target_fisik_11,
              d.tf_12 AS bl_target_fisik_12,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_1 ),0) AS bl_realisasi_fisik_1 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_2 ),0) AS bl_realisasi_fisik_2 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_3 ),0) AS bl_realisasi_fisik_3 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_4 ),0) AS bl_realisasi_fisik_4 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_5 ),0) AS bl_realisasi_fisik_5 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_6 ),0) AS bl_realisasi_fisik_6 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_7 ),0) AS bl_realisasi_fisik_7 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_8 ),0) AS bl_realisasi_fisik_8 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_9 ),0) AS bl_realisasi_fisik_9 ,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_10),0) AS bl_realisasi_fisik_10,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_11),0) AS bl_realisasi_fisik_11,
              IFNULL(SUM((a.pagu_giat/e.anggaran_total_bl)*a.kf_12),0) AS bl_realisasi_fisik_12,

              # keuangan
              d.tk_1  AS bl_target_keuangan_1 ,
              d.tk_2  AS bl_target_keuangan_2 ,
              d.tk_3  AS bl_target_keuangan_3 ,
              d.tk_4  AS bl_target_keuangan_4 ,
              d.tk_5  AS bl_target_keuangan_5 ,
              d.tk_6  AS bl_target_keuangan_6 ,
              d.tk_7  AS bl_target_keuangan_7 ,
              d.tk_8  AS bl_target_keuangan_8 ,
              d.tk_9  AS bl_target_keuangan_9 ,
              d.tk_10 AS bl_target_keuangan_10,
              d.tk_11 AS bl_target_keuangan_11,
              d.tk_12 AS bl_target_keuangan_12,
              IFNULL((d.tk_1 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_1 ,
              IFNULL((d.tk_2 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_2 ,
              IFNULL((d.tk_3 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_3 ,
              IFNULL((d.tk_4 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_4 ,
              IFNULL((d.tk_5 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_5 ,
              IFNULL((d.tk_6 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_6 ,
              IFNULL((d.tk_7 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_7 ,
              IFNULL((d.tk_8 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_8 ,
              IFNULL((d.tk_9 /e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_9 ,
              IFNULL((d.tk_10/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_10,
              IFNULL((d.tk_11/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_11,
              IFNULL((d.tk_12/e.anggaran_total_bl)*100,0) AS bl_target_keuangan_persen_12,  
              SUM(a.kk_1 ) AS bl_realisasi_keuangan_1 ,
              SUM(a.kk_2 ) AS bl_realisasi_keuangan_2 ,
              SUM(a.kk_3 ) AS bl_realisasi_keuangan_3 ,
              SUM(a.kk_4 ) AS bl_realisasi_keuangan_4 ,
              SUM(a.kk_5 ) AS bl_realisasi_keuangan_5 ,
              SUM(a.kk_6 ) AS bl_realisasi_keuangan_6 ,
              SUM(a.kk_7 ) AS bl_realisasi_keuangan_7 ,
              SUM(a.kk_8 ) AS bl_realisasi_keuangan_8 ,
              SUM(a.kk_9 ) AS bl_realisasi_keuangan_9 ,
              SUM(a.kk_10) AS bl_realisasi_keuangan_10,
              SUM(a.kk_11) AS bl_realisasi_keuangan_11,
              SUM(a.kk_12) AS bl_realisasi_keuangan_12,
              IFNULL((SUM(a.kk_1 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_1 ,
              IFNULL((SUM(a.kk_2 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_2 ,
              IFNULL((SUM(a.kk_3 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_3 ,
              IFNULL((SUM(a.kk_4 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_4 ,
              IFNULL((SUM(a.kk_5 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_5 ,
              IFNULL((SUM(a.kk_6 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_6 ,
              IFNULL((SUM(a.kk_7 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_7 ,
              IFNULL((SUM(a.kk_8 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_8 ,
              IFNULL((SUM(a.kk_9 )/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_9 ,
              IFNULL((SUM(a.kk_10)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_10,
              IFNULL((SUM(a.kk_11)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_11,
              IFNULL((SUM(a.kk_12)/anggaran_total_bl)*100,0) AS bl_realisasi_keuangan_persen_12  

            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN total_anggaran_pd_bl AS e ON c.kode_pd = e.kode_pd 
            WHERE d.jenis_pd = "Kecamatan"
            GROUP BY e.kode_pd
            ORDER BY e.kode_pd ASC;


            # tambahkan realisasi BTL

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_bl_btl;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_bl_btl AS
            SELECT 
              e.*,

              # fisik
              d.btl_tf_1  AS btl_target_fisik_1 ,
              d.btl_tf_2  AS btl_target_fisik_2 ,
              d.btl_tf_3  AS btl_target_fisik_3 ,
              d.btl_tf_4  AS btl_target_fisik_4 ,
              d.btl_tf_5  AS btl_target_fisik_5 ,
              d.btl_tf_6  AS btl_target_fisik_6 ,
              d.btl_tf_7  AS btl_target_fisik_7 ,
              d.btl_tf_8  AS btl_target_fisik_8 ,
              d.btl_tf_9  AS btl_target_fisik_9 ,
              d.btl_tf_10 AS btl_target_fisik_10,
              d.btl_tf_11 AS btl_target_fisik_11,
              d.btl_tf_12 AS btl_target_fisik_12,
              d.btl_rf_1  AS btl_realisasi_fisik_1 ,
              d.btl_rf_2  AS btl_realisasi_fisik_2 ,
              d.btl_rf_3  AS btl_realisasi_fisik_3 ,
              d.btl_rf_4  AS btl_realisasi_fisik_4 ,
              d.btl_rf_5  AS btl_realisasi_fisik_5 ,
              d.btl_rf_6  AS btl_realisasi_fisik_6 ,
              d.btl_rf_7  AS btl_realisasi_fisik_7 ,
              d.btl_rf_8  AS btl_realisasi_fisik_8 ,
              d.btl_rf_9  AS btl_realisasi_fisik_9 ,
              d.btl_rf_10 AS btl_realisasi_fisik_10,
              d.btl_rf_11 AS btl_realisasi_fisik_11,
              d.btl_rf_12 AS btl_realisasi_fisik_12,

              # keuangan
              d.btl_tk_1  AS btl_target_keuangan_1 ,
              d.btl_tk_2  AS btl_target_keuangan_2 ,
              d.btl_tk_3  AS btl_target_keuangan_3 ,
              d.btl_tk_4  AS btl_target_keuangan_4 ,
              d.btl_tk_5  AS btl_target_keuangan_5 ,
              d.btl_tk_6  AS btl_target_keuangan_6 ,
              d.btl_tk_7  AS btl_target_keuangan_7 ,
              d.btl_tk_8  AS btl_target_keuangan_8 ,
              d.btl_tk_9  AS btl_target_keuangan_9 ,
              d.btl_tk_10 AS btl_target_keuangan_10,
              d.btl_tk_11 AS btl_target_keuangan_11,
              d.btl_tk_12 AS btl_target_keuangan_12,
              IFNULL((d.btl_tk_1 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_1 ,
              IFNULL((d.btl_tk_2 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_2 ,
              IFNULL((d.btl_tk_3 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_3 ,
              IFNULL((d.btl_tk_4 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_4 ,
              IFNULL((d.btl_tk_5 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_5 ,
              IFNULL((d.btl_tk_6 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_6 ,
              IFNULL((d.btl_tk_7 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_7 ,
              IFNULL((d.btl_tk_8 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_8 ,
              IFNULL((d.btl_tk_9 /e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_9 ,
              IFNULL((d.btl_tk_10/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_10,
              IFNULL((d.btl_tk_11/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_11,
              IFNULL((d.btl_tk_12/e.anggaran_total_btl)*100, 0) AS btl_target_keuangan_persen_12,  
              d.btl_rk_1  AS btl_realisasi_keuangan_1 ,
              d.btl_rk_2  AS btl_realisasi_keuangan_2 ,
              d.btl_rk_3  AS btl_realisasi_keuangan_3 ,
              d.btl_rk_4  AS btl_realisasi_keuangan_4 ,
              d.btl_rk_5  AS btl_realisasi_keuangan_5 ,
              d.btl_rk_6  AS btl_realisasi_keuangan_6 ,
              d.btl_rk_7  AS btl_realisasi_keuangan_7 ,
              d.btl_rk_8  AS btl_realisasi_keuangan_8 ,
              d.btl_rk_9  AS btl_realisasi_keuangan_9 ,
              d.btl_rk_10 AS btl_realisasi_keuangan_10,
              d.btl_rk_11 AS btl_realisasi_keuangan_11,
              d.btl_rk_12 AS btl_realisasi_keuangan_12,
              IFNULL((d.btl_rk_1 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_1 ,
              IFNULL((d.btl_rk_2 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_2 ,
              IFNULL((d.btl_rk_3 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_3 ,
              IFNULL((d.btl_rk_4 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_4 ,
              IFNULL((d.btl_rk_5 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_5 ,
              IFNULL((d.btl_rk_6 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_6 ,
              IFNULL((d.btl_rk_7 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_7 ,
              IFNULL((d.btl_rk_8 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_8 ,
              IFNULL((d.btl_rk_9 /e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_9 ,
              IFNULL((d.btl_rk_10/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_10,
              IFNULL((d.btl_rk_11/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_11,
              IFNULL((d.btl_rk_12/e.anggaran_total_btl)*100, 0) AS btl_realisasi_keuangan_persen_12  

            FROM belanja AS a
            JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
            JOIN program AS c ON b.kode_prog = c.kode_prog
            JOIN pd AS d ON c.kode_pd = d.kode_pd
            JOIN realisasi_anggaran_pd_bl AS e ON c.kode_pd = e.kode_pd 
            WHERE d.jenis_pd = "Kecamatan" 
            GROUP BY e.kode_pd
            ORDER BY e.kode_pd ASC;


            # realisasi total

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_total;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_total AS
            SELECT 
              a.*,
              # fisik
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_1 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_1 ), 0) AS total_target_fisik_1 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_2 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_2 ), 0) AS total_target_fisik_2 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_3 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_3 ), 0) AS total_target_fisik_3 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_4 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_4 ), 0) AS total_target_fisik_4 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_5 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_5 ), 0) AS total_target_fisik_5 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_6 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_6 ), 0) AS total_target_fisik_6 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_7 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_7 ), 0) AS total_target_fisik_7 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_8 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_8 ), 0) AS total_target_fisik_8 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_9 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_9 ), 0) AS total_target_fisik_9 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_10), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_10), 0) AS total_target_fisik_10,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_11), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_11), 0) AS total_target_fisik_11,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_target_fisik_12), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_target_fisik_12), 0) AS total_target_fisik_12,

              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_1 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_1 ), 0) AS total_realisasi_fisik_1 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_2 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_2 ), 0) AS total_realisasi_fisik_2 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_3 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_3 ), 0) AS total_realisasi_fisik_3 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_4 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_4 ), 0) AS total_realisasi_fisik_4 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_5 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_5 ), 0) AS total_realisasi_fisik_5 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_6 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_6 ), 0) AS total_realisasi_fisik_6 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_7 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_7 ), 0) AS total_realisasi_fisik_7 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_8 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_8 ), 0) AS total_realisasi_fisik_8 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_9 ), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_9 ), 0) AS total_realisasi_fisik_9 ,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_10), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_10), 0) AS total_realisasi_fisik_10,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_11), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_11), 0) AS total_realisasi_fisik_11,
              IFNULL(((a.anggaran_total_bl / a.anggaran_total) * a.bl_realisasi_fisik_12), 0) + IFNULL(((a.anggaran_total_btl / a.anggaran_total) * a.btl_realisasi_fisik_12), 0) AS total_realisasi_fisik_12,

              IFNULL(a.bl_target_keuangan_1 ,0) + IFNULL(a.btl_target_keuangan_1 ,0) AS total_target_keuangan_1 ,
              IFNULL(a.bl_target_keuangan_2 ,0) + IFNULL(a.btl_target_keuangan_2 ,0) AS total_target_keuangan_2 ,
              IFNULL(a.bl_target_keuangan_3 ,0) + IFNULL(a.btl_target_keuangan_3 ,0) AS total_target_keuangan_3 ,
              IFNULL(a.bl_target_keuangan_4 ,0) + IFNULL(a.btl_target_keuangan_4 ,0) AS total_target_keuangan_4 ,
              IFNULL(a.bl_target_keuangan_5 ,0) + IFNULL(a.btl_target_keuangan_5 ,0) AS total_target_keuangan_5 ,
              IFNULL(a.bl_target_keuangan_6 ,0) + IFNULL(a.btl_target_keuangan_6 ,0) AS total_target_keuangan_6 ,
              IFNULL(a.bl_target_keuangan_7 ,0) + IFNULL(a.btl_target_keuangan_7 ,0) AS total_target_keuangan_7 ,
              IFNULL(a.bl_target_keuangan_8 ,0) + IFNULL(a.btl_target_keuangan_8 ,0) AS total_target_keuangan_8 ,
              IFNULL(a.bl_target_keuangan_9 ,0) + IFNULL(a.btl_target_keuangan_9 ,0) AS total_target_keuangan_9 ,
              IFNULL(a.bl_target_keuangan_10,0) + IFNULL(a.btl_target_keuangan_10,0) AS total_target_keuangan_10,
              IFNULL(a.bl_target_keuangan_11,0) + IFNULL(a.btl_target_keuangan_11,0) AS total_target_keuangan_11,
              IFNULL(a.bl_target_keuangan_12,0) + IFNULL(a.btl_target_keuangan_12,0) AS total_target_keuangan_12,

              IFNULL(((a.bl_target_keuangan_1  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_1  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_1 ,
              IFNULL(((a.bl_target_keuangan_2  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_2  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_2 ,
              IFNULL(((a.bl_target_keuangan_3  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_3  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_3 ,
              IFNULL(((a.bl_target_keuangan_4  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_4  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_4 ,
              IFNULL(((a.bl_target_keuangan_5  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_5  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_5 ,
              IFNULL(((a.bl_target_keuangan_6  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_6  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_6 ,
              IFNULL(((a.bl_target_keuangan_7  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_7  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_7 ,
              IFNULL(((a.bl_target_keuangan_8  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_8  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_8 ,
              IFNULL(((a.bl_target_keuangan_9  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_9  / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_9 ,
              IFNULL(((a.bl_target_keuangan_10 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_10 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_10,
              IFNULL(((a.bl_target_keuangan_11 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_11 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_11,
              IFNULL(((a.bl_target_keuangan_12 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_target_keuangan_12 / a.anggaran_total) * 100), 0) AS total_target_keuangan_persen_12,

              IFNULL(a.bl_realisasi_keuangan_1 ,0) + IFNULL(a.btl_realisasi_keuangan_1 ,0) AS total_realisasi_keuangan_1 ,
              IFNULL(a.bl_realisasi_keuangan_2 ,0) + IFNULL(a.btl_realisasi_keuangan_2 ,0) AS total_realisasi_keuangan_2 ,
              IFNULL(a.bl_realisasi_keuangan_3 ,0) + IFNULL(a.btl_realisasi_keuangan_3 ,0) AS total_realisasi_keuangan_3 ,
              IFNULL(a.bl_realisasi_keuangan_4 ,0) + IFNULL(a.btl_realisasi_keuangan_4 ,0) AS total_realisasi_keuangan_4 ,
              IFNULL(a.bl_realisasi_keuangan_5 ,0) + IFNULL(a.btl_realisasi_keuangan_5 ,0) AS total_realisasi_keuangan_5 ,
              IFNULL(a.bl_realisasi_keuangan_6 ,0) + IFNULL(a.btl_realisasi_keuangan_6 ,0) AS total_realisasi_keuangan_6 ,
              IFNULL(a.bl_realisasi_keuangan_7 ,0) + IFNULL(a.btl_realisasi_keuangan_7 ,0) AS total_realisasi_keuangan_7 ,
              IFNULL(a.bl_realisasi_keuangan_8 ,0) + IFNULL(a.btl_realisasi_keuangan_8 ,0) AS total_realisasi_keuangan_8 ,
              IFNULL(a.bl_realisasi_keuangan_9 ,0) + IFNULL(a.btl_realisasi_keuangan_9 ,0) AS total_realisasi_keuangan_9 ,
              IFNULL(a.bl_realisasi_keuangan_10,0) + IFNULL(a.btl_realisasi_keuangan_10,0) AS total_realisasi_keuangan_10,
              IFNULL(a.bl_realisasi_keuangan_11,0) + IFNULL(a.btl_realisasi_keuangan_11,0) AS total_realisasi_keuangan_11,
              IFNULL(a.bl_realisasi_keuangan_12,0) + IFNULL(a.btl_realisasi_keuangan_12,0) AS total_realisasi_keuangan_12,

              IFNULL(((a.bl_realisasi_keuangan_1  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_1  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_1 ,
              IFNULL(((a.bl_realisasi_keuangan_2  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_2  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_2 ,
              IFNULL(((a.bl_realisasi_keuangan_3  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_3  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_3 ,
              IFNULL(((a.bl_realisasi_keuangan_4  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_4  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_4 ,
              IFNULL(((a.bl_realisasi_keuangan_5  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_5  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_5 ,
              IFNULL(((a.bl_realisasi_keuangan_6  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_6  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_6 ,
              IFNULL(((a.bl_realisasi_keuangan_7  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_7  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_7 ,
              IFNULL(((a.bl_realisasi_keuangan_8  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_8  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_8 ,
              IFNULL(((a.bl_realisasi_keuangan_9  / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_9  / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_9 ,
              IFNULL(((a.bl_realisasi_keuangan_10 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_10 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_10,
              IFNULL(((a.bl_realisasi_keuangan_11 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_11 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_11,
              IFNULL(((a.bl_realisasi_keuangan_12 / a.anggaran_total) * 100), 0) + IFNULL(((a.btl_realisasi_keuangan_12 / a.anggaran_total) * 100), 0) AS total_realisasi_keuangan_persen_12

            FROM realisasi_anggaran_pd_bl_btl AS a;

            # hitung deviasi

            DROP TEMPORARY TABLE IF EXISTS realisasi_anggaran_pd_total_deviasi;
            CREATE TEMPORARY TABLE realisasi_anggaran_pd_total_deviasi AS
            SELECT 
              a.*,

              # deviasi

              a.bl_realisasi_fisik_1  - a.bl_target_fisik_1  AS bl_deviasi_fisik_1 ,
              a.bl_realisasi_fisik_2  - a.bl_target_fisik_2  AS bl_deviasi_fisik_2 ,
              a.bl_realisasi_fisik_3  - a.bl_target_fisik_3  AS bl_deviasi_fisik_3 ,
              a.bl_realisasi_fisik_4  - a.bl_target_fisik_4  AS bl_deviasi_fisik_4 ,
              a.bl_realisasi_fisik_5  - a.bl_target_fisik_5  AS bl_deviasi_fisik_5 ,
              a.bl_realisasi_fisik_6  - a.bl_target_fisik_6  AS bl_deviasi_fisik_6 ,
              a.bl_realisasi_fisik_7  - a.bl_target_fisik_7  AS bl_deviasi_fisik_7 ,
              a.bl_realisasi_fisik_8  - a.bl_target_fisik_8  AS bl_deviasi_fisik_8 ,
              a.bl_realisasi_fisik_9  - a.bl_target_fisik_9  AS bl_deviasi_fisik_9 ,
              a.bl_realisasi_fisik_10 - a.bl_target_fisik_10 AS bl_deviasi_fisik_10,
              a.bl_realisasi_fisik_11 - a.bl_target_fisik_11 AS bl_deviasi_fisik_11,
              a.bl_realisasi_fisik_12 - a.bl_target_fisik_12 AS bl_deviasi_fisik_12,

              a.bl_realisasi_keuangan_persen_1  - a.bl_target_keuangan_persen_1  AS bl_deviasi_keuangan_persen_1 ,
              a.bl_realisasi_keuangan_persen_2  - a.bl_target_keuangan_persen_2  AS bl_deviasi_keuangan_persen_2 ,
              a.bl_realisasi_keuangan_persen_3  - a.bl_target_keuangan_persen_3  AS bl_deviasi_keuangan_persen_3 ,
              a.bl_realisasi_keuangan_persen_4  - a.bl_target_keuangan_persen_4  AS bl_deviasi_keuangan_persen_4 ,
              a.bl_realisasi_keuangan_persen_5  - a.bl_target_keuangan_persen_5  AS bl_deviasi_keuangan_persen_5 ,
              a.bl_realisasi_keuangan_persen_6  - a.bl_target_keuangan_persen_6  AS bl_deviasi_keuangan_persen_6 ,
              a.bl_realisasi_keuangan_persen_7  - a.bl_target_keuangan_persen_7  AS bl_deviasi_keuangan_persen_7 ,
              a.bl_realisasi_keuangan_persen_8  - a.bl_target_keuangan_persen_8  AS bl_deviasi_keuangan_persen_8 ,
              a.bl_realisasi_keuangan_persen_9  - a.bl_target_keuangan_persen_9  AS bl_deviasi_keuangan_persen_9 ,
              a.bl_realisasi_keuangan_persen_10 - a.bl_target_keuangan_persen_10 AS bl_deviasi_keuangan_persen_10,
              a.bl_realisasi_keuangan_persen_11 - a.bl_target_keuangan_persen_11 AS bl_deviasi_keuangan_persen_11,
              a.bl_realisasi_keuangan_persen_12 - a.bl_target_keuangan_persen_12 AS bl_deviasi_keuangan_persen_12,

              a.btl_realisasi_fisik_1  - a.btl_target_fisik_1  AS btl_deviasi_fisik_1 ,
              a.btl_realisasi_fisik_2  - a.btl_target_fisik_2  AS btl_deviasi_fisik_2 ,
              a.btl_realisasi_fisik_3  - a.btl_target_fisik_3  AS btl_deviasi_fisik_3 ,
              a.btl_realisasi_fisik_4  - a.btl_target_fisik_4  AS btl_deviasi_fisik_4 ,
              a.btl_realisasi_fisik_5  - a.btl_target_fisik_5  AS btl_deviasi_fisik_5 ,
              a.btl_realisasi_fisik_6  - a.btl_target_fisik_6  AS btl_deviasi_fisik_6 ,
              a.btl_realisasi_fisik_7  - a.btl_target_fisik_7  AS btl_deviasi_fisik_7 ,
              a.btl_realisasi_fisik_8  - a.btl_target_fisik_8  AS btl_deviasi_fisik_8 ,
              a.btl_realisasi_fisik_9  - a.btl_target_fisik_9  AS btl_deviasi_fisik_9 ,
              a.btl_realisasi_fisik_10 - a.btl_target_fisik_10 AS btl_deviasi_fisik_10,
              a.btl_realisasi_fisik_11 - a.btl_target_fisik_11 AS btl_deviasi_fisik_11,
              a.btl_realisasi_fisik_12 - a.btl_target_fisik_12 AS btl_deviasi_fisik_12,

              a.btl_realisasi_keuangan_persen_1  - a.btl_target_keuangan_persen_1  AS btl_deviasi_keuangan_persen_1 ,
              a.btl_realisasi_keuangan_persen_2  - a.btl_target_keuangan_persen_2  AS btl_deviasi_keuangan_persen_2 ,
              a.btl_realisasi_keuangan_persen_3  - a.btl_target_keuangan_persen_3  AS btl_deviasi_keuangan_persen_3 ,
              a.btl_realisasi_keuangan_persen_4  - a.btl_target_keuangan_persen_4  AS btl_deviasi_keuangan_persen_4 ,
              a.btl_realisasi_keuangan_persen_5  - a.btl_target_keuangan_persen_5  AS btl_deviasi_keuangan_persen_5 ,
              a.btl_realisasi_keuangan_persen_6  - a.btl_target_keuangan_persen_6  AS btl_deviasi_keuangan_persen_6 ,
              a.btl_realisasi_keuangan_persen_7  - a.btl_target_keuangan_persen_7  AS btl_deviasi_keuangan_persen_7 ,
              a.btl_realisasi_keuangan_persen_8  - a.btl_target_keuangan_persen_8  AS btl_deviasi_keuangan_persen_8 ,
              a.btl_realisasi_keuangan_persen_9  - a.btl_target_keuangan_persen_9  AS btl_deviasi_keuangan_persen_9 ,
              a.btl_realisasi_keuangan_persen_10 - a.btl_target_keuangan_persen_10 AS btl_deviasi_keuangan_persen_10,
              a.btl_realisasi_keuangan_persen_11 - a.btl_target_keuangan_persen_11 AS btl_deviasi_keuangan_persen_11,
              a.btl_realisasi_keuangan_persen_12 - a.btl_target_keuangan_persen_12 AS btl_deviasi_keuangan_persen_12,  

              a.total_realisasi_fisik_1  - a.total_target_fisik_1  AS total_deviasi_fisik_1 ,
              a.total_realisasi_fisik_2  - a.total_target_fisik_2  AS total_deviasi_fisik_2 ,
              a.total_realisasi_fisik_3  - a.total_target_fisik_3  AS total_deviasi_fisik_3 ,
              a.total_realisasi_fisik_4  - a.total_target_fisik_4  AS total_deviasi_fisik_4 ,
              a.total_realisasi_fisik_5  - a.total_target_fisik_5  AS total_deviasi_fisik_5 ,
              a.total_realisasi_fisik_6  - a.total_target_fisik_6  AS total_deviasi_fisik_6 ,
              a.total_realisasi_fisik_7  - a.total_target_fisik_7  AS total_deviasi_fisik_7 ,
              a.total_realisasi_fisik_8  - a.total_target_fisik_8  AS total_deviasi_fisik_8 ,
              a.total_realisasi_fisik_9  - a.total_target_fisik_9  AS total_deviasi_fisik_9 ,
              a.total_realisasi_fisik_10 - a.total_target_fisik_10 AS total_deviasi_fisik_10,
              a.total_realisasi_fisik_11 - a.total_target_fisik_11 AS total_deviasi_fisik_11,
              a.total_realisasi_fisik_12 - a.total_target_fisik_12 AS total_deviasi_fisik_12,

              a.total_realisasi_keuangan_persen_1  - a.total_target_keuangan_persen_1  AS total_deviasi_keuangan_persen_1 ,
              a.total_realisasi_keuangan_persen_2  - a.total_target_keuangan_persen_2  AS total_deviasi_keuangan_persen_2 ,
              a.total_realisasi_keuangan_persen_3  - a.total_target_keuangan_persen_3  AS total_deviasi_keuangan_persen_3 ,
              a.total_realisasi_keuangan_persen_4  - a.total_target_keuangan_persen_4  AS total_deviasi_keuangan_persen_4 ,
              a.total_realisasi_keuangan_persen_5  - a.total_target_keuangan_persen_5  AS total_deviasi_keuangan_persen_5 ,
              a.total_realisasi_keuangan_persen_6  - a.total_target_keuangan_persen_6  AS total_deviasi_keuangan_persen_6 ,
              a.total_realisasi_keuangan_persen_7  - a.total_target_keuangan_persen_7  AS total_deviasi_keuangan_persen_7 ,
              a.total_realisasi_keuangan_persen_8  - a.total_target_keuangan_persen_8  AS total_deviasi_keuangan_persen_8 ,
              a.total_realisasi_keuangan_persen_9  - a.total_target_keuangan_persen_9  AS total_deviasi_keuangan_persen_9 ,
              a.total_realisasi_keuangan_persen_10 - a.total_target_keuangan_persen_10 AS total_deviasi_keuangan_persen_10,
              a.total_realisasi_keuangan_persen_11 - a.total_target_keuangan_persen_11 AS total_deviasi_keuangan_persen_11,
              a.total_realisasi_keuangan_persen_12 - a.total_target_keuangan_persen_12 AS total_deviasi_keuangan_persen_12  

            FROM realisasi_anggaran_pd_total AS a;

            SELECT * FROM realisasi_anggaran_pd_total_deviasi
            WHERE 
            kode_pd <> "4.04.100" AND
            kode_pd <> "4.01.100" AND
            kode_pd <> "4.01.200" AND
            kode_pd <> "4.01.300"
      ';
      $sql_arr = explode(';', $sql_str);
      foreach ($sql_arr as $sql){
        $query = $this->db->query($sql);
      }
      $tabel_kota = $query->result_array();         
      return $tabel_kota;      
    }


function get_total_target_realisasi_kota($tahun_anggaran)
    {
      // Koreksi Nov 12, 2017
      $sql_str = '
          # anggaran total, anggaran BTL dan anggaran BL
          SELECT 
             @anggaran_total := SUM(a.pagu_giat) AS anggaran_total,
             @anggaran_btl := SUM(IF(b.kode_giat = d.kode_giat_btl, a.pagu_giat, 0)) AS anggaran_btl,
             @anggaran_bl := SUM(IF(b.kode_giat <> d.kode_giat_btl OR 
                    d.kode_giat_btl = "" OR 
                    d.kode_giat_btl IS NULL, 
                    a.pagu_giat, 0
                   )
                 ) AS anggaran_bl        
          FROM belanja AS a
          JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
          JOIN program AS c ON b.kode_prog = c.kode_prog
          JOIN pd AS d ON c.kode_pd = d.kode_pd;

          # hitung persen BL dan BTL
          SET @anggaran_bl_persen = (@anggaran_bl / @anggaran_total)*100;
          SET @anggaran_btl_persen = (@anggaran_btl / @anggaran_total)*100;

          # hitung jumlah belanja, kegiatan dan program
          SELECT 
            @jumlah_kegiatan := COUNT(DISTINCT b.kode_giat) AS jumlah_kegiatan,
            @jumlah_belanja := COUNT(DISTINCT a.kode_rek_belanja) AS jumlah_belanja,
            @jumlah_belanja_swakelola := COUNT(DISTINCT (CASE WHEN a.jenis_kegiatan = "Swakelola" THEN a.kode_rek_belanja END)) AS jumlah_belanja_swakelola,
            @jumlah_belanja_pengadaan := COUNT(DISTINCT (CASE WHEN a.jenis_kegiatan = "Pengadaan" THEN a.kode_rek_belanja END)) AS jumlah_belanja_pengadaan,
            @jumlah_program := COUNT(DISTINCT c.kode_prog) AS jumlah_program      
          FROM belanja AS a
          JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
          JOIN program AS c ON b.kode_prog = c.kode_prog
          JOIN pd AS d ON c.kode_pd = d.kode_pd
          WHERE b.kode_giat <> d.kode_giat_btl OR d.kode_giat_btl = "" OR d.kode_giat_btl IS NULL;

          # dapatkan target dan hitung realisasi untuk BL dan BTL
          DROP TEMPORARY TABLE IF EXISTS target_realisasi_pd;
          CREATE TEMPORARY TABLE target_realisasi_pd AS
          SELECT 
            d.kode_pd,
            SUM(a.pagu_giat) AS anggaran_total,
            SUM(IF(b.kode_giat = d.kode_giat_btl, a.pagu_giat, 0)) AS anggaran_btl,
            SUM(IF(b.kode_giat <> d.kode_giat_btl OR 
                   d.kode_giat_btl = "" OR 
                   d.kode_giat_btl IS NULL, 
                   a.pagu_giat, 0)) AS anggaran_bl, 
            # target fisik BTL
            d.btl_tf_1,d.btl_tf_2,d.btl_tf_3,d.btl_tf_4,d.btl_tf_5,d.btl_tf_6,d.btl_tf_7,d.btl_tf_8,
            d.btl_tf_9,d.btl_tf_10,d.btl_tf_11,d.btl_tf_12,
            # target keuangan BTL
            d.btl_tk_1,d.btl_tk_2,d.btl_tk_3,d.btl_tk_4,d.btl_tk_5,d.btl_tk_6,d.btl_tk_7,d.btl_tk_8,
            d.btl_tk_9,d.btl_tk_10,d.btl_tk_11,d.btl_tk_12,
            # realisasi fisik BTL
            d.btl_rf_1,d.btl_rf_2,d.btl_rf_3,d.btl_rf_4,d.btl_rf_5,d.btl_rf_6,d.btl_rf_7,d.btl_rf_8,
            d.btl_rf_9,d.btl_rf_10,d.btl_rf_11,d.btl_rf_12,
            # deviasi fisik BTL
            d.btl_rf_1  - d.btl_tf_1  AS btl_rf_1_dev,
            d.btl_rf_2  - d.btl_tf_2  AS btl_rf_2_dev,
            d.btl_rf_3  - d.btl_tf_3  AS btl_rf_3_dev,
            d.btl_rf_4  - d.btl_tf_4  AS btl_rf_4_dev,
            d.btl_rf_5  - d.btl_tf_5  AS btl_rf_5_dev,
            d.btl_rf_6  - d.btl_tf_6  AS btl_rf_6_dev,
            d.btl_rf_7  - d.btl_tf_7  AS btl_rf_7_dev,
            d.btl_rf_8  - d.btl_tf_8  AS btl_rf_8_dev,
            d.btl_rf_9  - d.btl_tf_9  AS btl_rf_9_dev,
            d.btl_rf_10 - d.btl_tf_10 AS btl_rf_10_dev,
            d.btl_rf_11 - d.btl_tf_11 AS btl_rf_11_dev,
            d.btl_rf_12 - d.btl_tf_12 AS btl_rf_12_dev,
            # realisasi keuangan BTL
            d.btl_rk_1,d.btl_rk_2,d.btl_rk_3,d.btl_rk_4,d.btl_rk_5,d.btl_rk_6,d.btl_rk_7,d.btl_rk_8,
            d.btl_rk_9,d.btl_rk_10,d.btl_rk_11,d.btl_rk_12,   
            # deviasi keuangan BTL
            d.btl_rk_1  - d.btl_tk_1  AS btl_rk_1_dev,
            d.btl_rk_2  - d.btl_tk_2  AS btl_rk_2_dev,
            d.btl_rk_3  - d.btl_tk_3  AS btl_rk_3_dev,
            d.btl_rk_4  - d.btl_tk_4  AS btl_rk_4_dev,
            d.btl_rk_5  - d.btl_tk_5  AS btl_rk_5_dev,
            d.btl_rk_6  - d.btl_tk_6  AS btl_rk_6_dev,
            d.btl_rk_7  - d.btl_tk_7  AS btl_rk_7_dev,
            d.btl_rk_8  - d.btl_tk_8  AS btl_rk_8_dev,
            d.btl_rk_9  - d.btl_tk_9  AS btl_rk_9_dev,
            d.btl_rk_10 - d.btl_tk_10 AS btl_rk_10_dev,
            d.btl_rk_11 - d.btl_tk_11 AS btl_rk_11_dev,
            d.btl_rk_12 - d.btl_tk_12 AS btl_rk_12_dev,  
            # target fisik BL       
            d.tf_1,d.tf_2,d.tf_3,d.tf_4,d.tf_5,d.tf_6,d.tf_7,d.tf_8,d.tf_9,d.tf_10,d.tf_11,d.tf_12,
            # target keuangan BL
            d.tk_1,d.tk_2,d.tk_3,d.tk_4,d.tk_5,d.tk_6,d.tk_7,d.tk_8,d.tk_9,d.tk_10,d.tk_11,d.tk_12,
            # realisasi fisik BL
            SUM(a.pagu_giat * a.kf_1 ) AS rf_1 ,
            SUM(a.pagu_giat * a.kf_2 ) AS rf_2 ,
            SUM(a.pagu_giat * a.kf_3 ) AS rf_3 ,
            SUM(a.pagu_giat * a.kf_4 ) AS rf_4 ,
            SUM(a.pagu_giat * a.kf_5 ) AS rf_5 ,
            SUM(a.pagu_giat * a.kf_6 ) AS rf_6 ,
            SUM(a.pagu_giat * a.kf_7 ) AS rf_7 ,
            SUM(a.pagu_giat * a.kf_8 ) AS rf_8 ,
            SUM(a.pagu_giat * a.kf_9 ) AS rf_9 ,
            SUM(a.pagu_giat * a.kf_10) AS rf_10,
            SUM(a.pagu_giat * a.kf_11) AS rf_11,
            SUM(a.pagu_giat * a.kf_12) AS rf_12,
            SUM(a.kk_1 ) AS rk_1 ,
            SUM(a.kk_2 ) AS rk_2 ,
            SUM(a.kk_3 ) AS rk_3 ,
            SUM(a.kk_4 ) AS rk_4 ,
            SUM(a.kk_5 ) AS rk_5 ,
            SUM(a.kk_6 ) AS rk_6 ,
            SUM(a.kk_7 ) AS rk_7 ,
            SUM(a.kk_8 ) AS rk_8 ,
            SUM(a.kk_9 ) AS rk_9 ,
            SUM(a.kk_10) AS rk_10,
            SUM(a.kk_11) AS rk_11,
            SUM(a.kk_12) AS rk_12,
            (SUM(a.kk_1 )/SUM(a.pagu_giat))*100 AS rkp_1 ,
            (SUM(a.kk_2 )/SUM(a.pagu_giat))*100 AS rkp_2 ,
            (SUM(a.kk_3 )/SUM(a.pagu_giat))*100 AS rkp_3 ,
            (SUM(a.kk_4 )/SUM(a.pagu_giat))*100 AS rkp_4 ,
            (SUM(a.kk_5 )/SUM(a.pagu_giat))*100 AS rkp_5 ,
            (SUM(a.kk_6 )/SUM(a.pagu_giat))*100 AS rkp_6 ,
            (SUM(a.kk_7 )/SUM(a.pagu_giat))*100 AS rkp_7 ,
            (SUM(a.kk_8 )/SUM(a.pagu_giat))*100 AS rkp_8 ,
            (SUM(a.kk_9 )/SUM(a.pagu_giat))*100 AS rkp_9 ,
            (SUM(a.kk_10)/SUM(a.pagu_giat))*100 AS rkp_10,
            (SUM(a.kk_11)/SUM(a.pagu_giat))*100 AS rkp_11,
            (SUM(a.kk_12)/SUM(a.pagu_giat))*100 AS rkp_12
          FROM belanja AS a
          JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
          JOIN program AS c ON b.kode_prog = c.kode_prog
          JOIN pd AS d ON c.kode_pd = d.kode_pd
          GROUP BY d.kode_pd
          ORDER BY d.kode_pd;

          # hitung realisasi fisik BL (bagikan dengan anggaran BL)
          UPDATE target_realisasi_pd
            SET 
            rf_1 = rf_1 / anggaran_bl,
            rf_2 = rf_2 / anggaran_bl,
            rf_3 = rf_3 / anggaran_bl,
            rf_4 = rf_4 / anggaran_bl,
            rf_5 = rf_5 / anggaran_bl,
            rf_6 = rf_6 / anggaran_bl,
            rf_7 = rf_7 / anggaran_bl,
            rf_8 = rf_8 / anggaran_bl,
            rf_9 = rf_9 / anggaran_bl,
            rf_10 = rf_10 / anggaran_bl,
            rf_11 = rf_11 / anggaran_bl,
            rf_12 = rf_12 / anggaran_bl;

          # tambah kolom PERSENTASE realisasi keuangan BTL 
          ALTER TABLE target_realisasi_pd 
            ADD COLUMN btl_tkp_12 FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_11 FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_10 FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_9  FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_8  FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_7  FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_6  FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_5  FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_4  FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_3  FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_2  FLOAT AFTER btl_tk_12,
            ADD COLUMN btl_tkp_1  FLOAT AFTER btl_tk_12,

            ADD COLUMN btl_rkp_12 FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_11 FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_10 FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_9  FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_8  FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_7  FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_6  FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_5  FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_4  FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_3  FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_2  FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_1  FLOAT AFTER btl_rk_12,

            ADD COLUMN btl_rkp_12_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_11_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_10_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_9_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_8_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_7_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_6_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_5_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_4_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_3_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_2_dev FLOAT AFTER btl_rk_12,
            ADD COLUMN btl_rkp_1_dev FLOAT AFTER btl_rk_12;  

          UPDATE target_realisasi_pd
            SET 
            btl_tkp_1  = (btl_tk_1  / anggaran_btl) * 100,
            btl_tkp_2  = (btl_tk_2  / anggaran_btl) * 100,
            btl_tkp_3  = (btl_tk_3  / anggaran_btl) * 100,
            btl_tkp_4  = (btl_tk_4  / anggaran_btl) * 100,
            btl_tkp_5  = (btl_tk_5  / anggaran_btl) * 100,
            btl_tkp_6  = (btl_tk_6  / anggaran_btl) * 100,
            btl_tkp_7  = (btl_tk_7  / anggaran_btl) * 100,
            btl_tkp_8  = (btl_tk_8  / anggaran_btl) * 100,
            btl_tkp_9  = (btl_tk_9  / anggaran_btl) * 100,
            btl_tkp_10 = (btl_tk_10 / anggaran_btl) * 100,
            btl_tkp_11 = (btl_tk_11 / anggaran_btl) * 100,
            btl_tkp_12 = (btl_tk_12 / anggaran_btl) * 100,

            btl_rkp_1  = (btl_rk_1  / anggaran_btl) * 100,
            btl_rkp_2  = (btl_rk_2  / anggaran_btl) * 100,
            btl_rkp_3  = (btl_rk_3  / anggaran_btl) * 100,
            btl_rkp_4  = (btl_rk_4  / anggaran_btl) * 100,
            btl_rkp_5  = (btl_rk_5  / anggaran_btl) * 100,
            btl_rkp_6  = (btl_rk_6  / anggaran_btl) * 100,
            btl_rkp_7  = (btl_rk_7  / anggaran_btl) * 100,
            btl_rkp_8  = (btl_rk_8  / anggaran_btl) * 100,
            btl_rkp_9  = (btl_rk_9  / anggaran_btl) * 100,
            btl_rkp_10 = (btl_rk_10 / anggaran_btl) * 100,
            btl_rkp_11 = (btl_rk_11 / anggaran_btl) * 100,
            btl_rkp_12 = (btl_rk_12 / anggaran_btl) * 100,

            btl_rkp_1_dev  = ((btl_rk_1  / anggaran_btl) * 100) - ((btl_tk_1  / anggaran_btl) * 100),
            btl_rkp_2_dev  = ((btl_rk_2  / anggaran_btl) * 100) - ((btl_tk_2  / anggaran_btl) * 100),
            btl_rkp_3_dev  = ((btl_rk_3  / anggaran_btl) * 100) - ((btl_tk_3  / anggaran_btl) * 100),
            btl_rkp_4_dev  = ((btl_rk_4  / anggaran_btl) * 100) - ((btl_tk_4  / anggaran_btl) * 100),
            btl_rkp_5_dev  = ((btl_rk_5  / anggaran_btl) * 100) - ((btl_tk_5  / anggaran_btl) * 100),
            btl_rkp_6_dev  = ((btl_rk_6  / anggaran_btl) * 100) - ((btl_tk_6  / anggaran_btl) * 100),
            btl_rkp_7_dev  = ((btl_rk_7  / anggaran_btl) * 100) - ((btl_tk_7  / anggaran_btl) * 100),
            btl_rkp_8_dev  = ((btl_rk_8  / anggaran_btl) * 100) - ((btl_tk_8  / anggaran_btl) * 100),
            btl_rkp_9_dev  = ((btl_rk_9  / anggaran_btl) * 100) - ((btl_tk_9  / anggaran_btl) * 100),
            btl_rkp_10_dev = ((btl_rk_10 / anggaran_btl) * 100) - ((btl_tk_10 / anggaran_btl) * 100),
            btl_rkp_11_dev = ((btl_rk_11 / anggaran_btl) * 100) - ((btl_tk_11 / anggaran_btl) * 100),
            btl_rkp_12_dev = ((btl_rk_12 / anggaran_btl) * 100) - ((btl_tk_12 / anggaran_btl) * 100);

          ALTER TABLE target_realisasi_pd 
            # persentase target keuangan BL
            ADD COLUMN tkp_12 FLOAT AFTER tk_12,
            ADD COLUMN tkp_11 FLOAT AFTER tk_12,
            ADD COLUMN tkp_10 FLOAT AFTER tk_12,
            ADD COLUMN tkp_9  FLOAT AFTER tk_12,
            ADD COLUMN tkp_8  FLOAT AFTER tk_12,
            ADD COLUMN tkp_7  FLOAT AFTER tk_12,
            ADD COLUMN tkp_6  FLOAT AFTER tk_12,
            ADD COLUMN tkp_5  FLOAT AFTER tk_12,
            ADD COLUMN tkp_4  FLOAT AFTER tk_12,
            ADD COLUMN tkp_3  FLOAT AFTER tk_12,
            ADD COLUMN tkp_2  FLOAT AFTER tk_12,
            ADD COLUMN tkp_1  FLOAT AFTER tk_12,
            # deviasi realisasi keuangan BL
            ADD COLUMN rkp_12_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_11_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_10_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_9_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_8_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_7_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_6_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_5_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_4_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_3_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_2_dev FLOAT AFTER tk_12,
            ADD COLUMN rkp_1_dev FLOAT AFTER tk_12;  

          UPDATE target_realisasi_pd
            SET 
            # persen target keuangan BL
            tkp_1  = (tk_1  / anggaran_bl) * 100,
            tkp_2  = (tk_2  / anggaran_bl) * 100,
            tkp_3  = (tk_3  / anggaran_bl) * 100,
            tkp_4  = (tk_4  / anggaran_bl) * 100,
            tkp_5  = (tk_5  / anggaran_bl) * 100,
            tkp_6  = (tk_6  / anggaran_bl) * 100,
            tkp_7  = (tk_7  / anggaran_bl) * 100,
            tkp_8  = (tk_8  / anggaran_bl) * 100,
            tkp_9  = (tk_9  / anggaran_bl) * 100,
            tkp_10 = (tk_10 / anggaran_bl) * 100,
            tkp_11 = (tk_11 / anggaran_bl) * 100,
            tkp_12 = (tk_12 / anggaran_bl) * 100,
            # persen deviasi realisasi keuangan BL
            rkp_1_dev = rkp_1  - ((tk_1  / anggaran_bl) * 100),
            rkp_2_dev = rkp_2  - ((tk_2  / anggaran_bl) * 100),
            rkp_3_dev = rkp_3  - ((tk_3  / anggaran_bl) * 100),
            rkp_4_dev = rkp_4  - ((tk_4  / anggaran_bl) * 100),
            rkp_5_dev = rkp_5  - ((tk_5  / anggaran_bl) * 100),
            rkp_6_dev = rkp_6  - ((tk_6  / anggaran_bl) * 100),
            rkp_7_dev = rkp_7  - ((tk_7  / anggaran_bl) * 100),
            rkp_8_dev = rkp_8  - ((tk_8  / anggaran_bl) * 100),
            rkp_9_dev = rkp_9  - ((tk_9  / anggaran_bl) * 100),
            rkp_10_dev = rkp_10 - ((tk_10 / anggaran_bl) * 100),
            rkp_11_dev = rkp_11 - ((tk_11 / anggaran_bl) * 100),
            rkp_12_dev = rkp_12 - ((tk_12 / anggaran_bl) * 100);

          # SELECT * FROM target_realisasi_pd;

          # tambahkan kolom realisasi fisik dan keuangan total PD (sesudah kolom Target keuangan BL)
          ALTER TABLE target_realisasi_pd 
            ADD COLUMN tot_tf_1  FLOAT,
            ADD COLUMN tot_tf_2  FLOAT,
            ADD COLUMN tot_tf_3  FLOAT,
            ADD COLUMN tot_tf_4  FLOAT,
            ADD COLUMN tot_tf_5  FLOAT,
            ADD COLUMN tot_tf_6  FLOAT,
            ADD COLUMN tot_tf_7  FLOAT,
            ADD COLUMN tot_tf_8  FLOAT,
            ADD COLUMN tot_tf_9  FLOAT,
            ADD COLUMN tot_tf_10 FLOAT,
            ADD COLUMN tot_tf_11 FLOAT,    
            ADD COLUMN tot_tf_12 FLOAT,

            ADD COLUMN tot_tk_1  BIGINT,
            ADD COLUMN tot_tk_2  BIGINT,
            ADD COLUMN tot_tk_3  BIGINT,
            ADD COLUMN tot_tk_4  BIGINT,
            ADD COLUMN tot_tk_5  BIGINT,
            ADD COLUMN tot_tk_6  BIGINT,
            ADD COLUMN tot_tk_7  BIGINT,
            ADD COLUMN tot_tk_8  BIGINT,
            ADD COLUMN tot_tk_9  BIGINT,
            ADD COLUMN tot_tk_10  BIGINT,
            ADD COLUMN tot_tk_11  BIGINT,    
            ADD COLUMN tot_tk_12  BIGINT,

            ADD COLUMN tot_tkp_1  FLOAT,
            ADD COLUMN tot_tkp_2  FLOAT,
            ADD COLUMN tot_tkp_3  FLOAT,
            ADD COLUMN tot_tkp_4  FLOAT,
            ADD COLUMN tot_tkp_5  FLOAT,
            ADD COLUMN tot_tkp_6  FLOAT,
            ADD COLUMN tot_tkp_7  FLOAT,
            ADD COLUMN tot_tkp_8  FLOAT,
            ADD COLUMN tot_tkp_9  FLOAT,
            ADD COLUMN tot_tkp_10  FLOAT,
            ADD COLUMN tot_tkp_11  FLOAT,    
            ADD COLUMN tot_tkp_12  FLOAT,  

            ADD COLUMN tot_rf_1  FLOAT,
            ADD COLUMN tot_rf_2  FLOAT,
            ADD COLUMN tot_rf_3  FLOAT,
            ADD COLUMN tot_rf_4  FLOAT,
            ADD COLUMN tot_rf_5  FLOAT,
            ADD COLUMN tot_rf_6  FLOAT,
            ADD COLUMN tot_rf_7  FLOAT,
            ADD COLUMN tot_rf_8  FLOAT,
            ADD COLUMN tot_rf_9  FLOAT,
            ADD COLUMN tot_rf_10 FLOAT,
            ADD COLUMN tot_rf_11 FLOAT,    
            ADD COLUMN tot_rf_12 FLOAT,

            ADD COLUMN tot_rf_1_dev FLOAT,
            ADD COLUMN tot_rf_2_dev FLOAT,
            ADD COLUMN tot_rf_3_dev FLOAT,
            ADD COLUMN tot_rf_4_dev FLOAT,
            ADD COLUMN tot_rf_5_dev FLOAT,
            ADD COLUMN tot_rf_6_dev FLOAT,
            ADD COLUMN tot_rf_7_dev FLOAT,
            ADD COLUMN tot_rf_8_dev FLOAT,
            ADD COLUMN tot_rf_9_dev FLOAT,
            ADD COLUMN tot_rf_10_dev FLOAT,
            ADD COLUMN tot_rf_11_dev FLOAT,    
            ADD COLUMN tot_rf_12_dev FLOAT,

            ADD COLUMN tot_rk_1  BIGINT,
            ADD COLUMN tot_rk_2  BIGINT,
            ADD COLUMN tot_rk_3  BIGINT,
            ADD COLUMN tot_rk_4  BIGINT,
            ADD COLUMN tot_rk_5  BIGINT,
            ADD COLUMN tot_rk_6  BIGINT,
            ADD COLUMN tot_rk_7  BIGINT,
            ADD COLUMN tot_rk_8  BIGINT,
            ADD COLUMN tot_rk_9  BIGINT,
            ADD COLUMN tot_rk_10  BIGINT,
            ADD COLUMN tot_rk_11  BIGINT,    
            ADD COLUMN tot_rk_12  BIGINT,

            ADD COLUMN tot_rkp_1  FLOAT,
            ADD COLUMN tot_rkp_2  FLOAT,
            ADD COLUMN tot_rkp_3  FLOAT,
            ADD COLUMN tot_rkp_4  FLOAT,
            ADD COLUMN tot_rkp_5  FLOAT,
            ADD COLUMN tot_rkp_6  FLOAT,
            ADD COLUMN tot_rkp_7  FLOAT,
            ADD COLUMN tot_rkp_8  FLOAT,
            ADD COLUMN tot_rkp_9  FLOAT,
            ADD COLUMN tot_rkp_10  FLOAT,
            ADD COLUMN tot_rkp_11  FLOAT,    
            ADD COLUMN tot_rkp_12  FLOAT, 

            ADD COLUMN tot_rkp_1_dev  FLOAT,
            ADD COLUMN tot_rkp_2_dev  FLOAT,
            ADD COLUMN tot_rkp_3_dev  FLOAT,
            ADD COLUMN tot_rkp_4_dev  FLOAT,
            ADD COLUMN tot_rkp_5_dev  FLOAT,
            ADD COLUMN tot_rkp_6_dev  FLOAT,
            ADD COLUMN tot_rkp_7_dev  FLOAT,
            ADD COLUMN tot_rkp_8_dev  FLOAT,
            ADD COLUMN tot_rkp_9_dev  FLOAT,
            ADD COLUMN tot_rkp_10_dev  FLOAT,
            ADD COLUMN tot_rkp_11_dev  FLOAT,    
            ADD COLUMN tot_rkp_12_dev  FLOAT;   

          UPDATE target_realisasi_pd
            SET 
            tot_tf_1  = ((anggaran_bl  / anggaran_total) *  tf_1)  + ((anggaran_btl  / anggaran_total) *  btl_tf_1) ,
            tot_tf_2  = ((anggaran_bl  / anggaran_total) *  tf_2)  + ((anggaran_btl  / anggaran_total) *  btl_tf_2) ,
            tot_tf_3  = ((anggaran_bl  / anggaran_total) *  tf_3)  + ((anggaran_btl  / anggaran_total) *  btl_tf_3) ,
            tot_tf_4  = ((anggaran_bl  / anggaran_total) *  tf_4)  + ((anggaran_btl  / anggaran_total) *  btl_tf_4) ,
            tot_tf_5  = ((anggaran_bl  / anggaran_total) *  tf_5)  + ((anggaran_btl  / anggaran_total) *  btl_tf_5) ,
            tot_tf_6  = ((anggaran_bl  / anggaran_total) *  tf_6)  + ((anggaran_btl  / anggaran_total) *  btl_tf_6) ,
            tot_tf_7  = ((anggaran_bl  / anggaran_total) *  tf_7)  + ((anggaran_btl  / anggaran_total) *  btl_tf_7) ,
            tot_tf_8  = ((anggaran_bl  / anggaran_total) *  tf_8)  + ((anggaran_btl  / anggaran_total) *  btl_tf_8) ,
            tot_tf_9  = ((anggaran_bl  / anggaran_total) *  tf_9)  + ((anggaran_btl  / anggaran_total) *  btl_tf_9) ,
            tot_tf_10 = ((anggaran_bl  / anggaran_total) *  tf_10) + ((anggaran_btl  / anggaran_total) *  btl_tf_10),
            tot_tf_11 = ((anggaran_bl  / anggaran_total) *  tf_11) + ((anggaran_btl  / anggaran_total) *  btl_tf_11),
            tot_tf_12 = ((anggaran_bl  / anggaran_total) *  tf_12) + ((anggaran_btl  / anggaran_total) *  btl_tf_12),
            tot_tk_1  = tk_1  + btl_tk_1 ,
            tot_tk_2  = tk_2  + btl_tk_2 ,
            tot_tk_3  = tk_3  + btl_tk_3 ,
            tot_tk_4  = tk_4  + btl_tk_4 ,
            tot_tk_5  = tk_5  + btl_tk_5 ,
            tot_tk_6  = tk_6  + btl_tk_6 ,
            tot_tk_7  = tk_7  + btl_tk_7 ,
            tot_tk_8  = tk_8  + btl_tk_8 ,
            tot_tk_9  = tk_9  + btl_tk_9 ,
            tot_tk_10 = tk_10 + btl_tk_10,
            tot_tk_11 = tk_11 + btl_tk_11,
            tot_tk_12 = tk_12 + btl_tk_12,
            tot_rf_1  = ((anggaran_bl  / anggaran_total) *  rf_1)  + ((anggaran_btl  / anggaran_total) *  btl_rf_1) ,
            tot_rf_2  = ((anggaran_bl  / anggaran_total) *  rf_2)  + ((anggaran_btl  / anggaran_total) *  btl_rf_2) ,
            tot_rf_3  = ((anggaran_bl  / anggaran_total) *  rf_3)  + ((anggaran_btl  / anggaran_total) *  btl_rf_3) ,
            tot_rf_4  = ((anggaran_bl  / anggaran_total) *  rf_4)  + ((anggaran_btl  / anggaran_total) *  btl_rf_4) ,
            tot_rf_5  = ((anggaran_bl  / anggaran_total) *  rf_5)  + ((anggaran_btl  / anggaran_total) *  btl_rf_5) ,
            tot_rf_6  = ((anggaran_bl  / anggaran_total) *  rf_6)  + ((anggaran_btl  / anggaran_total) *  btl_rf_6) ,
            tot_rf_7  = ((anggaran_bl  / anggaran_total) *  rf_7)  + ((anggaran_btl  / anggaran_total) *  btl_rf_7) ,
            tot_rf_8  = ((anggaran_bl  / anggaran_total) *  rf_8)  + ((anggaran_btl  / anggaran_total) *  btl_rf_8) ,
            tot_rf_9  = ((anggaran_bl  / anggaran_total) *  rf_9)  + ((anggaran_btl  / anggaran_total) *  btl_rf_9) ,
            tot_rf_10 = ((anggaran_bl  / anggaran_total) *  rf_10) + ((anggaran_btl  / anggaran_total) *  btl_rf_10),
            tot_rf_11 = ((anggaran_bl  / anggaran_total) *  rf_11) + ((anggaran_btl  / anggaran_total) *  btl_rf_11),
            tot_rf_12 = ((anggaran_bl  / anggaran_total) *  rf_12) + ((anggaran_btl  / anggaran_total) *  btl_rf_12),

            tot_rf_1_dev  = ( ((anggaran_bl  / anggaran_total) *  rf_1)  + ((anggaran_btl  / anggaran_total) *  btl_rf_1)  ) - ( ((anggaran_bl  / anggaran_total) *  tf_1)  + ((anggaran_btl  / anggaran_total) *  btl_tf_1)  ),
            tot_rf_2_dev  = ( ((anggaran_bl  / anggaran_total) *  rf_2)  + ((anggaran_btl  / anggaran_total) *  btl_rf_2)  ) - ( ((anggaran_bl  / anggaran_total) *  tf_2)  + ((anggaran_btl  / anggaran_total) *  btl_tf_2)  ),
            tot_rf_3_dev  = ( ((anggaran_bl  / anggaran_total) *  rf_3)  + ((anggaran_btl  / anggaran_total) *  btl_rf_3)  ) - ( ((anggaran_bl  / anggaran_total) *  tf_3)  + ((anggaran_btl  / anggaran_total) *  btl_tf_3)  ),
            tot_rf_4_dev  = ( ((anggaran_bl  / anggaran_total) *  rf_4)  + ((anggaran_btl  / anggaran_total) *  btl_rf_4)  ) - ( ((anggaran_bl  / anggaran_total) *  tf_4)  + ((anggaran_btl  / anggaran_total) *  btl_tf_4)  ),
            tot_rf_5_dev  = ( ((anggaran_bl  / anggaran_total) *  rf_5)  + ((anggaran_btl  / anggaran_total) *  btl_rf_5)  ) - ( ((anggaran_bl  / anggaran_total) *  tf_5)  + ((anggaran_btl  / anggaran_total) *  btl_tf_5)  ),
            tot_rf_6_dev  = ( ((anggaran_bl  / anggaran_total) *  rf_6)  + ((anggaran_btl  / anggaran_total) *  btl_rf_6)  ) - ( ((anggaran_bl  / anggaran_total) *  tf_6)  + ((anggaran_btl  / anggaran_total) *  btl_tf_6)  ),
            tot_rf_7_dev  = ( ((anggaran_bl  / anggaran_total) *  rf_7)  + ((anggaran_btl  / anggaran_total) *  btl_rf_7)  ) - ( ((anggaran_bl  / anggaran_total) *  tf_7)  + ((anggaran_btl  / anggaran_total) *  btl_tf_7)  ),
            tot_rf_8_dev  = ( ((anggaran_bl  / anggaran_total) *  rf_8)  + ((anggaran_btl  / anggaran_total) *  btl_rf_8)  ) - ( ((anggaran_bl  / anggaran_total) *  tf_8)  + ((anggaran_btl  / anggaran_total) *  btl_tf_8)  ),
            tot_rf_9_dev  = ( ((anggaran_bl  / anggaran_total) *  rf_9)  + ((anggaran_btl  / anggaran_total) *  btl_rf_9)  ) - ( ((anggaran_bl  / anggaran_total) *  tf_9)  + ((anggaran_btl  / anggaran_total) *  btl_tf_9)  ),
            tot_rf_10_dev = ( ((anggaran_bl  / anggaran_total) *  rf_10) + ((anggaran_btl  / anggaran_total) *  btl_rf_10) ) - ( ((anggaran_bl  / anggaran_total) *  tf_10) + ((anggaran_btl  / anggaran_total) *  btl_tf_10) ),
            tot_rf_11_dev = ( ((anggaran_bl  / anggaran_total) *  rf_11) + ((anggaran_btl  / anggaran_total) *  btl_rf_11) ) - ( ((anggaran_bl  / anggaran_total) *  tf_11) + ((anggaran_btl  / anggaran_total) *  btl_tf_11) ),
            tot_rf_12_dev = ( ((anggaran_bl  / anggaran_total) *  rf_12) + ((anggaran_btl  / anggaran_total) *  btl_rf_12) ) - ( ((anggaran_bl  / anggaran_total) *  tf_12) + ((anggaran_btl  / anggaran_total) *  btl_tf_12) ),

            tot_rk_1  = rk_1  + btl_rk_1 ,
            tot_rk_2  = rk_2  + btl_rk_2 ,
            tot_rk_3  = rk_3  + btl_rk_3 ,
            tot_rk_4  = rk_4  + btl_rk_4 ,
            tot_rk_5  = rk_5  + btl_rk_5 ,
            tot_rk_6  = rk_6  + btl_rk_6 ,
            tot_rk_7  = rk_7  + btl_rk_7 ,
            tot_rk_8  = rk_8  + btl_rk_8 ,
            tot_rk_9  = rk_9  + btl_rk_9 ,
            tot_rk_10 = rk_10 + btl_rk_10,
            tot_rk_11 = rk_11 + btl_rk_11,
            tot_rk_12 = rk_12 + btl_rk_12;

          # Dapatkan persen2 keuangan
          UPDATE target_realisasi_pd
            SET 
            tot_tkp_1  = (tot_tk_1  / anggaran_total) * 100,
            tot_tkp_2  = (tot_tk_2  / anggaran_total) * 100,
            tot_tkp_3  = (tot_tk_3  / anggaran_total) * 100,
            tot_tkp_4  = (tot_tk_4  / anggaran_total) * 100,
            tot_tkp_5  = (tot_tk_5  / anggaran_total) * 100,
            tot_tkp_6  = (tot_tk_6  / anggaran_total) * 100,
            tot_tkp_7  = (tot_tk_7  / anggaran_total) * 100,
            tot_tkp_8  = (tot_tk_8  / anggaran_total) * 100,
            tot_tkp_9  = (tot_tk_9  / anggaran_total) * 100,
            tot_tkp_10 = (tot_tk_10 / anggaran_total) * 100,
            tot_tkp_11 = (tot_tk_11 / anggaran_total) * 100,
            tot_tkp_12 = (tot_tk_12 / anggaran_total) * 100,

            tot_rkp_1  = (tot_rk_1  / anggaran_total) * 100,
            tot_rkp_2  = (tot_rk_2  / anggaran_total) * 100,
            tot_rkp_3  = (tot_rk_3  / anggaran_total) * 100,
            tot_rkp_4  = (tot_rk_4  / anggaran_total) * 100,
            tot_rkp_5  = (tot_rk_5  / anggaran_total) * 100,
            tot_rkp_6  = (tot_rk_6  / anggaran_total) * 100,
            tot_rkp_7  = (tot_rk_7  / anggaran_total) * 100,
            tot_rkp_8  = (tot_rk_8  / anggaran_total) * 100,
            tot_rkp_9  = (tot_rk_9  / anggaran_total) * 100,
            tot_rkp_10 = (tot_rk_10 / anggaran_total) * 100,
            tot_rkp_11 = (tot_rk_11 / anggaran_total) * 100,
            tot_rkp_12 = (tot_rk_12 / anggaran_total) * 100,

            tot_rkp_1_dev  = ( (tot_rk_1  / anggaran_total) * 100 ) - ( (tot_tk_1  / anggaran_total) * 100 ),
            tot_rkp_2_dev  = ( (tot_rk_2  / anggaran_total) * 100 ) - ( (tot_tk_2  / anggaran_total) * 100 ),
            tot_rkp_3_dev  = ( (tot_rk_3  / anggaran_total) * 100 ) - ( (tot_tk_3  / anggaran_total) * 100 ),
            tot_rkp_4_dev  = ( (tot_rk_4  / anggaran_total) * 100 ) - ( (tot_tk_4  / anggaran_total) * 100 ),
            tot_rkp_5_dev  = ( (tot_rk_5  / anggaran_total) * 100 ) - ( (tot_tk_5  / anggaran_total) * 100 ),
            tot_rkp_6_dev  = ( (tot_rk_6  / anggaran_total) * 100 ) - ( (tot_tk_6  / anggaran_total) * 100 ),
            tot_rkp_7_dev  = ( (tot_rk_7  / anggaran_total) * 100 ) - ( (tot_tk_7  / anggaran_total) * 100 ),
            tot_rkp_8_dev  = ( (tot_rk_8  / anggaran_total) * 100 ) - ( (tot_tk_8  / anggaran_total) * 100 ),
            tot_rkp_9_dev  = ( (tot_rk_9  / anggaran_total) * 100 ) - ( (tot_tk_9  / anggaran_total) * 100 ),
            tot_rkp_10_dev = ( (tot_rk_10 / anggaran_total) * 100 ) - ( (tot_tk_10 / anggaran_total) * 100 ),
            tot_rkp_11_dev = ( (tot_rk_11 / anggaran_total) * 100 ) - ( (tot_tk_11 / anggaran_total) * 100 ),
            tot_rkp_12_dev = ( (tot_rk_12 / anggaran_total) * 100 ) - ( (tot_tk_12 / anggaran_total) * 100 );
             
          # SELECT * FROM target_realisasi_pd;

          SELECT 
            @anggaran_total AS anggaran_total_kota,
            @anggaran_bl AS anggaran_bl_kota,
            @anggaran_btl AS anggaran_btl_kota,
            @anggaran_bl_persen AS anggaran_bl_persen_kota,
            @anggaran_btl_persen AS anggaran_btl_persen_kota,
            @jumlah_belanja AS jumlah_belanja,
            @jumlah_belanja_swakelola AS jumlah_belanja_swakelola,
            @jumlah_belanja_pengadaan AS jumlah_belanja_pengadaan,
            @jumlah_kegiatan AS jumlah_kegiatan,
            @jumlah_program AS jumlah_program,

            # total BL

            SUM( (anggaran_total / @anggaran_total)  * tf_1 ) AS target_bl_fisik_kota_1 ,
            SUM( (anggaran_total / @anggaran_total)  * tf_2 ) AS target_bl_fisik_kota_2 ,
            SUM( (anggaran_total / @anggaran_total)  * tf_3 ) AS target_bl_fisik_kota_3 ,
            SUM( (anggaran_total / @anggaran_total)  * tf_4 ) AS target_bl_fisik_kota_4 ,
            SUM( (anggaran_total / @anggaran_total)  * tf_5 ) AS target_bl_fisik_kota_5 ,
            SUM( (anggaran_total / @anggaran_total)  * tf_6 ) AS target_bl_fisik_kota_6 ,
            SUM( (anggaran_total / @anggaran_total)  * tf_7 ) AS target_bl_fisik_kota_7 ,
            SUM( (anggaran_total / @anggaran_total)  * tf_8 ) AS target_bl_fisik_kota_8 ,
            SUM( (anggaran_total / @anggaran_total)  * tf_9 ) AS target_bl_fisik_kota_9 ,
            SUM( (anggaran_total / @anggaran_total)  * tf_10) AS target_bl_fisik_kota_10,
            SUM( (anggaran_total / @anggaran_total)  * tf_11) AS target_bl_fisik_kota_11,
            SUM( (anggaran_total / @anggaran_total)  * tf_12) AS target_bl_fisik_kota_12,

            SUM( (anggaran_total / @anggaran_total)  * rf_1 ) AS realisasi_bl_fisik_kota_1 ,
            SUM( (anggaran_total / @anggaran_total)  * rf_2 ) AS realisasi_bl_fisik_kota_2 ,
            SUM( (anggaran_total / @anggaran_total)  * rf_3 ) AS realisasi_bl_fisik_kota_3 ,
            SUM( (anggaran_total / @anggaran_total)  * rf_4 ) AS realisasi_bl_fisik_kota_4 ,
            SUM( (anggaran_total / @anggaran_total)  * rf_5 ) AS realisasi_bl_fisik_kota_5 ,
            SUM( (anggaran_total / @anggaran_total)  * rf_6 ) AS realisasi_bl_fisik_kota_6 ,
            SUM( (anggaran_total / @anggaran_total)  * rf_7 ) AS realisasi_bl_fisik_kota_7 ,
            SUM( (anggaran_total / @anggaran_total)  * rf_8 ) AS realisasi_bl_fisik_kota_8 ,
            SUM( (anggaran_total / @anggaran_total)  * rf_9 ) AS realisasi_bl_fisik_kota_9 ,
            SUM( (anggaran_total / @anggaran_total)  * rf_10) AS realisasi_bl_fisik_kota_10,
            SUM( (anggaran_total / @anggaran_total)  * rf_11) AS realisasi_bl_fisik_kota_11,
            SUM( (anggaran_total / @anggaran_total)  * rf_12) AS realisasi_bl_fisik_kota_12,

            SUM(tk_1 ) AS target_bl_keuangan_kota_1 ,
            SUM(tk_2 ) AS target_bl_keuangan_kota_2 ,
            SUM(tk_3 ) AS target_bl_keuangan_kota_3 ,
            SUM(tk_4 ) AS target_bl_keuangan_kota_4 ,
            SUM(tk_5 ) AS target_bl_keuangan_kota_5 ,
            SUM(tk_6 ) AS target_bl_keuangan_kota_6 ,
            SUM(tk_7 ) AS target_bl_keuangan_kota_7 ,
            SUM(tk_8 ) AS target_bl_keuangan_kota_8 ,
            SUM(tk_9 ) AS target_bl_keuangan_kota_9 ,
            SUM(tk_10) AS target_bl_keuangan_kota_10,
            SUM(tk_11) AS target_bl_keuangan_kota_11,
            SUM(tk_12) AS target_bl_keuangan_kota_12,

            (SUM(tk_1 ) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_1 ,
            (SUM(tk_2 ) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_2 ,
            (SUM(tk_3 ) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_3 ,
            (SUM(tk_4 ) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_4 ,
            (SUM(tk_5 ) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_5 ,
            (SUM(tk_6 ) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_6 ,
            (SUM(tk_7 ) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_7 ,
            (SUM(tk_8 ) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_8 ,
            (SUM(tk_9 ) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_9 ,
            (SUM(tk_10) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_10,
            (SUM(tk_11) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_11,
            (SUM(tk_12) / @anggaran_total ) * 100 AS target_bl_keuangan_kota_persen_12,             

            SUM(rk_1 ) AS realisasi_bl_keuangan_kota_1 ,
            SUM(rk_2 ) AS realisasi_bl_keuangan_kota_2 ,
            SUM(rk_3 ) AS realisasi_bl_keuangan_kota_3 ,
            SUM(rk_4 ) AS realisasi_bl_keuangan_kota_4 ,
            SUM(rk_5 ) AS realisasi_bl_keuangan_kota_5 ,
            SUM(rk_6 ) AS realisasi_bl_keuangan_kota_6 ,
            SUM(rk_7 ) AS realisasi_bl_keuangan_kota_7 ,
            SUM(rk_8 ) AS realisasi_bl_keuangan_kota_8 ,
            SUM(rk_9 ) AS realisasi_bl_keuangan_kota_9 ,
            SUM(rk_10) AS realisasi_bl_keuangan_kota_10,
            SUM(rk_11) AS realisasi_bl_keuangan_kota_11,
            SUM(rk_12) AS realisasi_bl_keuangan_kota_12,

            (SUM(rk_1 ) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_1 ,
            (SUM(rk_2 ) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_2 ,
            (SUM(rk_3 ) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_3 ,
            (SUM(rk_4 ) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_4 ,
            (SUM(rk_5 ) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_5 ,
            (SUM(rk_6 ) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_6 ,
            (SUM(rk_7 ) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_7 ,
            (SUM(rk_8 ) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_8 ,
            (SUM(rk_9 ) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_9 ,
            (SUM(rk_10) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_10,
            (SUM(rk_11) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_11,
            (SUM(rk_12) / @anggaran_total ) * 100 AS realisasi_bl_keuangan_kota_persen_12, 

            # total BTL

            SUM( (anggaran_total / @anggaran_total)  * btl_tf_1 ) AS target_btl_fisik_kota_1 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_2 ) AS target_btl_fisik_kota_2 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_3 ) AS target_btl_fisik_kota_3 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_4 ) AS target_btl_fisik_kota_4 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_5 ) AS target_btl_fisik_kota_5 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_6 ) AS target_btl_fisik_kota_6 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_7 ) AS target_btl_fisik_kota_7 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_8 ) AS target_btl_fisik_kota_8 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_9 ) AS target_btl_fisik_kota_9 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_10) AS target_btl_fisik_kota_10,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_11) AS target_btl_fisik_kota_11,
            SUM( (anggaran_total / @anggaran_total)  * btl_tf_12) AS target_btl_fisik_kota_12,

            SUM( (anggaran_total / @anggaran_total)  * btl_rf_1 ) AS realisasi_btl_fisik_kota_1 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_2 ) AS realisasi_btl_fisik_kota_2 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_3 ) AS realisasi_btl_fisik_kota_3 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_4 ) AS realisasi_btl_fisik_kota_4 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_5 ) AS realisasi_btl_fisik_kota_5 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_6 ) AS realisasi_btl_fisik_kota_6 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_7 ) AS realisasi_btl_fisik_kota_7 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_8 ) AS realisasi_btl_fisik_kota_8 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_9 ) AS realisasi_btl_fisik_kota_9 ,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_10) AS realisasi_btl_fisik_kota_10,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_11) AS realisasi_btl_fisik_kota_11,
            SUM( (anggaran_total / @anggaran_total)  * btl_rf_12) AS realisasi_btl_fisik_kota_12,

            SUM(btl_tk_1 ) AS target_btl_keuangan_kota_1 ,
            SUM(btl_tk_2 ) AS target_btl_keuangan_kota_2 ,
            SUM(btl_tk_3 ) AS target_btl_keuangan_kota_3 ,
            SUM(btl_tk_4 ) AS target_btl_keuangan_kota_4 ,
            SUM(btl_tk_5 ) AS target_btl_keuangan_kota_5 ,
            SUM(btl_tk_6 ) AS target_btl_keuangan_kota_6 ,
            SUM(btl_tk_7 ) AS target_btl_keuangan_kota_7 ,
            SUM(btl_tk_8 ) AS target_btl_keuangan_kota_8 ,
            SUM(btl_tk_9 ) AS target_btl_keuangan_kota_9 ,
            SUM(btl_tk_10) AS target_btl_keuangan_kota_10,
            SUM(btl_tk_11) AS target_btl_keuangan_kota_11,
            SUM(btl_tk_12) AS target_btl_keuangan_kota_12,

            (SUM(btl_tk_1 ) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_1 ,
            (SUM(btl_tk_2 ) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_2 ,
            (SUM(btl_tk_3 ) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_3 ,
            (SUM(btl_tk_4 ) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_4 ,
            (SUM(btl_tk_5 ) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_5 ,
            (SUM(btl_tk_6 ) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_6 ,
            (SUM(btl_tk_7 ) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_7 ,
            (SUM(btl_tk_8 ) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_8 ,
            (SUM(btl_tk_9 ) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_9 ,
            (SUM(btl_tk_10) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_10,
            (SUM(btl_tk_11) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_11,
            (SUM(btl_tk_12) / @anggaran_total ) * 100 AS target_btl_keuangan_kota_persen_12,             

            SUM(btl_rk_1 ) AS realisasi_btl_keuangan_kota_1 ,
            SUM(btl_rk_2 ) AS realisasi_btl_keuangan_kota_2 ,
            SUM(btl_rk_3 ) AS realisasi_btl_keuangan_kota_3 ,
            SUM(btl_rk_4 ) AS realisasi_btl_keuangan_kota_4 ,
            SUM(btl_rk_5 ) AS realisasi_btl_keuangan_kota_5 ,
            SUM(btl_rk_6 ) AS realisasi_btl_keuangan_kota_6 ,
            SUM(btl_rk_7 ) AS realisasi_btl_keuangan_kota_7 ,
            SUM(btl_rk_8 ) AS realisasi_btl_keuangan_kota_8 ,
            SUM(btl_rk_9 ) AS realisasi_btl_keuangan_kota_9 ,
            SUM(btl_rk_10) AS realisasi_btl_keuangan_kota_10,
            SUM(btl_rk_11) AS realisasi_btl_keuangan_kota_11,
            SUM(btl_rk_12) AS realisasi_btl_keuangan_kota_12,

            (SUM(btl_rk_1 ) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_1 ,
            (SUM(btl_rk_2 ) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_2 ,
            (SUM(btl_rk_3 ) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_3 ,
            (SUM(btl_rk_4 ) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_4 ,
            (SUM(btl_rk_5 ) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_5 ,
            (SUM(btl_rk_6 ) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_6 ,
            (SUM(btl_rk_7 ) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_7 ,
            (SUM(btl_rk_8 ) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_8 ,
            (SUM(btl_rk_9 ) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_9 ,
            (SUM(btl_rk_10) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_10,
            (SUM(btl_rk_11) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_11,
            (SUM(btl_rk_12) / @anggaran_total ) * 100 AS realisasi_btl_keuangan_kota_persen_12,             

            # total semua (BL dan BTL)

            SUM( (anggaran_total / @anggaran_total)  * tot_tf_1 ) AS target_fisik_kota_1 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_2 ) AS target_fisik_kota_2 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_3 ) AS target_fisik_kota_3 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_4 ) AS target_fisik_kota_4 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_5 ) AS target_fisik_kota_5 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_6 ) AS target_fisik_kota_6 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_7 ) AS target_fisik_kota_7 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_8 ) AS target_fisik_kota_8 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_9 ) AS target_fisik_kota_9 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_10) AS target_fisik_kota_10,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_11) AS target_fisik_kota_11,
            SUM( (anggaran_total / @anggaran_total)  * tot_tf_12) AS target_fisik_kota_12,

            SUM( (anggaran_total / @anggaran_total)  * tot_rf_1 ) AS realisasi_fisik_kota_1 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_2 ) AS realisasi_fisik_kota_2 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_3 ) AS realisasi_fisik_kota_3 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_4 ) AS realisasi_fisik_kota_4 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_5 ) AS realisasi_fisik_kota_5 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_6 ) AS realisasi_fisik_kota_6 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_7 ) AS realisasi_fisik_kota_7 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_8 ) AS realisasi_fisik_kota_8 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_9 ) AS realisasi_fisik_kota_9 ,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_10) AS realisasi_fisik_kota_10,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_11) AS realisasi_fisik_kota_11,
            SUM( (anggaran_total / @anggaran_total)  * tot_rf_12) AS realisasi_fisik_kota_12,

            SUM(tot_tk_1 ) AS target_keuangan_kota_1 ,
            SUM(tot_tk_2 ) AS target_keuangan_kota_2 ,
            SUM(tot_tk_3 ) AS target_keuangan_kota_3 ,
            SUM(tot_tk_4 ) AS target_keuangan_kota_4 ,
            SUM(tot_tk_5 ) AS target_keuangan_kota_5 ,
            SUM(tot_tk_6 ) AS target_keuangan_kota_6 ,
            SUM(tot_tk_7 ) AS target_keuangan_kota_7 ,
            SUM(tot_tk_8 ) AS target_keuangan_kota_8 ,
            SUM(tot_tk_9 ) AS target_keuangan_kota_9 ,
            SUM(tot_tk_10) AS target_keuangan_kota_10,
            SUM(tot_tk_11) AS target_keuangan_kota_11,
            SUM(tot_tk_12) AS target_keuangan_kota_12,

            (SUM(tot_tk_1 ) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_1 ,
            (SUM(tot_tk_2 ) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_2 ,
            (SUM(tot_tk_3 ) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_3 ,
            (SUM(tot_tk_4 ) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_4 ,
            (SUM(tot_tk_5 ) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_5 ,
            (SUM(tot_tk_6 ) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_6 ,
            (SUM(tot_tk_7 ) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_7 ,
            (SUM(tot_tk_8 ) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_8 ,
            (SUM(tot_tk_9 ) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_9 ,
            (SUM(tot_tk_10) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_10,
            (SUM(tot_tk_11) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_11,
            (SUM(tot_tk_12) / @anggaran_total ) * 100 AS target_keuangan_kota_persen_12, 

            SUM(tot_rk_1 ) AS realisasi_keuangan_kota_1 ,
            SUM(tot_rk_2 ) AS realisasi_keuangan_kota_2 ,
            SUM(tot_rk_3 ) AS realisasi_keuangan_kota_3 ,
            SUM(tot_rk_4 ) AS realisasi_keuangan_kota_4 ,
            SUM(tot_rk_5 ) AS realisasi_keuangan_kota_5 ,
            SUM(tot_rk_6 ) AS realisasi_keuangan_kota_6 ,
            SUM(tot_rk_7 ) AS realisasi_keuangan_kota_7 ,
            SUM(tot_rk_8 ) AS realisasi_keuangan_kota_8 ,
            SUM(tot_rk_9 ) AS realisasi_keuangan_kota_9 ,
            SUM(tot_rk_10) AS realisasi_keuangan_kota_10,
            SUM(tot_rk_11) AS realisasi_keuangan_kota_11,
            SUM(tot_rk_12) AS realisasi_keuangan_kota_12,

            (SUM(tot_rk_1 ) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_1 ,
            (SUM(tot_rk_2 ) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_2 ,
            (SUM(tot_rk_3 ) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_3 ,
            (SUM(tot_rk_4 ) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_4 ,
            (SUM(tot_rk_5 ) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_5 ,
            (SUM(tot_rk_6 ) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_6 ,
            (SUM(tot_rk_7 ) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_7 ,
            (SUM(tot_rk_8 ) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_8 ,
            (SUM(tot_rk_9 ) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_9 ,
            (SUM(tot_rk_10) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_10,
            (SUM(tot_rk_11) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_11,
            (SUM(tot_rk_12) / @anggaran_total ) * 100 AS realisasi_keuangan_kota_persen_12 

          FROM target_realisasi_pd
      ';
      $sql_arr = explode(';', $sql_str);
      foreach ($sql_arr as $sql){
        $query = $this->db->query($sql);
      }
      $tabel_kota = $query->result_array()[0];        

      // echo "<pre>";
      // print_r($tabel_kota);
      // echo "</pre>";
      // exit();


      return $tabel_kota;
    }


    function get_realisasi_bulanan_bl($pagu_total,$tahun_anggaran)
    {
      $sql = '
        SELECT
          # realisasi fisik PD
          SUM(a.kf_1 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_1,
          SUM(a.kf_2 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_2,
          SUM(a.kf_3 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_3,
          SUM(a.kf_4 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_4,
          SUM(a.kf_5 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_5,
          SUM(a.kf_6 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_6,
          SUM(a.kf_7 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_7,
          SUM(a.kf_8 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_8,
          SUM(a.kf_9 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_9,
          SUM(a.kf_10 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_10,
          SUM(a.kf_11 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_11,
          SUM(a.kf_12 * ROUND(a.pagu_giat / '.$pagu_total.',8)) AS realisasi_fisik_12,
          # realisasi keuangan kota
          ROUND(SUM(a.kk_1 ) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_1 ,
          ROUND(SUM(a.kk_2 ) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_2 ,
          ROUND(SUM(a.kk_3 ) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_3 ,
          ROUND(SUM(a.kk_4 ) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_4 ,
          ROUND(SUM(a.kk_5 ) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_5 ,
          ROUND(SUM(a.kk_6 ) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_6 ,
          ROUND(SUM(a.kk_7 ) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_7 ,
          ROUND(SUM(a.kk_8 ) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_8 ,
          ROUND(SUM(a.kk_9 ) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_9 ,
          ROUND(SUM(a.kk_10) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_10,
          ROUND(SUM(a.kk_11) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_11,
          ROUND(SUM(a.kk_12) / SUM(a.pagu_giat),8) * 100 AS realisasi_keuangan_12,
          # target fisik kota
          d.tf_1  AS target_fisik_1 ,
          d.tf_2  AS target_fisik_2 ,
          d.tf_3  AS target_fisik_3 ,
          d.tf_4  AS target_fisik_4 ,
          d.tf_5  AS target_fisik_5 ,
          d.tf_6  AS target_fisik_6 ,
          d.tf_7  AS target_fisik_7 ,
          d.tf_8  AS target_fisik_8 ,
          d.tf_9  AS target_fisik_9 ,
          d.tf_10 AS target_fisik_10,
          d.tf_11 AS target_fisik_11,
          d.tf_12 AS target_fisik_12,
          # target keuangan kota
          ROUND(d.tk_1 / '.$pagu_total.',8)*100  AS target_keuangan_1 ,
          ROUND(d.tk_2 / '.$pagu_total.',8)*100  AS target_keuangan_2 ,
          ROUND(d.tk_3 / '.$pagu_total.',8)*100  AS target_keuangan_3 ,
          ROUND(d.tk_4 / '.$pagu_total.',8)*100  AS target_keuangan_4 ,
          ROUND(d.tk_5 / '.$pagu_total.',8)*100  AS target_keuangan_5 ,
          ROUND(d.tk_6 / '.$pagu_total.',8)*100  AS target_keuangan_6 ,
          ROUND(d.tk_7 / '.$pagu_total.',8)*100  AS target_keuangan_7 ,
          ROUND(d.tk_8 / '.$pagu_total.',8)*100  AS target_keuangan_8 ,
          ROUND(d.tk_9 / '.$pagu_total.',8)*100  AS target_keuangan_9 ,
          ROUND(d.tk_10/ '.$pagu_total.',8)*100  AS target_keuangan_10,
          ROUND(d.tk_11/ '.$pagu_total.',8)*100  AS target_keuangan_11,
          ROUND(d.tk_12/ '.$pagu_total.',8)*100  AS target_keuangan_12
        FROM belanja AS a
        JOIN kegiatan AS b ON a.kode_giat = b.kode_giat
        JOIN program AS c ON b.kode_prog = c.kode_prog
        JOIN pd AS d ON c.kode_pd = d.kode_pd
        WHERE 
          a.tahun_anggaran = "'.$tahun_anggaran.'" AND
          b.tahun_anggaran = "'.$tahun_anggaran.'" AND
          c.tahun_anggaran = "'.$tahun_anggaran.'" AND
          a.kode_giat NOT IN (SELECT kode_giat_btl FROM pd WHERE kode_giat_btl <> "")';
      $query = $this->db->query($sql);
      return $query->result()[0];      
    }

    function get_realisasi_bulanan_btl($pagu_total,$tahun_anggaran)
    {
      $sql = '
        SELECT
          # target fisik
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_1) AS target_fisik_1,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_2) AS target_fisik_2,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_3) AS target_fisik_3,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_4) AS target_fisik_4,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_5) AS target_fisik_5,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_6) AS target_fisik_6,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_7) AS target_fisik_7,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_8) AS target_fisik_8,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_9) AS target_fisik_9,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_10) AS target_fisik_10,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_11) AS target_fisik_11,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_tf_12) AS target_fisik_12,
          # realisasi fisik
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_1) AS realisasi_fisik_1,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_2) AS realisasi_fisik_2,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_3) AS realisasi_fisik_3,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_4) AS realisasi_fisik_4,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_5) AS realisasi_fisik_5,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_6) AS realisasi_fisik_6,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_7) AS realisasi_fisik_7,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_8) AS realisasi_fisik_8,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_9) AS realisasi_fisik_9,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_10) AS realisasi_fisik_10,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_11) AS realisasi_fisik_11,
          SUM(ROUND(anggaran_btl / '.$pagu_total.',8) * btl_rf_12) AS realisasi_fisik_12,
          # target keuangan
          ROUND(SUM(btl_tk_1 ) / '.$pagu_total.',8) * 100 AS target_keuangan_1 ,
          ROUND(SUM(btl_tk_2 ) / '.$pagu_total.',8) * 100 AS target_keuangan_2 ,
          ROUND(SUM(btl_tk_3 ) / '.$pagu_total.',8) * 100 AS target_keuangan_3 ,
          ROUND(SUM(btl_tk_4 ) / '.$pagu_total.',8) * 100 AS target_keuangan_4 ,
          ROUND(SUM(btl_tk_5 ) / '.$pagu_total.',8) * 100 AS target_keuangan_5 ,
          ROUND(SUM(btl_tk_6 ) / '.$pagu_total.',8) * 100 AS target_keuangan_6 ,
          ROUND(SUM(btl_tk_7 ) / '.$pagu_total.',8) * 100 AS target_keuangan_7 ,
          ROUND(SUM(btl_tk_8 ) / '.$pagu_total.',8) * 100 AS target_keuangan_8 ,
          ROUND(SUM(btl_tk_9 ) / '.$pagu_total.',8) * 100 AS target_keuangan_9 ,
          ROUND(SUM(btl_tk_10) / '.$pagu_total.',8) * 100 AS target_keuangan_10,
          ROUND(SUM(btl_tk_11) / '.$pagu_total.',8) * 100 AS target_keuangan_11,
          ROUND(SUM(btl_tk_12) / '.$pagu_total.',8) * 100 AS target_keuangan_12,
            # realisasi keuangan
          ROUND(SUM(btl_rk_1 ) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_1 ,
          ROUND(SUM(btl_rk_2 ) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_2 ,
          ROUND(SUM(btl_rk_3 ) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_3 ,
          ROUND(SUM(btl_rk_4 ) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_4 ,
          ROUND(SUM(btl_rk_5 ) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_5 ,
          ROUND(SUM(btl_rk_6 ) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_6 ,
          ROUND(SUM(btl_rk_7 ) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_7 ,
          ROUND(SUM(btl_rk_8 ) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_8 ,
          ROUND(SUM(btl_rk_9 ) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_9 ,
          ROUND(SUM(btl_rk_10) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_10,
          ROUND(SUM(btl_rk_11) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_11,
          ROUND(SUM(btl_rk_12) / '.$pagu_total.',8) * 100 AS realisasi_keuangan_12,
            # target keuangan rupiah
          SUM(btl_tk_1 ) AS target_keuangan_rp_1 ,
          SUM(btl_tk_2 ) AS target_keuangan_rp_2 ,
          SUM(btl_tk_3 ) AS target_keuangan_rp_3 ,
          SUM(btl_tk_4 ) AS target_keuangan_rp_4 ,
          SUM(btl_tk_5 ) AS target_keuangan_rp_5 ,
          SUM(btl_tk_6 ) AS target_keuangan_rp_6 ,
          SUM(btl_tk_7 ) AS target_keuangan_rp_7 ,
          SUM(btl_tk_8 ) AS target_keuangan_rp_8 ,
          SUM(btl_tk_9 ) AS target_keuangan_rp_9 ,
          SUM(btl_tk_10) AS target_keuangan_rp_10,
          SUM(btl_tk_11) AS target_keuangan_rp_11,
          SUM(btl_tk_12) AS target_keuangan_rp_12,
          # target keuangan rupiah
          SUM(btl_rk_1 ) AS realisasi_keuangan_rp_1 ,
          SUM(btl_rk_2 ) AS realisasi_keuangan_rp_2 ,
          SUM(btl_rk_3 ) AS realisasi_keuangan_rp_3 ,
          SUM(btl_rk_4 ) AS realisasi_keuangan_rp_4 ,
          SUM(btl_rk_5 ) AS realisasi_keuangan_rp_5 ,
          SUM(btl_rk_6 ) AS realisasi_keuangan_rp_6 ,
          SUM(btl_rk_7 ) AS realisasi_keuangan_rp_7 ,
          SUM(btl_rk_8 ) AS realisasi_keuangan_rp_8 ,
          SUM(btl_rk_9 ) AS realisasi_keuangan_rp_9 ,
          SUM(btl_rk_10) AS realisasi_keuangan_rp_10,
          SUM(btl_rk_11) AS realisasi_keuangan_rp_11,
          SUM(btl_rk_12) AS realisasi_keuangan_rp_12
        FROM daftar_pd_btl';
      $query = $this->db->query($sql);
      return $query->result()[0]; 
    }


    function get_kinerja_pptk($bulan_pelaporan)
    {
      // Koreksi Nov 12, 2017
      $sql_str = '  

        SELECT
          @jumlah_pptk := COUNT(DISTINCT a.nip_pptk) AS jumlah_pptk,
          @anggaran_yang_dikelola := SUM(b.pagu_giat) AS anggaran_yang_dikelola,
          @jumlah_kegiatan := COUNT(DISTINCT a.kode_giat) AS jumlah_kegiatan          
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat;

        DROP TEMPORARY TABLE IF EXISTS daftar_anggaran_pptk;
        CREATE TEMPORARY TABLE daftar_anggaran_pptk AS
        SELECT
          a.nip_pptk,
          d.nama_p,
          d.hp_p,
          d.jabat_p,
          d.foto_p,
          SUM(b.pagu_giat) AS anggaran_yang_dikelola,
          COUNT(DISTINCT a.kode_giat) AS jumlah_kegiatan
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN pejabat AS d ON a.nip_pptk = d.nip_p
        WHERE
          a.nip_pptk <> ""
        GROUP BY
          a.nip_pptk;

        DROP TEMPORARY TABLE IF EXISTS daftar_realisasi_pptk;
        CREATE TEMPORARY TABLE daftar_realisasi_pptk AS
        SELECT
          d.*,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_1 ) AS realisasi_fisik_1 ,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_2 ) AS realisasi_fisik_2 ,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_3 ) AS realisasi_fisik_3 ,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_4 ) AS realisasi_fisik_4 ,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_5 ) AS realisasi_fisik_5 ,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_6 ) AS realisasi_fisik_6 ,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_7 ) AS realisasi_fisik_7 ,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_8 ) AS realisasi_fisik_8 ,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_9 ) AS realisasi_fisik_9 ,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_10) AS realisasi_fisik_10,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_11) AS realisasi_fisik_11,
          SUM((b.pagu_giat / d.anggaran_yang_dikelola) * b.kf_12) AS realisasi_fisik_12,

          SUM(b.kk_1 ) AS realisasi_keuangan_1 ,
          SUM(b.kk_2 ) AS realisasi_keuangan_2 ,
          SUM(b.kk_3 ) AS realisasi_keuangan_3 ,
          SUM(b.kk_4 ) AS realisasi_keuangan_4 ,
          SUM(b.kk_5 ) AS realisasi_keuangan_5 ,
          SUM(b.kk_6 ) AS realisasi_keuangan_6 ,
          SUM(b.kk_7 ) AS realisasi_keuangan_7 ,
          SUM(b.kk_8 ) AS realisasi_keuangan_8 ,
          SUM(b.kk_9 ) AS realisasi_keuangan_9 ,
          SUM(b.kk_10) AS realisasi_keuangan_10,
          SUM(b.kk_11) AS realisasi_keuangan_11,
          SUM(b.kk_12) AS realisasi_keuangan_12, 

          (SUM(b.kk_1 ) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_1 ,
          (SUM(b.kk_2 ) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_2 ,
          (SUM(b.kk_3 ) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_3 ,
          (SUM(b.kk_4 ) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_4 ,
          (SUM(b.kk_5 ) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_5 ,
          (SUM(b.kk_6 ) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_6 ,
          (SUM(b.kk_7 ) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_7 ,
          (SUM(b.kk_8 ) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_8 ,
          (SUM(b.kk_9 ) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_9 ,
          (SUM(b.kk_10) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_10,
          (SUM(b.kk_11) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_11,
          (SUM(b.kk_12) / d.anggaran_yang_dikelola) * 100 AS realisasi_keuangan_persen_12

        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN daftar_anggaran_pptk AS d ON a.nip_pptk = d.nip_pptk
        GROUP BY
          a.nip_pptk;

        SELECT * FROM daftar_realisasi_pptk ORDER BY realisasi_keuangan_persen_'.$bulan_pelaporan.' DESC  
      ';
      $sql_arr = explode(';', $sql_str);
      foreach ($sql_arr as $sql){
        $query = $this->db->query($sql);
      }      
      $kinerja_pptk["tabel_kinerja_pptk"] = $query->result();

      // kinerja tertinggi fisik
      $sql = '
        SELECT * FROM daftar_realisasi_pptk 
        ORDER BY realisasi_fisik_'.$bulan_pelaporan.' DESC LIMIT 1';
      $query = $this->db->query($sql);
      $kinerja_pptk["tertinggi_fisik"] = $query->result()[0];

      // kinerja terendah fisik
      $sql = '
        SELECT * FROM daftar_realisasi_pptk 
        ORDER BY realisasi_fisik_'.$bulan_pelaporan.' ASC LIMIT 1';
      $query = $this->db->query($sql);
      $kinerja_pptk["terendah_fisik"] = $query->result()[0];

      // kinerja tertinggi keuangan
      $sql = '
        SELECT * FROM daftar_realisasi_pptk 
        ORDER BY realisasi_keuangan_persen_'.$bulan_pelaporan.' DESC LIMIT 1';
      $query = $this->db->query($sql);
      $kinerja_pptk["tertinggi_keuangan"] = $query->result()[0];

      // kinerja terendah keuangan
      $sql = '
        SELECT * FROM daftar_realisasi_pptk 
        ORDER BY realisasi_keuangan_persen_'.$bulan_pelaporan.' ASC LIMIT 1';
      $query = $this->db->query($sql);
      $kinerja_pptk["terendah_keuangan"] = $query->result()[0];

      return $kinerja_pptk;
    }

    function get_kinerja_pptk_total()
    {
      $sql = '
        SELECT
        COUNT(DISTINCT a.nip_pptk) AS jumlah_pptk,
        SUM(b.pagu_giat) AS anggaran_yang_dikelola,
        COUNT(a.kode_giat) AS jumlah_kegiatan
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN program AS d ON a.kode_prog = d.kode_prog';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }

    function get_kinerja_pptk_detail($kode_pd, $bulan_pelaporan, $kode_giat_btl, $nip_pptk)
    {
      $sql = '
        SELECT
        a.kode_giat,
        a.nama_giat,
        COUNT(b.kode_rek_belanja) AS jumlah_belanja,
        SUM(b.pagu_giat) AS pagu_giat,
        SUM(
          b.kf_'.$bulan_pelaporan.' * 
          ROUND(b.pagu_giat /
              (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
               FROM belanja AS x
               JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
               WHERE y.kode_giat = a.kode_giat),8)) AS realisasi_fisik,
        SUM(
          100 * 
          ROUND(
            b.kk_'.$bulan_pelaporan.' /
              (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
               FROM belanja AS x
               JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
               WHERE
               y.kode_giat = a.kode_giat),8)) AS realisasi_keuangan
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN pejabat AS c ON a.nip_pptk = c.nip_p
        JOIN program AS d ON a.kode_prog = d.kode_prog
        WHERE
        d.kode_pd = "'.$kode_pd.'" AND
        a.kode_giat <> "'.$kode_giat_btl.'" AND
        a.nip_pptk = "'.$nip_pptk.'"
        GROUP BY a.kode_giat
        ORDER BY realisasi_fisik';
      $query = $this->db->query($sql);
        // echo "<pre>";
        // print_r($query->result());
        // echo "</pre>";
        // exit();
      return $query->result();
    }





    function get_kinerja_pptk_chart($kode_pd, $kode_giat_btl, $nip_pptk)
    {
      $sql = '
        SELECT
        a.kode_giat,
        a.nama_giat,
        COUNT(b.kode_rek_belanja) AS jumlah_belanja,
        SUM(b.pagu_giat) AS pagu_giat,
        SUM(b.kf_1 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_1,
        SUM(b.kf_2 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_2,
        SUM(b.kf_3 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_3,
        SUM(b.kf_4 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_4,
        SUM(b.kf_5 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_5,
        SUM(b.kf_6 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_6,
        SUM(b.kf_7 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_7,
        SUM(b.kf_8 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_8,
        SUM(b.kf_9 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_9,
        SUM(b.kf_10 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_10,
        SUM(b.kf_11 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_11,
        SUM(b.kf_12 * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )) AS realisasi_fisik_12,

        ROUND(SUM(100 * (b.kk_1 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_1,
        ROUND(SUM(100 * (b.kk_2 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_2,
        ROUND(SUM(100 * (b.kk_3 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_3,
        ROUND(SUM(100 * (b.kk_4 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_4,
        ROUND(SUM(100 * (b.kk_5 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_5,
        ROUND(SUM(100 * (b.kk_6 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_6,
        ROUND(SUM(100 * (b.kk_7 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_7,
        ROUND(SUM(100 * (b.kk_8 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_8,
        ROUND(SUM(100 * (b.kk_9 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_9,
        ROUND(SUM(100 * (b.kk_10 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_10,
        ROUND(SUM(100 * (b.kk_11 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_11,
        ROUND(SUM(100 * (b.kk_12 /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
                      JOIN program AS z ON y.kode_prog = z.kode_prog
           WHERE
              z.kode_pd = "'.$kode_pd.'" AND
              y.kode_giat <> "'.$kode_giat_btl.'" AND
              y.nip_pptk = "'.$nip_pptk.'")
           )),8) AS realisasi_keuangan_12
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN pejabat AS c ON a.nip_pptk = c.nip_p
        JOIN program AS d ON a.kode_prog = d.kode_prog
        WHERE
        d.kode_pd = "'.$kode_pd.'" AND
        a.kode_giat <> "'.$kode_giat_btl.'" AND
        a.nip_pptk = "'.$nip_pptk.'"';
      $query = $this->db->query($sql);
        // echo "<pre>";
        // print_r($query->result());
        // echo "</pre>";
        // exit();
      return $query->result();
    }

    function get_kinerja_pptk_detail_total($kode_pd, $bulan_pelaporan, $kode_giat_btl, $nip_pptk)
    {
      $sql = '
        SELECT
        a.nip_pptk,
        c.nama_p,
        c.jabat_p,
        c.hp_p,
        c.foto_p,
        SUM(b.pagu_giat) AS anggaran_yang_dikelola,
        SUM(b.kf_'.$bulan_pelaporan.' * (b.pagu_giat /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON z.kode_prog = y.kode_prog
           WHERE
           y.nip_pptk = a.nip_pptk AND
           z.kode_pd = "'.$kode_pd.'" AND
           y.kode_giat <> "'.$kode_giat_btl.'")
           )) AS realisasi_fisik,
        SUM(100 * ROUND(b.kk_'.$bulan_pelaporan.' /
          (SELECT SUM(x.pagu_giat) AS anggaran_yang_dikelola
           FROM belanja AS x
           JOIN kegiatan AS y ON x.kode_giat = y.kode_giat
           JOIN program AS z ON z.kode_prog = y.kode_prog
           WHERE
           y.nip_pptk = a.nip_pptk AND
           z.kode_pd = "'.$kode_pd.'" AND
           y.kode_giat <> "'.$kode_giat_btl.'")
           ,8)) AS realisasi_keuangan
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN pejabat AS c ON a.nip_pptk = c.nip_p
        JOIN program AS d ON a.kode_prog = d.kode_prog
        WHERE
        d.kode_pd = "'.$kode_pd.'" AND
        a.kode_giat <> "'.$kode_giat_btl.'" AND
        a.nip_pptk = "'.$nip_pptk.'"';
      $query = $this->db->query($sql);
        // echo "<pre>";
        // print_r($query->result());
        // echo "</pre>";
        // exit();
      return $query->result();
    }

    function get_kinerja_pptk_terendah_fisik($kode_pd, $bulan_pelaporan, $kode_giat_btl)
    {
      $sql = '
        SELECT 
        *, 
        realisasi_fisik_'.$bulan_pelaporan.' AS realisasi_fisik, 
        realisasi_keuangan_'.$bulan_pelaporan.' AS realisasi_keuangan 
        FROM daftar_pptk_realisasi
        WHERE kode_pd = "'.$kode_pd.'"
        ORDER BY realisasi_fisik';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }

    function get_kinerja_pptk_terendah_keuangan($kode_pd, $bulan_pelaporan, $kode_giat_btl)
    {
      $sql = '
        SELECT 
        *, 
        realisasi_fisik_'.$bulan_pelaporan.' AS realisasi_fisik, 
        realisasi_keuangan_'.$bulan_pelaporan.' AS realisasi_keuangan 
        FROM daftar_pptk_realisasi
        WHERE kode_pd = "'.$kode_pd.'"
        ORDER BY realisasi_keuangan';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }

    function get_kinerja_pptk_tertinggi_fisik($kode_pd, $bulan_pelaporan, $kode_giat_btl)
    {
      $sql = '
        SELECT 
        *, 
        realisasi_fisik_'.$bulan_pelaporan.' AS realisasi_fisik, 
        realisasi_keuangan_'.$bulan_pelaporan.' AS realisasi_keuangan 
        FROM daftar_pptk_realisasi
        WHERE kode_pd = "'.$kode_pd.'"
        ORDER BY realisasi_fisik DESC';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }

    function get_kinerja_pptk_tertinggi_keuangan($kode_pd, $bulan_pelaporan, $kode_giat_btl)
    {
      $sql = '
        SELECT 
        *, 
        realisasi_fisik_'.$bulan_pelaporan.' AS realisasi_fisik, 
        realisasi_keuangan_'.$bulan_pelaporan.' AS realisasi_keuangan 
        FROM daftar_pptk_realisasi
        WHERE kode_pd = "'.$kode_pd.'"
        ORDER BY realisasi_keuangan DESC';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }

    function get_laporan_realisasi_kegiatan($bulan_pelaporan,$kode_giat)
    {
      $sql = '
        SELECT
          b.kode_rek_belanja,
          b.jenis_kegiatan,
          b.nama_belanja,
          b.pagu_giat,
          b.kf_'.$bulan_pelaporan.' AS realisasi_fisik,
          b.kk_'.$bulan_pelaporan.' AS realisasi_keuangan
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        WHERE a.kode_giat = "'.$kode_giat.'"
        ORDER BY jenis_kegiatan DESC, kode_rek_belanja';
      $query = $this->db->query($sql);
      return $query->result();
    }

    function get_laporan_realisasi_kegiatan_chart($kode_giat)
    {
      $sql = '
          SELECT
          a.kode_giat,
            a.nama_giat,
            SUM(b.pagu_giat) AS pagu_total,
            SUM(b.kf_1 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_1,
            SUM(b.kf_2 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_2,
            SUM(b.kf_3 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_3,
            SUM(b.kf_4 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_4,
            SUM(b.kf_5 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_5,
            SUM(b.kf_6 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_6,
            SUM(b.kf_7 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_7,
            SUM(b.kf_8 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_8,
            SUM(b.kf_9 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_9,
            SUM(b.kf_10 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_10,
            SUM(b.kf_11 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_11,
            SUM(b.kf_12 * (b.pagu_giat /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_fisik_12,
            SUM(100 * (b.kk_1 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_1,
            SUM(100 * (b.kk_2 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_2,
            SUM(100 * (b.kk_3 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_3,
            SUM(100 * (b.kk_4 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_4,
            SUM(100 * (b.kk_5 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_5,
            ROUND(SUM(100 * (b.kk_6 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )),8) AS realisasi_keuangan_6,
            SUM(100 * (b.kk_7 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_7,
            SUM(100 * (b.kk_8 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_8,
            SUM(100 * (b.kk_9 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_9,
            SUM(100 * (b.kk_10 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_10,
            SUM(100 * (b.kk_11 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_11,
            SUM(100 * (b.kk_12 /
              (SELECT SUM(pagu_giat) FROM belanja WHERE kode_giat = "'.$kode_giat.'")
            )) AS realisasi_keuangan_12
          FROM kegiatan AS a
          JOIN belanja AS b ON a.kode_giat = b.kode_giat
          WHERE a.kode_giat = "'.$kode_giat.'"
          ORDER BY jenis_kegiatan DESC, kode_rek_belanja
        ';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }

    function get_laporan_jenis_pengadaan($kode_pd)
    {
      $sql = '
        SELECT
          a.nip_pptk,
          c.nama_p,
          c.jabat_p,
          c.hp_p,
          c.foto_p,
          COUNT(b.jenis_kegiatan) AS total_paket_pengadaan,
          SUM(IF(b.jenis_pengadaan="Barang",1,0)) AS total_barang,
          SUM(IF(b.jenis_pengadaan="Konstruksi",1,0)) AS total_konstruksi,
          SUM(IF(b.jenis_pengadaan="Konsultan",1,0)) AS total_konsultan,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya",1,0)) AS total_lainnya
          FROM kegiatan AS a
          JOIN belanja AS b ON a.kode_giat = b.kode_giat
          JOIN pejabat AS c ON a.nip_pptk = c.nip_p
          JOIN program AS d ON a.kode_prog = d.kode_prog
          WHERE
          d.kode_pd = "'.$kode_pd.'" AND
          b.jenis_kegiatan = "pengadaan"        
          GROUP BY a.nip_pptk
        ';
      $query = $this->db->query($sql);
      return $query->result();
    }    

    function get_laporan_jenis_pengadaan_total($kode_pd)
    {
      $sql = '
        SELECT
          COUNT(DISTINCT a.nip_pptk) AS jumlah_pptk,
          COUNT(b.jenis_kegiatan) AS total_paket_pengadaan,
          SUM(IF(b.jenis_pengadaan="Barang",1,0)) AS total_barang,
          SUM(IF(b.jenis_pengadaan="Konstruksi",1,0)) AS total_konstruksi,
          SUM(IF(b.jenis_pengadaan="Konsultan",1,0)) AS total_konsultan,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya",1,0)) AS total_lainnya
          FROM kegiatan AS a
          JOIN belanja AS b ON a.kode_giat = b.kode_giat
          JOIN pejabat AS c ON a.nip_pptk = c.nip_p
          JOIN program AS d ON a.kode_prog = d.kode_prog
          WHERE
          d.kode_pd = "'.$kode_pd.'" AND
          b.jenis_kegiatan = "pengadaan"        
        ';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }     

    function get_laporan_jenis_pengadaan_detail($kode_pd,$nip_pptk)
    {
      $sql = '
        SELECT
          COUNT(a.nip_pptk) AS jumlah_pptk,
          c.nama_p,
          c.jabat_p,
          c.hp_p,
          c.foto_p,
          COUNT(b.jenis_kegiatan) AS total_paket_pengadaan,
          SUM(b.pagu_giat) AS total_pagu_pengadaan,
          SUM(IF(b.jenis_pengadaan="Barang",1,0)) AS total_barang,
          SUM(IF(b.jenis_pengadaan="Konstruksi",1,0)) AS total_konstruksi,
          SUM(IF(b.jenis_pengadaan="Konsultan",1,0)) AS total_konsultan,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya",1,0)) AS total_lainnya
          FROM kegiatan AS a
          JOIN belanja AS b ON a.kode_giat = b.kode_giat
          JOIN pejabat AS c ON a.nip_pptk = c.nip_p
          JOIN program AS d ON a.kode_prog = d.kode_prog
          WHERE
          d.kode_pd = "'.$kode_pd.'" AND
          b.jenis_kegiatan = "pengadaan" AND
          a.nip_pptk = "'.$nip_pptk.'"       
        ';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }     

    function get_laporan_jenis_pengadaan_detail_tabel($kode_pd,$nip_pptk)
    {
      $sql = '
        SELECT
          a.kode_giat,
          a.nama_giat,
          b.kode_rek_belanja,
          b.nama_belanja, 
          b.nama_paket_pengadaan, 
          b.pagu_giat,
          b.jenis_pengadaan,
          b.nip_ppk,
          c.nama_p,
          c.jabat_p,
          c.hp_p,
          c.foto_p         
          FROM kegiatan AS a
          JOIN belanja AS b ON a.kode_giat = b.kode_giat
          JOIN pejabat AS c ON b.nip_ppk = c.nip_p
          JOIN program AS d ON a.kode_prog = d.kode_prog
          WHERE
          d.kode_pd = "'.$kode_pd.'" AND
          b.jenis_kegiatan = "pengadaan" AND
          a.nip_pptk = "'.$nip_pptk.'"       
        ';
      $query = $this->db->query($sql);
      return $query->result();
    }       

    function get_laporan_metode_pemilihan_penyedia_barang($kode_pd)
    {
      $sql = '
        SELECT
        b.jenis_pengadaan,
        a.nip_pptk,
        c.nama_p,
        c.jabat_p,
        c.hp_p,
        c.foto_p,
        SUM(IF(b.metode_pemilihan_peny="LU",1,0)) AS barang_LU,
        SUM(IF(b.metode_pemilihan_peny="LS",1,0)) AS barang_LS,
        SUM(IF(b.metode_pemilihan_peny="PL",1,0)) AS barang_PL,
        SUM(IF(b.metode_pemilihan_peny="PK",1,0)) AS barang_PK,
        SUM(IF(b.metode_pemilihan_peny="SY",1,0)) AS barang_SY
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN pejabat AS c ON a.nip_pptk = c.nip_p
        JOIN program AS d ON a.kode_prog = d.kode_prog
        WHERE
        d.kode_pd = "'.$kode_pd.'" AND
        b.jenis_kegiatan = "pengadaan" AND   
        b.jenis_pengadaan = "Barang"     
        GROUP BY a.nip_pptk
        ORDER BY a.nip_pptk;
        ';
      $query = $this->db->query($sql);
      return $query->result();
    } 

    function get_laporan_metode_pemilihan_penyedia_konstruksi($kode_pd)
    {
      $sql = '
        SELECT
        b.jenis_pengadaan,
        a.nip_pptk,
        c.nama_p,
        c.jabat_p,
        c.hp_p,
        c.foto_p,
        SUM(IF(b.metode_pemilihan_peny="LU",1,0)) AS konstruksi_LU,
        SUM(IF(b.metode_pemilihan_peny="LT",1,0)) AS konstruksi_LT,
        SUM(IF(b.metode_pemilihan_peny="PML",1,0)) AS konstruksi_PML,
        SUM(IF(b.metode_pemilihan_peny="PK",1,0)) AS konstruksi_PK,
        SUM(IF(b.metode_pemilihan_peny="PL",1,0)) AS konstruksi_PL
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN pejabat AS c ON a.nip_pptk = c.nip_p
        JOIN program AS d ON a.kode_prog = d.kode_prog
        WHERE
        d.kode_pd = "'.$kode_pd.'" AND
        b.jenis_kegiatan = "pengadaan" AND   
        b.jenis_pengadaan = "Konstruksi"     
        GROUP BY a.nip_pptk
        ORDER BY a.nip_pptk;
        ';
      $query = $this->db->query($sql);
      return $query->result();
    }     

    function get_laporan_metode_pemilihan_penyedia_konsultan($kode_pd)
    {
      $sql = '
        SELECT
        b.jenis_pengadaan,
        a.nip_pptk,
        c.nama_p,
        c.jabat_p,
        c.hp_p,
        c.foto_p,
        SUM(IF(b.metode_pemilihan_peny="SU",1,0)) AS konsultan_SU,
        SUM(IF(b.metode_pemilihan_peny="SS",1,0)) AS konsultan_SS,
        SUM(IF(b.metode_pemilihan_peny="PK",1,0)) AS konsultan_PK,
        SUM(IF(b.metode_pemilihan_peny="PL",1,0)) AS konsultan_PL,
        SUM(IF(b.metode_pemilihan_peny="SY",1,0)) AS konsultan_SY
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN pejabat AS c ON a.nip_pptk = c.nip_p
        JOIN program AS d ON a.kode_prog = d.kode_prog
        WHERE
        d.kode_pd = "'.$kode_pd.'" AND
        b.jenis_kegiatan = "pengadaan" AND   
        b.jenis_pengadaan = "Konsultan"     
        GROUP BY a.nip_pptk
        ORDER BY a.nip_pptk;
        ';
      $query = $this->db->query($sql);
      return $query->result();
    }

    function get_laporan_metode_pemilihan_penyedia_jasa_lainnya($kode_pd)
    {
      $sql = '
        SELECT
        b.jenis_pengadaan,
        a.nip_pptk,
        c.nama_p,
        c.jabat_p,
        c.hp_p,
        c.foto_p,
        SUM(IF(b.metode_pemilihan_peny="LU",1,0)) AS jasa_lainnya_LU,
        SUM(IF(b.metode_pemilihan_peny="LS",1,0)) AS jasa_lainnya_LS,
        SUM(IF(b.metode_pemilihan_peny="PK",1,0)) AS jasa_lainnya_PK,
        SUM(IF(b.metode_pemilihan_peny="PL",1,0)) AS jasa_lainnya_PL,
        SUM(IF(b.metode_pemilihan_peny="SY",1,0)) AS jasa_lainnya_SY
        FROM kegiatan AS a
        JOIN belanja AS b ON a.kode_giat = b.kode_giat
        JOIN pejabat AS c ON a.nip_pptk = c.nip_p
        JOIN program AS d ON a.kode_prog = d.kode_prog
        WHERE
        d.kode_pd = "'.$kode_pd.'" AND
        b.jenis_kegiatan = "pengadaan" AND   
        b.jenis_pengadaan = "Jasa lainnya"     
        GROUP BY a.nip_pptk
        ORDER BY a.nip_pptk;
        ';
      $query = $this->db->query($sql);
      return $query->result();
    }    

    function get_laporan_metode_pemilihan_penyedia_detail_pptk($kode_pd,$nip_pptk)
    {
      $sql = '
        SELECT
          c.nama_p,
          c.jabat_p,
          c.hp_p,
          c.foto_p,
          COUNT(b.jenis_kegiatan) AS total_paket_pengadaan,
          SUM(b.pagu_giat) AS total_pagu_pengadaan,

          SUM(IF(b.jenis_pengadaan="Barang",1,0)) AS total_barang,
          SUM(IF(b.jenis_pengadaan="Barang",b.pagu_giat,0)) AS pagu_total_barang,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="LU",1,0)) AS barang_LU,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="LU",b.pagu_giat,0)) AS pagu_barang_LU,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="LS",1,0)) AS barang_LS,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="LS",b.pagu_giat,0)) AS pagu_barang_LS,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="PL",1,0)) AS barang_PL,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="PL",b.pagu_giat,0)) AS pagu_barang_PL,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="PK",1,0)) AS barang_PK,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="PK",b.pagu_giat,0)) AS pagu_barang_PK,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="SY",1,0)) AS barang_SY,
          SUM(IF(b.jenis_pengadaan="Barang" AND b.metode_pemilihan_peny="SY",b.pagu_giat,0)) AS pagu_barang_SY,

          SUM(IF(b.jenis_pengadaan="Konstruksi",1,0)) AS total_konstruksi,
          SUM(IF(b.jenis_pengadaan="Konstruksi",b.pagu_giat,0)) AS pagu_total_konstruksi,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="LU",1,0)) AS konstruksi_LU,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="LU",b.pagu_giat,0)) AS pagu_konstruksi_LU,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="LT",1,0)) AS konstruksi_LT,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="LT",b.pagu_giat,0)) AS pagu_konstruksi_LT,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="PML",1,0)) AS konstruksi_PML,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="PML",b.pagu_giat,0)) AS pagu_konstruksi_PML,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="PK",1,0)) AS konstruksi_PK,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="PK",b.pagu_giat,0)) AS pagu_konstruksi_PK,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="PL",1,0)) AS konstruksi_PL,
          SUM(IF(b.jenis_pengadaan="Konstruksi" AND b.metode_pemilihan_peny="PL",b.pagu_giat,0)) AS pagu_konstruksi_PL,

          SUM(IF(b.jenis_pengadaan="Konsultan",1,0)) AS total_konsultan,
          SUM(IF(b.jenis_pengadaan="Konsultan",b.pagu_giat,0)) AS pagu_total_konsultan,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="SU",1,0)) AS konsultan_SU,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="SS",1,0)) AS konsultan_SS,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="PK",1,0)) AS konsultan_PK,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="PL",1,0)) AS konsultan_PL,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="SY",1,0)) AS konsultan_SY,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="SU",b.pagu_giat,0)) AS pagu_konsultan_SU,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="SS",b.pagu_giat,0)) AS pagu_konsultan_SS,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="PK",b.pagu_giat,0)) AS pagu_konsultan_PK,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="PL",b.pagu_giat,0)) AS pagu_konsultan_PL,
          SUM(IF(b.jenis_pengadaan="Konsultan" AND b.metode_pemilihan_peny="SY",b.pagu_giat,0)) AS pagu_konsultan_SY,

          SUM(IF(b.jenis_pengadaan="Jasa lainnya",1,0)) AS total_jasa_lainnya,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya",b.pagu_giat,0)) AS pagu_total_jasa_lainnya,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="LU",1,0)) AS jasa_lainnya_LU,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="LS",1,0)) AS jasa_lainnya_LS,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="PK",1,0)) AS jasa_lainnya_PK,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="PL",1,0)) AS jasa_lainnya_PL,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="SY",1,0)) AS jasa_lainnya_SY,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="LU",b.pagu_giat,0)) AS pagu_jasa_lainnya_LU,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="LS",b.pagu_giat,0)) AS pagu_jasa_lainnya_LS,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="PK",b.pagu_giat,0)) AS pagu_jasa_lainnya_PK,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="PL",b.pagu_giat,0)) AS pagu_jasa_lainnya_PL,
          SUM(IF(b.jenis_pengadaan="Jasa lainnya" AND b.metode_pemilihan_peny="SY",b.pagu_giat,0)) AS pagu_jasa_lainnya_SY

          FROM kegiatan AS a
          JOIN belanja AS b ON a.kode_giat = b.kode_giat
          JOIN pejabat AS c ON a.nip_pptk = c.nip_p
          JOIN program AS d ON a.kode_prog = d.kode_prog
          WHERE
          d.kode_pd = "'.$kode_pd.'" AND
          b.jenis_kegiatan = "pengadaan" AND
          a.nip_pptk = "'.$nip_pptk.'"       
        ';
      $query = $this->db->query($sql);
      return $query->result()[0];
    }        

    function get_laporan_metode_pemilihan_penyedia_detail_pptk_tabel($kode_pd,$nip_pptk)
    {
      $sql = '
        SELECT
          a.kode_giat,
          a.nama_giat,
          b.kode_rek_belanja,
          b.nama_belanja, 
          b.nama_paket_pengadaan, 
          b.pagu_giat,
          b.jenis_pengadaan,
          b.metode_pemilihan_peny,
          b.nip_ppk,
          c.nama_p,
          c.jabat_p,
          c.hp_p,
          c.foto_p         
          FROM kegiatan AS a
          JOIN belanja AS b ON a.kode_giat = b.kode_giat
          JOIN pejabat AS c ON b.nip_ppk = c.nip_p
          JOIN program AS d ON a.kode_prog = d.kode_prog
          WHERE
          d.kode_pd = "'.$kode_pd.'" AND
          b.jenis_kegiatan = "pengadaan" AND
          a.nip_pptk = "'.$nip_pptk.'"
          ORDER BY b.jenis_pengadaan      
        ';
      $query = $this->db->query($sql);
      return $query->result();
    } 

}
